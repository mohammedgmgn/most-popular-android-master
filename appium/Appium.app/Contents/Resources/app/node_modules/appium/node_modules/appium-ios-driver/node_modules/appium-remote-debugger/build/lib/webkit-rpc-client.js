"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _logger = _interopRequireDefault(require("./logger"));

var _remoteDebugger = require("./remote-debugger");

var _remoteMessages = _interopRequireDefault(require("./remote-messages"));

var _ws = _interopRequireDefault(require("ws"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _lodash = _interopRequireDefault(require("lodash"));

var _events = _interopRequireDefault(require("events"));

var _helpers = require("./helpers");

var _es6Error = _interopRequireDefault(require("es6-error"));

var _appiumSupport = require("appium-support");

const DATA_LOG_LENGTH = {
  length: 200
};

class WebKitRpcClient extends _events.default.EventEmitter {
  constructor(host, port = _remoteDebugger.REMOTE_DEBUGGER_PORT, responseTimeout = _remoteDebugger.RPC_RESPONSE_TIMEOUT_MS) {
    super();
    this.host = host || 'localhost';
    this.port = port;
    this.responseTimeout = responseTimeout;
    this.curMsgId = 0;
    this.dataHandlers = {};
    this.dataMethods = {};
    this.errorHandlers = {};
    this.remoteMessages = new _remoteMessages.default();
  }

  async connect(pageId) {
    return await new _bluebird.default((resolve, reject) => {
      let url = `ws://${this.host}:${this.port}/devtools/page/${pageId}`;
      this.pageIdKey = pageId;
      this.socket = new _ws.default(url);
      this.socket.on('open', () => {
        _logger.default.debug(`WebKit debugger web socket connected to url: ${url}`);

        this.connected = true;
        resolve();
      });
      this.socket.on('close', () => {
        _logger.default.debug('WebKit remote debugger socket disconnected');

        this.connected = false;
      });
      this.socket.on('error', exception => {
        if (this.connected) {
          _logger.default.debug(`WebKit debugger web socket error: ${exception.message}`);

          this.connected = false;
        }

        reject(exception);
      });
      this.socket.on('message', this.receive.bind(this));
    });
  }

  disconnect() {
    _logger.default.debug('Disconnecting from WebKit remote debugger');

    if (this.isConnected()) {
      this.socket.close(1001);
    }

    this.connected = false;
  }

  isConnected() {
    return this.socket !== null && this.connected;
  }

  async send(command, opts = {}) {
    let data = this.remoteMessages.getRemoteCommand(command, _lodash.default.defaults({
      connId: this.connId,
      senderId: this.senderId
    }, opts));

    _logger.default.debug(`Sending WebKit data: ${_lodash.default.truncate(JSON.stringify(data), DATA_LOG_LENGTH)}`);

    _logger.default.debug(`Webkit response timeout: ${this.responseTimeout}`);

    this.curMsgId++;
    data.id = this.curMsgId;
    const id = this.curMsgId.toString();
    return await new _bluebird.default((resolve, reject) => {
      this.dataHandlers[id] = resolve;
      this.dataMethods[id] = data.method;
      this.errorHandlers[id] = reject;
      this.socket.send(JSON.stringify(data), function (error) {
        if (_appiumSupport.util.hasValue(error)) {
          _logger.default.debug(`WebKit socket error occurred: ${error}`);

          reject(new Error(error));
        }
      });
    }).catch(e => {
      if (e.constructor.name !== WebKitRPCWarning.name) {
        throw e;
      }

      _logger.default.warn(e.message);

      return _bluebird.default.resolve(null);
    }).finally(res => {
      delete this.dataHandlers[id];
      delete this.dataMethods[id];
      delete this.errorHandlers[id];
      return res;
    }).timeout(this.responseTimeout);
  }

  receive(data) {
    _logger.default.debug(`Received WebKit data: '${_lodash.default.truncate(data, DATA_LOG_LENGTH)}'`);

    data = _appiumSupport.util.safeJsonParse(data);

    const rejectCall = error => {
      if (data && this.errorHandlers[data.id]) {
        return this.errorHandlers[data.id](error);
      }

      if (error.constructor.name === WebKitRPCWarning.name) {
        _logger.default.warn(error.message);
      } else {
        _logger.default.errorAndThrow(error);
      }
    };

    if (!_lodash.default.isPlainObject(data)) {
      return rejectCall(new WebKitRPCWarning(`No parseable data found`));
    }

    if (data.wasThrown || data.result && data.result.wasThrown) {
      const message = data.wasThrown ? data.result.value || data.result.description : data.result.result.value || data.result.result.description;
      return rejectCall(new Error(message));
    }

    const msgId = data.id;
    const method = this.dataMethods[msgId] || data.method;

    if (!method) {
      return rejectCall(new WebKitRPCWarning(`Did not find any handlers for ${msgId ? `'${msgId}'` : 'the recent'} message`));
    }

    _logger.default.debug(`Found method '${method}'${msgId ? ` for '${msgId}' message` : ''}`);

    let isEventHandled = false;

    switch (method) {
      case 'Profiler.resetProfiles':
        _logger.default.debug('Device is telling us to reset profiles. Should probably ' + 'do some kind of callback here');

        isEventHandled = true;
        break;

      case 'Timeline.eventRecorded':
        if (this.timelineEventHandler) {
          this.timelineEventHandler(data.result);
          isEventHandled = true;
        }

        break;

      case 'Console.messageAdded':
        if (this.consoleEventHandler) {
          this.consoleEventHandler(data.params.message);
          isEventHandled = true;
        }

        break;

      case 'Page.navigate':
        _logger.default.debug(`Received page navigated message: ${(0, _helpers.simpleStringify)(data)}`);

        isEventHandled = true;
        break;

      case 'Network.dataReceived':
      case 'Network.requestWillBeSent':
      case 'Network.responseReceived':
      case 'Network.loadingFinished':
      case 'Network.loadingFailed':
        if (_lodash.default.isFunction(this.networkEventHandler)) {
          this.networkEventHandler(method, data.params);
          return;
        }

        break;
    }

    if (!data.error && _lodash.default.has(this.dataHandlers, msgId)) {
      return this.dataHandlers[msgId](data.result);
    }

    if (data.error && _lodash.default.has(this.errorHandlers, msgId)) {
      return this.errorHandlers[msgId](data.error);
    }

    if (!isEventHandled) {
      _logger.default.debug(`There is no handler scheduled for method '${method}' in ${msgId ? `'${msgId}'` : 'the recent'} message`);
    }
  }

  setTimelineEventHandler(timelineEventHandler) {
    this.timelineEventHandler = timelineEventHandler;
  }

  setConsoleLogEventHandler(consoleEventHandler) {
    this.consoleEventHandler = consoleEventHandler;
  }

  setNetworkLogEventHandler(networkEventHandler) {
    this.networkEventHandler = networkEventHandler;
  }

}

exports.default = WebKitRpcClient;

class WebKitRPCWarning extends _es6Error.default {}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi93ZWJraXQtcnBjLWNsaWVudC5qcyJdLCJuYW1lcyI6WyJEQVRBX0xPR19MRU5HVEgiLCJsZW5ndGgiLCJXZWJLaXRScGNDbGllbnQiLCJldmVudHMiLCJFdmVudEVtaXR0ZXIiLCJjb25zdHJ1Y3RvciIsImhvc3QiLCJwb3J0IiwiUkVNT1RFX0RFQlVHR0VSX1BPUlQiLCJyZXNwb25zZVRpbWVvdXQiLCJSUENfUkVTUE9OU0VfVElNRU9VVF9NUyIsImN1ck1zZ0lkIiwiZGF0YUhhbmRsZXJzIiwiZGF0YU1ldGhvZHMiLCJlcnJvckhhbmRsZXJzIiwicmVtb3RlTWVzc2FnZXMiLCJSZW1vdGVNZXNzYWdlcyIsImNvbm5lY3QiLCJwYWdlSWQiLCJCIiwicmVzb2x2ZSIsInJlamVjdCIsInVybCIsInBhZ2VJZEtleSIsInNvY2tldCIsIldlYlNvY2tldCIsIm9uIiwibG9nIiwiZGVidWciLCJjb25uZWN0ZWQiLCJleGNlcHRpb24iLCJtZXNzYWdlIiwicmVjZWl2ZSIsImJpbmQiLCJkaXNjb25uZWN0IiwiaXNDb25uZWN0ZWQiLCJjbG9zZSIsInNlbmQiLCJjb21tYW5kIiwib3B0cyIsImRhdGEiLCJnZXRSZW1vdGVDb21tYW5kIiwiXyIsImRlZmF1bHRzIiwiY29ubklkIiwic2VuZGVySWQiLCJ0cnVuY2F0ZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJpZCIsInRvU3RyaW5nIiwibWV0aG9kIiwiZXJyb3IiLCJ1dGlsIiwiaGFzVmFsdWUiLCJFcnJvciIsImNhdGNoIiwiZSIsIm5hbWUiLCJXZWJLaXRSUENXYXJuaW5nIiwid2FybiIsImZpbmFsbHkiLCJyZXMiLCJ0aW1lb3V0Iiwic2FmZUpzb25QYXJzZSIsInJlamVjdENhbGwiLCJlcnJvckFuZFRocm93IiwiaXNQbGFpbk9iamVjdCIsIndhc1Rocm93biIsInJlc3VsdCIsInZhbHVlIiwiZGVzY3JpcHRpb24iLCJtc2dJZCIsImlzRXZlbnRIYW5kbGVkIiwidGltZWxpbmVFdmVudEhhbmRsZXIiLCJjb25zb2xlRXZlbnRIYW5kbGVyIiwicGFyYW1zIiwiaXNGdW5jdGlvbiIsIm5ldHdvcmtFdmVudEhhbmRsZXIiLCJoYXMiLCJzZXRUaW1lbGluZUV2ZW50SGFuZGxlciIsInNldENvbnNvbGVMb2dFdmVudEhhbmRsZXIiLCJzZXROZXR3b3JrTG9nRXZlbnRIYW5kbGVyIiwiRVM2RXJyb3IiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0EsTUFBTUEsZUFBZSxHQUFHO0FBQUNDLEVBQUFBLE1BQU0sRUFBRTtBQUFULENBQXhCOztBQUVlLE1BQU1DLGVBQU4sU0FBOEJDLGdCQUFPQyxZQUFyQyxDQUFrRDtBQUMvREMsRUFBQUEsV0FBVyxDQUFFQyxJQUFGLEVBQVFDLElBQUksR0FBR0Msb0NBQWYsRUFBcUNDLGVBQWUsR0FBR0MsdUNBQXZELEVBQWdGO0FBQ3pGO0FBRUEsU0FBS0osSUFBTCxHQUFZQSxJQUFJLElBQUksV0FBcEI7QUFDQSxTQUFLQyxJQUFMLEdBQVlBLElBQVo7QUFFQSxTQUFLRSxlQUFMLEdBQXVCQSxlQUF2QjtBQUVBLFNBQUtFLFFBQUwsR0FBZ0IsQ0FBaEI7QUFFQSxTQUFLQyxZQUFMLEdBQW9CLEVBQXBCO0FBQ0EsU0FBS0MsV0FBTCxHQUFtQixFQUFuQjtBQUNBLFNBQUtDLGFBQUwsR0FBcUIsRUFBckI7QUFFQSxTQUFLQyxjQUFMLEdBQXNCLElBQUlDLHVCQUFKLEVBQXRCO0FBQ0Q7O0FBRUQsUUFBTUMsT0FBTixDQUFlQyxNQUFmLEVBQXVCO0FBQ3JCLFdBQU8sTUFBTSxJQUFJQyxpQkFBSixDQUFNLENBQUNDLE9BQUQsRUFBVUMsTUFBVixLQUFxQjtBQUd0QyxVQUFJQyxHQUFHLEdBQUksUUFBTyxLQUFLaEIsSUFBSyxJQUFHLEtBQUtDLElBQUssa0JBQWlCVyxNQUFPLEVBQWpFO0FBQ0EsV0FBS0ssU0FBTCxHQUFpQkwsTUFBakI7QUFHQSxXQUFLTSxNQUFMLEdB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QUM2QixNQUE5QixDQUFQO0FBQ0Q7O0FBQ0QsUUFBSTdCLElBQUksQ0FBQ1ksS0FBTCxJQUFjVixnQkFBRXFDLEdBQUYsQ0FBTSxLQUFLakUsYUFBWCxFQUEwQjBELEtBQTFCLENBQWxCLEVBQW9EO0FBQ2xELGFBQU8sS0FBSzFELGFBQUwsQ0FBbUIwRCxLQUFuQixFQUEwQmhDLElBQUksQ0FBQ1ksS0FBL0IsQ0FBUDtBQUNEOztBQUNELFFBQUksQ0FBQ3FCLGNBQUwsRUFBcUI7QUFDbkI5QyxzQkFBSUMsS0FBSixDQUFXLDZDQUE0Q3VCLE1BQU8sUUFBT3FCLEtBQUssR0FBSSxJQUFHQSxLQUFNLEdBQWIsR0FBa0IsWUFBYSxVQUF6RztBQUNEO0FBQ0Y7O0FBRURRLEVBQUFBLHVCQUF1QixDQUFFTixvQkFBRixFQUF3QjtBQUM3QyxTQUFLQSxvQkFBTCxHQUE0QkEsb0JBQTVCO0FBQ0Q7O0FBRURPLEVBQUFBLHlCQUF5QixDQUFFTixtQkFBRixFQUF1QjtBQUM5QyxTQUFLQSxtQkFBTCxHQUEyQkEsbUJBQTNCO0FBQ0Q7O0FBRURPLEVBQUFBLHlCQUF5QixDQUFFSixtQkFBRixFQUF1QjtBQUM5QyxTQUFLQSxtQkFBTCxHQUEyQkEsbUJBQTNCO0FBQ0Q7O0FBbE04RDs7OztBQXNNakUsTUFBTW5CLGdCQUFOLFNBQStCd0IsaUJBQS9CLENBQXdDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgeyBSRU1PVEVfREVCVUdHRVJfUE9SVCwgUlBDX1JFU1BPTlNFX1RJTUVPVVRfTVMgfSBmcm9tICcuL3JlbW90ZS1kZWJ1Z2dlcic7XG5pbXBvcnQgUmVtb3RlTWVzc2FnZXMgZnJvbSAnLi9yZW1vdGUtbWVzc2FnZXMnO1xuaW1wb3J0IFdlYlNvY2tldCBmcm9tICd3cyc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IGV2ZW50cyBmcm9tICdldmVudHMnO1xuaW1wb3J0IHsgc2ltcGxlU3RyaW5naWZ5IH0gZnJvbSAnLi9oZWxwZXJzJztcbmltcG9ydCBFUzZFcnJvciBmcm9tICdlczYtZXJyb3InO1xuaW1wb3J0IHsgdXRpbCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcblxuXG5jb25zdCBEQVRBX0xPR19MRU5HVEggPSB7bGVuZ3RoOiAyMDB9O1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBXZWJLaXRScGNDbGllbnQgZXh0ZW5kcyBldmVudHMuRXZlbnRFbWl0dGVyIHtcbiAgY29uc3RydWN0b3IgKGhvc3QsIHBvcnQgPSBSRU1PVEVfREVCVUdHRVJfUE9SVCwgcmVzcG9uc2VUaW1lb3V0ID0gUlBDX1JFU1BPTlNFX1RJTUVPVVRfTVMpIHtcbiAgICBzdXBlcigpO1xuXG4gICAgdGhpcy5ob3N0ID0gaG9zdCB8fCAnbG9jYWxob3N0JztcbiAgICB0aGlzLnBvcnQgPSBwb3J0O1xuXG4gICAgdGhpcy5yZXNwb25zZVRpbWVvdXQgPSByZXNwb25zZVRpbWVvdXQ7XG5cbiAgICB0aGlzLmN1ck1zZ0lkID0gMDtcblxuICAgIHRoaXMuZGF0YUhhbmRsZXJzID0ge307XG4gICAgdGhpcy5kYXRhTWV0aG9kcyA9IHt9O1xuICAgIHRoaXMuZXJyb3JIYW5kbGVycyA9IHt9O1xuXG4gICAgdGhpcy5yZW1vdGVNZXNzYWdlcyA9IG5ldyBSZW1vdGVNZXNzYWdlcygpO1xuICB9XG5cbiAgYXN5bmMgY29ubmVjdCAocGFnZUlkKSB7XG4gICAgcmV0dXJuIGF3YWl0IG5ldyBCKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIC8vIHdlIHdpbGwgb25seSByZXNvbHZlIHRoaXMgY2FsbCB3aGVuIHRoZSBzb2NrZXQgaXMgb3BlblxuICAgICAgLy8gV2ViS2l0IHVybFxuICAgICAgbGV0IHVybCA9IGB3czovLyR7dGhpcy5ob3N0fToke3RoaXMucG9ydH0vZGV2dG9vbHMvcGFnZS8ke3BhZ2VJZH1gO1xuICAgICAgdGhpcy5wYWdlSWRLZXkgPSBwYWdlSWQ7XG5cbiAgICAgIC8vIGNyZWF0ZSBhbmQgc2V0IHVwIHNvY2tldCB3aXRoIGFwcHJvcHJpYXRlIGV2ZW50IGhhbmRsZXJzXG4gICAgICB0aGlzLnNvY2tldCA9IG5ldyBXZWJTb2NrZXQodXJsKTtcbiAgICAgIHRoaXMuc29ja2V0Lm9uKCdvcGVuJywgKCkgPT4ge1xuICAgICAgICBsb2cuZGVidWcoYFdlYktpdCBkZWJ1Z2dlciB3ZWIgc29ja2V0IGNvbm5lY3RlZCB0byB1cmw6ICR7dXJsfWApO1xuICAgICAgICB0aGlzLmNvbm5lY3RlZCA9IHRydWU7XG4gICAgICAgIHJlc29sdmUoKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5zb2NrZXQub24oJ2Nsb3NlJywgKCkgPT4ge1xuICAgICAgICBsb2cuZGVidWcoJ1dlYktpdCByZW1vdGUgZGVidWdnZXIgc29ja2V0IGRpc2Nvbm5lY3RlZCcpO1xuICAgICAgICB0aGlzLmNvbm5lY3RlZCA9IGZhbHNlO1xuICAgICAgfSk7XG4gICAgICB0aGlzLnNvY2tldC5vbignZXJyb3InLCAoZXhjZXB0aW9uKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmNvbm5lY3RlZCkge1xuICAgICAgICAgIGxvZy5kZWJ1ZyhgV2ViS2l0IGRlYnVnZ2VyIHdlYiBzb2NrZXQgZXJyb3I6ICR7ZXhjZXB0aW9uLm1lc3NhZ2V9YCk7XG4gICAgICAgICAgdGhpcy5jb25uZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlamVjdChleGNlcHRpb24pO1xuICAgICAgfSk7XG4gICAgICB0aGlzLnNvY2tldC5vbignbWVzc2FnZScsIHRoaXMucmVjZWl2ZS5iaW5kKHRoaXMpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGRpc2Nvbm5lY3QgKCkge1xuICAgIGxvZy5kZWJ1ZygnRGlzY29ubmVjdGluZyBmcm9tIFdlYktpdCByZW1vdGUgZGVidWdnZXInKTtcbiAgICBpZiAodGhpcy5pc0Nvbm5lY3RlZCgpKSB7XG4gICAgICB0aGlzLnNvY2tldC5jbG9zZSgxMDAxKTtcbiAgICB9XG4gICAgdGhpcy5jb25uZWN0ZWQgPSBmYWxzZTtcbiAgfVxuXG4gIGlzQ29ubmVjdGVkICgpIHtcbiAgICByZXR1cm4gKHRoaXMuc29ja2V0ICE9PSBudWxsICYmIHRoaXMuY29ubmVjdGVkKTtcbiAgfVxuXG4gIGFzeW5jIHNlbmQgKGNvbW1hbmQsIG9wdHMgPSB7fSkge1xuICAgIGxldCBkYXRhID0gdGhpcy5yZW1vdGVNZXNzYWdlcy5nZXRSZW1vdGVDb21tYW5kKGNvbW1hbmQsIF8uZGVmYXVsdHMoe2Nvbm5JZDogdGhpcy5jb25uSWQsIHNlbmRlcklkOiB0aGlzLnNlbmRlcklkfSwgb3B0cykpO1xuXG4gICAgbG9nLmRlYnVnKGBTZW5kaW5nIFdlYktpdCBkYXRhOiAke18udHJ1bmNhdGUoSlNPTi5zdHJpbmdpZnkoZGF0YSksIERBVEFfTE9HX0xFTkdUSCl9YCk7XG4gICAgbG9nLmRlYnVnKGBXZWJraXQgcmVzcG9uc2UgdGltZW91dDogJHt0aGlzLnJlc3BvbnNlVGltZW91dH1gKTtcblxuICAgIHRoaXMuY3VyTXNnSWQrKztcbiAgICBkYXRhLmlkID0gdGhpcy5jdXJNc2dJZDtcblxuICAgIGNvbnN0IGlkID0gdGhpcy5jdXJNc2dJZC50b1N0cmluZygpO1xuICAgIHJldHVybiBhd2FpdCBuZXcgQigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAvLyBvbmx5IHJlc29sdmUgdGhlIHNlbmQgY29tbWFuZCB3aGVuIFdlYktpdCByZXR1cm5zIGEgcmVzcG9uc2VcbiAgICAgIC8vIHN0b3JlIHRoZSBoYW5kbGVyIGFuZCB0aGUgZGF0YSBzZW50XG4gICAgICB0aGlzLmRhdGFIYW5kbGVyc1tpZF0gPSByZXNvbHZlO1xuICAgICAgdGhpcy5kYXRhTWV0aG9kc1tpZF0gPSBkYXRhLm1ldGhvZDtcbiAgICAgIHRoaXMuZXJyb3JIYW5kbGVyc1tpZF0gPSByZWplY3Q7XG5cbiAgICAgIC8vIHNlbmQgdGhlIGRhdGFcbiAgICAgIHRoaXMuc29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoZGF0YSksIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICBpZiAodXRpbC5oYXNWYWx1ZShlcnJvcikpIHtcbiAgICAgICAgICBsb2cuZGVidWcoYFdlYktpdCBzb2NrZXQgZXJyb3Igb2NjdXJyZWQ6ICR7ZXJyb3J9YCk7XG4gICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcihlcnJvcikpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KS5jYXRjaCgoZSkgPT4ge1xuICAgICAgaWYgKGUuY29uc3RydWN0b3IubmFtZSAhPT0gV2ViS2l0UlBDV2FybmluZy5uYW1lKSB7XG4gICAgICAgIHRocm93IGU7XG4gICAgICB9XG4gICAgICBsb2cud2FybihlLm1lc3NhZ2UpO1xuICAgICAgcmV0dXJuIEIucmVzb2x2ZShudWxsKTtcbiAgICB9KS5maW5hbGx5KChyZXMpID0+IHtcbiAgICAgIC8vIG5vIG5lZWQgdG8gaG9sZCBvbnRvIGFueXRoaW5nXG4gICAgICBkZWxldGUgdGhpcy5kYXRhSGFuZGxlcnNbaWRdO1xuICAgICAgZGVsZXRlIHRoaXMuZGF0YU1ldGhvZHNbaWRdO1xuICAgICAgZGVsZXRlIHRoaXMuZXJyb3JIYW5kbGVyc1tpZF07XG5cbiAgICAgIC8vIGFuZCBwYXNzIGFsb25nIHRoZSByZXN1bHRcbiAgICAgIHJldHVybiByZXM7XG4gICAgfSkudGltZW91dCh0aGlzLnJlc3BvbnNlVGltZW91dCk7XG4gIH1cblxuICByZWNlaXZlIChkYXRhKSB7XG4gICAgbG9nLmRlYnVnKGBSZWNlaXZlZCBXZWJLaXQgZGF0YTogJyR7Xy50cnVuY2F0ZShkYXRhLCBEQVRBX0xPR19MRU5HVEgpfSdgKTtcbiAgICBkYXRhID0gdXRpbC5zYWZlSnNvblBhcnNlKGRhdGEpO1xuXG4gICAgY29uc3QgcmVqZWN0Q2FsbCA9IChlcnJvcikgPT4ge1xuICAgICAgaWYgKGRhdGEgJiYgdGhpcy5lcnJvckhhbmRsZXJzW2RhdGEuaWRdKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmVycm9ySGFuZGxlcnNbZGF0YS5pZF0oZXJyb3IpO1xuICAgICAgfVxuXG4gICAgICBpZiAoZXJyb3IuY29uc3RydWN0b3IubmFtZSA9PT0gV2ViS2l0UlBDV2FybmluZy5uYW1lKSB7XG4gICAgICAgIGxvZy53YXJuKGVycm9yLm1lc3NhZ2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9nLmVycm9yQW5kVGhyb3coZXJyb3IpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBpZiAoIV8uaXNQbGFpbk9iamVjdChkYXRhKSkge1xuICAgICAgcmV0dXJuIHJlamVjdENhbGwobmV3IFdlYktpdFJQQ1dhcm5pbmcoYE5vIHBhcnNlYWJsZSBkYXRhIGZvdW5kYCkpO1xuICAgIH1cblxuICAgIC8vIHdlIGNhbiBnZXQgYW4gZXJyb3IsIG9yIHdlIGNhbiBnZXQgYSByZXNwb25zZSB0aGF0IGlzIGFuIGVycm9yXG4gICAgaWYgKGRhdGEud2FzVGhyb3duIHx8IChkYXRhLnJlc3VsdCAmJiBkYXRhLnJlc3VsdC53YXNUaHJvd24pKSB7XG4gICAgICBjb25zdCBtZXNzYWdlID0gZGF0YS53YXNUaHJvd25cbiAgICAgICAgPyBkYXRhLnJlc3VsdC52YWx1ZSB8fCBkYXRhLnJlc3VsdC5kZXNjcmlwdGlvblxuICAgICAgICA6IGRhdGEucmVzdWx0LnJlc3VsdC52YWx1ZSB8fCBkYXRhLnJlc3VsdC5yZXN1bHQuZGVzY3JpcHRpb247XG4gICAgICByZXR1cm4gcmVqZWN0Q2FsbChuZXcgRXJyb3IobWVzc2FnZSkpO1xuICAgIH1cblxuICAgIGNvbnN0IG1zZ0lkID0gZGF0YS5pZDtcbiAgICAvLyB3aGVuIHNlbmRpbmcgd2Ugc2V0IGEgZGF0YSBtZXRob2QgYW5kIGFzc29jaWF0ZWQgY2FsbGJhY2suXG4gICAgLy8gZ2V0IHRoYXQsIG9yIHRoZSBnZW5lcmljIChhdXRvbWF0aWNhbGx5IHNlbnQsIG5vdCBhc3NvY2lhdGVkXG4gICAgLy8gd2l0aCBhIHBhcnRpY3VsYXIgcmVxdWVzdCkgbWV0aG9kXG4gICAgY29uc3QgbWV0aG9kID0gdGhpcy5kYXRhTWV0aG9kc1ttc2dJZF0gfHwgZGF0YS5tZXRob2Q7XG4gICAgaWYgKCFtZXRob2QpIHtcbiAgICAgIHJldHVybiByZWplY3RDYWxsKFxuICAgICAgICBuZXcgV2ViS2l0UlBDV2FybmluZyhgRGlkIG5vdCBmaW5kIGFueSBoYW5kbGVycyBmb3IgJHttc2dJZCA/IGAnJHttc2dJZH0nYCA6ICd0aGUgcmVjZW50J30gbWVzc2FnZWApKTtcbiAgICB9XG4gICAgbG9nLmRlYnVnKGBGb3VuZCBtZXRob2QgJyR7bWV0aG9kfScke21zZ0lkID8gYCBmb3IgJyR7bXNnSWR9JyBtZXNzYWdlYCA6ICcnfWApO1xuICAgIGxldCBpc0V2ZW50SGFuZGxlZCA9IGZhbHNlO1xuICAgIHN3aXRjaCAobWV0aG9kKSB7XG4gICAgICBjYXNlICdQcm9maWxlci5yZXNldFByb2ZpbGVzJzpcbiAgICAgICAgbG9nLmRlYnVnKCdEZXZpY2UgaXMgdGVsbGluZyB1cyB0byByZXNldCBwcm9maWxlcy4gU2hvdWxkIHByb2JhYmx5ICcgK1xuICAgICAgICAgICAgICAgICAgJ2RvIHNvbWUga2luZCBvZiBjYWxsYmFjayBoZXJlJyk7XG4gICAgICAgIGlzRXZlbnRIYW5kbGVkID0gdHJ1ZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdUaW1lbGluZS5ldmVudFJlY29yZGVkJzpcbiAgICAgICAgaWYgKHRoaXMudGltZWxpbmVFdmVudEhhbmRsZXIpIHtcbiAgICAgICAgICB0aGlzLnRpbWVsaW5lRXZlbnRIYW5kbGVyKGRhdGEucmVzdWx0KTtcbiAgICAgICAgICBpc0V2ZW50SGFuZGxlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdDb25zb2xlLm1lc3NhZ2VBZGRlZCc6XG4gICAgICAgIGlmICh0aGlzLmNvbnNvbGVFdmVudEhhbmRsZXIpIHtcbiAgICAgICAgICB0aGlzLmNvbnNvbGVFdmVudEhhbmRsZXIoZGF0YS5wYXJhbXMubWVzc2FnZSk7XG4gICAgICAgICAgaXNFdmVudEhhbmRsZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnUGFnZS5uYXZpZ2F0ZSc6XG4gICAgICAgIGxvZy5kZWJ1ZyhgUmVjZWl2ZWQgcGFnZSBuYXZpZ2F0ZWQgbWVzc2FnZTogJHtzaW1wbGVTdHJpbmdpZnkoZGF0YSl9YCk7XG4gICAgICAgIGlzRXZlbnRIYW5kbGVkID0gdHJ1ZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdOZXR3b3JrLmRhdGFSZWNlaXZlZCc6XG4gICAgICBjYXNlICdOZXR3b3JrLnJlcXVlc3RXaWxsQmVTZW50JzpcbiAgICAgIGNhc2UgJ05ldHdvcmsucmVzcG9uc2VSZWNlaXZlZCc6XG4gICAgICBjYXNlICdOZXR3b3JrLmxvYWRpbmdGaW5pc2hlZCc6XG4gICAgICBjYXNlICdOZXR3b3JrLmxvYWRpbmdGYWlsZWQnOlxuICAgICAgICBpZiAoXy5pc0Z1bmN0aW9uKHRoaXMubmV0d29ya0V2ZW50SGFuZGxlcikpIHtcbiAgICAgICAgICB0aGlzLm5ldHdvcmtFdmVudEhhbmRsZXIobWV0aG9kLCBkYXRhLnBhcmFtcyk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBpZiAoIWRhdGEuZXJyb3IgJiYgXy5oYXModGhpcy5kYXRhSGFuZGxlcnMsIG1zZ0lkKSkge1xuICAgICAgcmV0dXJuIHRoaXMuZGF0YUhhbmRsZXJzW21zZ0lkXShkYXRhLnJlc3VsdCk7XG4gICAgfVxuICAgIGlmIChkYXRhLmVycm9yICYmIF8uaGFzKHRoaXMuZXJyb3JIYW5kbGVycywgbXNnSWQpKSB7XG4gICAgICByZXR1cm4gdGhpcy5lcnJvckhhbmRsZXJzW21zZ0lkXShkYXRhLmVycm9yKTtcbiAgICB9XG4gICAgaWYgKCFpc0V2ZW50SGFuZGxlZCkge1xuICAgICAgbG9nLmRlYnVnKGBUaGVyZSBpcyBubyBoYW5kbGVyIHNjaGVkdWxlZCBmb3IgbWV0aG9kICcke21ldGhvZH0nIGluICR7bXNnSWQgPyBgJyR7bXNnSWR9J2AgOiAndGhlIHJlY2VudCd9IG1lc3NhZ2VgKTtcbiAgICB9XG4gIH1cblxuICBzZXRUaW1lbGluZUV2ZW50SGFuZGxlciAodGltZWxpbmVFdmVudEhhbmRsZXIpIHtcbiAgICB0aGlzLnRpbWVsaW5lRXZlbnRIYW5kbGVyID0gdGltZWxpbmVFdmVudEhhbmRsZXI7XG4gIH1cblxuICBzZXRDb25zb2xlTG9nRXZlbnRIYW5kbGVyIChjb25zb2xlRXZlbnRIYW5kbGVyKSB7XG4gICAgdGhpcy5jb25zb2xlRXZlbnRIYW5kbGVyID0gY29uc29sZUV2ZW50SGFuZGxlcjtcbiAgfVxuXG4gIHNldE5ldHdvcmtMb2dFdmVudEhhbmRsZXIgKG5ldHdvcmtFdmVudEhhbmRsZXIpIHtcbiAgICB0aGlzLm5ldHdvcmtFdmVudEhhbmRsZXIgPSBuZXR3b3JrRXZlbnRIYW5kbGVyO1xuICB9XG59XG5cblxuY2xhc3MgV2ViS2l0UlBDV2FybmluZyBleHRlbmRzIEVTNkVycm9yIHt9XG4iXSwiZmlsZSI6ImxpYi93ZWJraXQtcnBjLWNsaWVudC5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
