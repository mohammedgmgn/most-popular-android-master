'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.RemoteMessages = void 0;

require("source-map-support/register");

var _remoteDebugger = require("./remote-debugger");

var _lodash = _interopRequireDefault(require("lodash"));

class RemoteMessages {
  constructor(targetBased = false) {
    this.targetBased = targetBased;
  }

  setConnectionKey(connId) {
    return {
      __argument: {
        WIRConnectionIdentifierKey: connId
      },
      __selector: '_rpc_reportIdentifier:'
    };
  }

  connectToApp(connId, appIdKey) {
    return {
      __argument: {
        WIRConnectionIdentifierKey: connId,
        WIRApplicationIdentifierKey: appIdKey
      },
      __selector: '_rpc_forwardGetListing:'
    };
  }

  setSenderKey(connId, senderId, appIdKey, pageIdKey) {
    return {
      __argument: {
        WIRApplicationIdentifierKey: appIdKey,
        WIRConnectionIdentifierKey: connId,
        WIRSenderKey: senderId,
        WIRPageIdentifierKey: pageIdKey,
        WIRAutomaticallyPause: false
      },
      __selector: '_rpc_forwardSocketSetup:'
    };
  }

  indicateWebView(connId, appIdKey, pageIdKey, opts) {
    const {
      enabled
    } = opts;
    return {
      __argument: {
        WIRApplicationIdentifierKey: appIdKey,
        WIRIndicateEnabledKey: _lodash.default.isUndefined(enabled) ? true : enabled,
        WIRConnectionIdentifierKey: connId,
        WIRPageIdentifierKey: pageIdKey
      },
      __selector: '_rpc_forwardIndicateWebView:'
    };
  }

  getFullCommand(connId, senderId, appIdKey, pageIdKey, debuggerType, method, params) {
    const [realMethod, realParams] = this.targetBased ? ['Target.sendMessageToTarget', {
      message: {
        method,
        params
      }
    }] : [method, params];
    return this.command(realMethod, realParams, appIdKey, connId, senderId, pageIdKey, debuggerType);
  }

  sendJSCommand(connId, senderId, appIdKey, pageIdKey, debuggerType, opts = {}) {
    const method = 'Runtime.evaluate';
    const params = {
      expression: opts.command,
      returnByValue: true
    };
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, debuggerType, method, params);
  }

  callJSFunction(connId, senderId, appIdKey, pageIdKey, debuggerType, opts = {}) {
    const method = 'Runtime.callFunctionOn';
    const params = {
      objectId: opts.objId,
      functionDeclaration: opts.fn,
      arguments: opts.args,
      returnByValue: true
    };
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, debuggerType, method, params);
  }

  setUrl(connId, senderId, appIdKey, pageIdKey, debuggerType, opts = {}) {
    const method = 'Page.navigate';
    const params = {
      url: opts.url
    };
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, debuggerType, method, params);
  }

  enablePage(connId, senderId, appIdKey, pageIdKey, debuggerType) {
    const method = 'Page.enable';
    const params = {};
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, debuggerType, method, params);
  }

  startTimeline(connId, senderId, appIdKey, pageIdKey, debuggerType) {
    const method = 'Timeline.start';
    const params = {};
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, debuggerType, method, params);
  }

  stopTimeline(connId, senderId, appIdKey, pageIdKey, debuggerType) {
    const method = 'Timeline.stop';
    const params = {};
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, debuggerType, method, params);
  }

  startConsole(connId, senderId, appIdKey, pageIdKey, debuggerType) {
    const method = 'Console.enable';
    const params = {};
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, debuggerType, method, params);
  }

  stopConsole(connId, senderId, appIdKey, pageIdKey, debuggerType) {
    const method = 'Console.disable';
    const params = {};
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, debuggerType, method, params);
  }

  startNetwork(connId, senderId, appIdKey, pageIdKey, debuggerType) {
    const method = 'Network.enable';
    const params = {};
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, debuggerType, method, params);
  }

  stopNetwork(connId, senderId, appIdKey, pageIdKey, debuggerType) {
    const method = 'Network.disable';
    const params = {};
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, debuggerType, method, params);
  }

  getCookies(connId, senderId, appIdKey, pageIdKey, debuggerType, opts = {}) {
    const method = 'Page.getCookies';
    const params = {
      urls: opts.url
    };
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, debuggerType, method, params);
  }

  deleteCookie(connId, senderId, appIdKey, pageIdKey, debuggerType, opts = {}) {
    const method = 'Page.deleteCookie';
    const params = {
      cookieName: opts.cookieName,
      url: opts.url
    };
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, debuggerType, method, params);
  }

  garbageCollect(connId, senderId, appIdKey, pageIdKey, debuggerType) {
    const method = 'Heap.gc';
    const params = {};
    return this.getFullCommand(connId, senderId, appIdKey, pageIdKey, debuggerType, method, params);
  }

  command(method, params, appIdKey, connId, senderId, pageIdKey, debuggerType) {
    if (debuggerType !== null && debuggerType === _remoteDebugger.DEBUGGER_TYPES.webkit) {
      return this.commandWebKit(method, params);
    } else {
      return this.commandWebInspector(method, params, appIdKey, connId, senderId, pageIdKey);
    }
  }

  commandWebInspector(method, params, appIdKey, connId, senderId, pageIdKey) {
    let plist = {
      __argument: {
        WIRApplicationIdentifierKey: appIdKey,
        WIRSocketDataKey: {
          method,
          params: {
            objectGroup: 'console',
            includeCommandLineAPI: true,
            doNotPauseOnExceptionsAndMuteConsole: true
          }
        },
        WIRConnectionIdentifierKey: connId,
        WIRSenderKey: senderId,
        WIRPageIdentifierKey: pageIdKey,
        WIRAutomaticallyPause: true
      },
      __selector: '_rpc_forwardSocketData:'
    };

    if (params) {
      plist.__argument.WIRSocketDataKey.params = _lodash.default.extend(plist.__argument.WIRSocketDataKey.params, params);
    }

    return plist;
  }

  commandWebKit(method, params) {
    let jsonRequest = {
      method,
      params: {
        objectGroup: 'console',
        includeCommandLineAPI: true,
        doNotPauseOnExceptionsAndMuteConsole: true
      }
    };

    if (params) {
      jsonRequest.params = _lodash.default.extend(jsonRequest.params, params);
    }

    return jsonRequest;
  }

  getRemoteCommand(command, opts) {
    let cmd;
    const {
      connId,
      appIdKey,
      senderId,
      pageIdKey,
      debuggerType
    } = opts;

    switch (command) {
      case 'setConnectionKey':
        cmd = this.setConnectionKey(connId);
        break;

      case 'connectToApp':
        cmd = this.connectToApp(connId, appIdKey);
        break;

      case 'setSenderKey':
        cmd = this.setSenderKey(connId, senderId, appIdKey, pageIdKey);
        break;

      case 'indicateWebView':
        cmd = this.indicateWebView(connId, appIdKey, pageIdKey, opts);
        break;

      case 'sendJSCommand':
        cmd = this.sendJSCommand(connId, senderId, appIdKey, pageIdKey, debuggerType, opts);
        break;

      case 'callJSFunction':
        cmd = this.callJSFunction(connId, senderId, appIdKey, pageIdKey, debuggerType, opts);
        break;

      case 'setUrl':
        cmd = this.setUrl(connId, senderId, appIdKey, pageIdKey, debuggerType, opts);
        break;

      case 'enablePage':
        cmd = this.enablePage(connId, senderId, appIdKey, pageIdKey, debuggerType);
        break;

      case 'startTimeline':
        cmd = this.startTimeline(connId, senderId, appIdKey, pageIdKey, debuggerType);
        break;

      case 'stopTimeline':
        cmd = this.stopTimeline(connId, senderId, appIdKey, pageIdKey, debuggerType);
        break;

      case 'startConsole':
        cmd = this.startConsole(connId, senderId, appIdKey, pageIdKey, debuggerType);
        break;

      case 'stopConsole':
        cmd = this.stopConsole(connId, senderId, appIdKey, pageIdKey, debuggerType);
        break;

      case 'startNetwork':
        cmd = this.startNetwork(connId, senderId, appIdKey, pageIdKey, debuggerType);
        break;

      case 'stopNetwork':
        cmd = this.stopNetwork(connId, senderId, appIdKey, pageIdKey, debuggerType);
        break;

      case 'getCookies':
        cmd = this.getCookies(connId, senderId, appIdKey, pageIdKey, debuggerType, opts);
        break;

      case 'deleteCookie':
        cmd = this.deleteCookie(connId, senderId, appIdKey, pageIdKey, debuggerType, opts);
        break;

      case 'garbageCollect':
        cmd = this.garbageCollect(connId, senderId, appIdKey, pageIdKey, debuggerType);
        break;

      default:
        throw new Error(`Unknown command: ${command}`);
    }

    return cmd;
  }

}

exports.RemoteMessages = RemoteMessages;
var _default = RemoteMessages;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9yZW1vdGUtbWVzc2FnZXMuanMiXSwibmFtZXMiOlsiUmVtb3RlTWVzc2FnZXMiLCJjb25zdHJ1Y3RvciIsInRhcmdldEJhc2VkIiwic2V0Q29ubmVjdGlvbktleSIsImNvbm5JZCIsIl9fYXJndW1lbnQiLCJXSVJDb25uZWN0aW9uSWRlbnRpZmllcktleSIsIl9fc2VsZWN0b3IiLCJjb25uZWN0VG9BcHAiLCJhcHBJZEtleSIsIldJUkFwcGxpY2F0aW9uSWRlbnRpZmllcktleSIsInNldFNlbmRlcktleSIsInNlbmRlcklkIiwicGFnZUlkS2V5IiwiV0lSU2VuZGVyS2V5IiwiV0lSUGFnZUlkZW50aWZpZXJLZXkiLCJXSVJBdXRvbWF0aWNhbGx5UGF1c2UiLCJpbmRpY2F0ZVdlYlZpZXciLCJvcHRzIiwiZW5hYmxlZCIsIldJUkluZGljYXRlRW5hYmxlZEtleSIsIl8iLCJpc1VuZGVmaW5lZCIsImdldEZ1bGxDb21tYW5kIiwiZGVidWdnZXJUeXBlIiwibWV0aG9kIiwicGFyYW1zIiwicmVhbE1ldGhvZCIsInJlYWxQYXJhbXMiLCJtZXNzYWdlIiwiY29tbWFuZCIsInNlbmRKU0NvbW1hbmQiLCJleHByZXNzaW9uIiwicmV0dXJuQnlWYWx1ZSIsImNhbGxKU0Z1bmN0aW9uIiwib2JqZWN0SWQiLCJvYmpJZCIsImZ1bmN0aW9uRGVjbGFyYXRpb24iLCJmbiIsImFyZ3VtZW50cyIsImFyZ3MiLCJzZXRVcmwiLCJ1cmwiLCJlbmFibGVQYWdlIiwic3RhcnRUaW1lbGluZSIsInN0b3BUaW1lbGluZSIsInN0YXJ0Q29uc29sZSIsInN0b3BDb25zb2xlIiwic3RhcnROZXR3b3JrIiwic3RvcE5ldHdvcmsiLCJnZXRDb29raWVzIiwidXJscyIsImRlbGV0ZUNvb2tpZSIsImNvb2tpZU5hbWUiLCJnYXJiYWdlQ29sbGVjdCIsIkRFQlVHR0VSX1RZUEVTIiwid2Via2l0IiwiY29tbWFuZFdlYktpdCIsImNvbW1hbmRXZWJJbnNwZWN0b3IiLCJwbGlzdCIsIldJUlNvY2tldERhdGFLZXkiLCJvYmplY3RHcm91cCIsImluY2x1ZGVDb21tYW5kTGluZUFQSSIsImRvTm90UGF1c2VPbkV4Y2VwdGlvbnNBbmRNdXRlQ29uc29sZSIsImV4dGVuZCIsImpzb25SZXF1ZXN0IiwiZ2V0UmVtb3RlQ29tbWFuZCIsImNtZCIsIkVycm9yIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7QUFFQTs7QUFDQTs7QUFHQSxNQUFNQSxjQUFOLENBQXFCO0FBQ25CQyxFQUFBQSxXQUFXLENBQUVDLFdBQVcsR0FBRyxLQUFoQixFQUF1QjtBQUNoQyxTQUFLQSxXQUFMLEdBQW1CQSxXQUFuQjtBQUNEOztBQU1EQyxFQUFBQSxnQkFBZ0IsQ0FBRUMsTUFBRixFQUFVO0FBQ3hCLFdBQU87QUFDTEMsTUFBQUEsVUFBVSxFQUFFO0FBQ1ZDLFFBQUFBLDBCQUEwQixFQUFFRjtBQURsQixPQURQO0FBSUxHLE1BQUFBLFVBQVUsRUFBRTtBQUpQLEtBQVA7QUFNRDs7QUFFREMsRUFBQUEsWUFBWSxDQUFFSixNQUFGLEVBQVVLLFFBQVYsRUFBb0I7QUFDOUIsV0FBTztBQUNMSixNQUFBQSxVQUFVLEVBQUU7QUFDVkMsUUFBQUEsMEJBQTBCLEVBQUVGLE1BRGxCO0FBRVZNLFFBQUFBLDJCQUEyQixFQUFFRDtBQUZuQixPQURQO0FBS0xGLE1BQUFBLFVBQVUsRUFBRTtBQUxQLEtBQVA7QUFPRDs7QUFFREksRUFBQUEsWUFBWSxDQUFFUCxNQUFGLEVBQVVRLFFBQVYsRUFBb0JILFFBQXBCLEVBQThCSSxTQUE5QixFQUF5QztBQUNuRCxXQUFPO0FBQ0xSLE1BQUFBLFVBQVUsRUFBRTtBQUNWSyxRQUFBQSwyQkFBMkIsRUFBRUQsUUFEbkI7QUFFVkgsUUFBQUEsMEJBQTBCLEVBQUVGLE1BRmxCO0FBR1ZVLFFBQUFBLFlBQVksRUFBRUYsUUFISjtBQUlWRyxRQUFBQSxvQkFBb0IsRUFBRUYsU0FKWjtBQUtWRyxRQUFBQSxxQkFBcUIsRUFBRTtBQUxiLE9BRFA7QUFRTFQsTUFBQUEsVUFBVSxFQUFFO0FB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QWtDSCxRQUFsQyxFQUE0Q0ksU0FBNUMsRUFBdURXLFlBQXZELEVBQXFFTixJQUFyRSxDQUFOO0FBQ0E7O0FBQ0YsV0FBSyxjQUFMO0FBQ0VpRCxRQUFBQSxHQUFHLEdBQUcsS0FBS2YsWUFBTCxDQUFrQmhELE1BQWxCLEVBQTBCUSxRQUExQixFQUFvQ0gsUUFBcEMsRUFBOENJLFNBQTlDLEVBQXlEVyxZQUF6RCxFQUF1RU4sSUFBdkUsQ0FBTjtBQUNBOztBQUNGLFdBQUssZ0JBQUw7QUFDRWlELFFBQUFBLEdBQUcsR0FBRyxLQUFLYixjQUFMLENBQW9CbEQsTUFBcEIsRUFBNEJRLFFBQTVCLEVBQXNDSCxRQUF0QyxFQUFnREksU0FBaEQsRUFBMkRXLFlBQTNELENBQU47QUFDQTs7QUFDRjtBQUNFLGNBQU0sSUFBSTRDLEtBQUosQ0FBVyxvQkFBbUJ0QyxPQUFRLEVBQXRDLENBQU47QUFyREo7O0FBd0RBLFdBQU9xQyxHQUFQO0FBQ0Q7O0FBN1JrQjs7O2VBaVNObkUsYyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHsgREVCVUdHRVJfVFlQRVMgfSBmcm9tICcuL3JlbW90ZS1kZWJ1Z2dlcic7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuXG5cbmNsYXNzIFJlbW90ZU1lc3NhZ2VzIHtcbiAgY29uc3RydWN0b3IgKHRhcmdldEJhc2VkID0gZmFsc2UpIHtcbiAgICB0aGlzLnRhcmdldEJhc2VkID0gdGFyZ2V0QmFzZWQ7XG4gIH1cblxuICAvKlxuICAgKiBDb25uZWN0aW9uIGZ1bmN0aW9uc1xuICAgKi9cblxuICBzZXRDb25uZWN0aW9uS2V5IChjb25uSWQpIHtcbiAgICByZXR1cm4ge1xuICAgICAgX19hcmd1bWVudDoge1xuICAgICAgICBXSVJDb25uZWN0aW9uSWRlbnRpZmllcktleTogY29ubklkXG4gICAgICB9LFxuICAgICAgX19zZWxlY3RvcjogJ19ycGNfcmVwb3J0SWRlbnRpZmllcjonXG4gICAgfTtcbiAgfVxuXG4gIGNvbm5lY3RUb0FwcCAoY29ubklkLCBhcHBJZEtleSkge1xuICAgIHJldHVybiB7XG4gICAgICBfX2FyZ3VtZW50OiB7XG4gICAgICAgIFdJUkNvbm5lY3Rpb25JZGVudGlmaWVyS2V5OiBjb25uSWQsXG4gICAgICAgIFdJUkFwcGxpY2F0aW9uSWRlbnRpZmllcktleTogYXBwSWRLZXlcbiAgICAgIH0sXG4gICAgICBfX3NlbGVjdG9yOiAnX3JwY19mb3J3YXJkR2V0TGlzdGluZzonXG4gICAgfTtcbiAgfVxuXG4gIHNldFNlbmRlcktleSAoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSkge1xuICAgIHJldHVybiB7XG4gICAgICBfX2FyZ3VtZW50OiB7XG4gICAgICAgIFdJUkFwcGxpY2F0aW9uSWRlbnRpZmllcktleTogYXBwSWRLZXksXG4gICAgICAgIFdJUkNvbm5lY3Rpb25JZGVudGlmaWVyS2V5OiBjb25uSWQsXG4gICAgICAgIFdJUlNlbmRlcktleTogc2VuZGVySWQsXG4gICAgICAgIFdJUlBhZ2VJZGVudGlmaWVyS2V5OiBwYWdlSWRLZXksXG4gICAgICAgIFdJUkF1dG9tYXRpY2FsbHlQYXVzZTogZmFsc2VcbiAgICAgIH0sXG4gICAgICBfX3NlbGVjdG9yOiAnX3JwY19mb3J3YXJkU29ja2V0U2V0dXA6J1xuICAgIH07XG4gIH1cblxuICBpbmRpY2F0ZVdlYlZpZXcgKGNvbm5JZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgb3B0cykge1xuICAgIGNvbnN0IHtlbmFibGVkfSA9IG9wdHM7XG4gICAgcmV0dXJuIHtcbiAgICAgIF9fYXJndW1lbnQ6IHtcbiAgICAgICAgV0lSQXBwbGljYXRpb25JZGVudGlmaWVyS2V5OiBhcHBJZEtleSxcbiAgICAgICAgV0lSSW5kaWNhdGVFbmFibGVkS2V5OiBfLmlzVW5kZWZpbmVkKGVuYWJsZWQpID8gdHJ1ZSA6IGVuYWJsZWQsXG4gICAgICAgIFdJUkNvbm5lY3Rpb25JZGVudGlmaWVyS2V5OiBjb25uSWQsXG4gICAgICAgIFdJUlBhZ2VJZGVudGlmaWVyS2V5OiBwYWdlSWRLZXlcbiAgICAgIH0sXG4gICAgICBfX3NlbGVjdG9yOiAnX3JwY19mb3J3YXJkSW5kaWNhdGVXZWJWaWV3OidcbiAgICB9O1xuICB9XG5cblxuXG4gIC8qXG4gICAqIEFjdGlvbiBmdW5jdGlvbnNcbiAgICovXG5cbiAgZ2V0RnVsbENvbW1hbmQgKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSwgbWV0aG9kLCBwYXJhbXMpIHtcbiAgICBjb25zdCBbcmVhbE1ldGhvZCwgcmVhbFBhcmFtc10gPSB0aGlzLnRhcmdldEJhc2VkXG4gICAgICA/IFsnVGFyZ2V0LnNlbmRNZXNzYWdlVG9UYXJnZXQnLCB7bWVzc2FnZToge21ldGhvZCwgcGFyYW1zfX1dXG4gICAgICA6IFttZXRob2QsIHBhcmFtc107XG4gICAgcmV0dXJuIHRoaXMuY29tbWFuZChyZWFsTWV0aG9kLCByZWFsUGFyYW1zLCBhcHBJZEtleSwgY29ubklkLCBzZW5kZXJJZCwgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUpO1xuICB9XG5cbiAgc2VuZEpTQ29tbWFuZCAoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlLCBvcHRzID0ge30pIHtcbiAgICBjb25zdCBtZXRob2QgPSAnUnVudGltZS5ldmFsdWF0ZSc7XG4gICAgY29uc3QgcGFyYW1zID0ge1xuICAgICAgZXhwcmVzc2lvbjogb3B0cy5jb21tYW5kLFxuICAgICAgcmV0dXJuQnlWYWx1ZTogdHJ1ZSxcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLmdldEZ1bGxDb21tYW5kKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSwgbWV0aG9kLCBwYXJhbXMpO1xuICB9XG5cbiAgY2FsbEpTRnVuY3Rpb24gKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSwgb3B0cyA9IHt9KSB7XG4gICAgY29uc3QgbWV0aG9kID0gJ1J1bnRpbWUuY2FsbEZ1bmN0aW9uT24nO1xuICAgIGNvbnN0IHBhcmFtcyA9IHtcbiAgICAgIG9iamVjdElkOiBvcHRzLm9iaklkLFxuICAgICAgZnVuY3Rpb25EZWNsYXJhdGlvbjogb3B0cy5mbixcbiAgICAgIGFyZ3VtZW50czogb3B0cy5hcmdzLFxuICAgICAgcmV0dXJuQnlWYWx1ZTogdHJ1ZSxcbiAgICB9O1xuXG4gICAgcmV0dXJuIHRoaXMuZ2V0RnVsbENvbW1hbmQoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlLCBtZXRob2QsIHBhcmFtcyk7XG4gIH1cblxuICBzZXRVcmwgKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSwgb3B0cyA9IHt9KSB7XG4gICAgY29uc3QgbWV0aG9kID0gJ1BhZ2UubmF2aWdhdGUnO1xuICAgIGNvbnN0IHBhcmFtcyA9IHtcbiAgICAgIHVybDogb3B0cy51cmwsXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5nZXRGdWxsQ29tbWFuZChjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUsIG1ldGhvZCwgcGFyYW1zKTtcbiAgfVxuXG4gIGVuYWJsZVBhZ2UgKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSkge1xuICAgIGNvbnN0IG1ldGhvZCA9ICdQYWdlLmVuYWJsZSc7XG4gICAgY29uc3QgcGFyYW1zID0ge307XG4gICAgcmV0dXJuIHRoaXMuZ2V0RnVsbENvbW1hbmQoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlLCBtZXRob2QsIHBhcmFtcyk7XG4gIH1cblxuICBzdGFydFRpbWVsaW5lIChjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUpIHtcbiAgICBjb25zdCBtZXRob2QgPSAnVGltZWxpbmUuc3RhcnQnO1xuICAgIGNvbnN0IHBhcmFtcyA9IHt9O1xuICAgIHJldHVybiB0aGlzLmdldEZ1bGxDb21tYW5kKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSwgbWV0aG9kLCBwYXJhbXMpO1xuICB9XG5cbiAgc3RvcFRpbWVsaW5lIChjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUpIHtcbiAgICBjb25zdCBtZXRob2QgPSAnVGltZWxpbmUuc3RvcCc7XG4gICAgY29uc3QgcGFyYW1zID0ge307XG4gICAgcmV0dXJuIHRoaXMuZ2V0RnVsbENvbW1hbmQoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlLCBtZXRob2QsIHBhcmFtcyk7XG4gIH1cblxuICBzdGFydENvbnNvbGUgKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSkge1xuICAgIGNvbnN0IG1ldGhvZCA9ICdDb25zb2xlLmVuYWJsZSc7XG4gICAgY29uc3QgcGFyYW1zID0ge307XG4gICAgcmV0dXJuIHRoaXMuZ2V0RnVsbENvbW1hbmQoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlLCBtZXRob2QsIHBhcmFtcyk7XG4gIH1cblxuICBzdG9wQ29uc29sZSAoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlKSB7XG4gICAgY29uc3QgbWV0aG9kID0gJ0NvbnNvbGUuZGlzYWJsZSc7XG4gICAgY29uc3QgcGFyYW1zID0ge307XG4gICAgcmV0dXJuIHRoaXMuZ2V0RnVsbENvbW1hbmQoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlLCBtZXRob2QsIHBhcmFtcyk7XG4gIH1cblxuICBzdGFydE5ldHdvcmsgKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSkge1xuICAgIGNvbnN0IG1ldGhvZCA9ICdOZXR3b3JrLmVuYWJsZSc7XG4gICAgY29uc3QgcGFyYW1zID0ge307XG4gICAgcmV0dXJuIHRoaXMuZ2V0RnVsbENvbW1hbmQoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlLCBtZXRob2QsIHBhcmFtcyk7XG4gIH1cblxuICBzdG9wTmV0d29yayAoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlKSB7XG4gICAgY29uc3QgbWV0aG9kID0gJ05ldHdvcmsuZGlzYWJsZSc7XG4gICAgY29uc3QgcGFyYW1zID0ge307XG4gICAgcmV0dXJuIHRoaXMuZ2V0RnVsbENvbW1hbmQoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlLCBtZXRob2QsIHBhcmFtcyk7XG4gIH1cblxuICBnZXRDb29raWVzIChjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUsIG9wdHMgPSB7fSkge1xuICAgIGNvbnN0IG1ldGhvZCA9ICdQYWdlLmdldENvb2tpZXMnO1xuICAgIGNvbnN0IHBhcmFtcyA9IHtcbiAgICAgIHVybHM6IG9wdHMudXJsLFxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuZ2V0RnVsbENvbW1hbmQoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlLCBtZXRob2QsIHBhcmFtcyk7XG4gIH1cblxuICBkZWxldGVDb29raWUgKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSwgb3B0cyA9IHt9KSB7XG4gICAgY29uc3QgbWV0aG9kID0gJ1BhZ2UuZGVsZXRlQ29va2llJztcbiAgICBjb25zdCBwYXJhbXMgPSB7XG4gICAgICBjb29raWVOYW1lOiBvcHRzLmNvb2tpZU5hbWUsXG4gICAgICB1cmw6IG9wdHMudXJsLFxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuZ2V0RnVsbENvbW1hbmQoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlLCBtZXRob2QsIHBhcmFtcyk7XG4gIH1cblxuICBnYXJiYWdlQ29sbGVjdCAoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlKSB7XG4gICAgY29uc3QgbWV0aG9kID0gJ0hlYXAuZ2MnO1xuICAgIGNvbnN0IHBhcmFtcyA9IHt9O1xuICAgIHJldHVybiB0aGlzLmdldEZ1bGxDb21tYW5kKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSwgbWV0aG9kLCBwYXJhbXMpO1xuICB9XG5cblxuICAvKlxuICAgKiBJbnRlcm5hbCBmdW5jdGlvbnNcbiAgICovXG5cbiAgY29tbWFuZCAobWV0aG9kLCBwYXJhbXMsIGFwcElkS2V5LCBjb25uSWQsIHNlbmRlcklkLCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSkge1xuICAgIGlmIChkZWJ1Z2dlclR5cGUgIT09IG51bGwgJiYgZGVidWdnZXJUeXBlID09PSBERUJVR0dFUl9UWVBFUy53ZWJraXQpIHtcbiAgICAgIHJldHVybiB0aGlzLmNvbW1hbmRXZWJLaXQobWV0aG9kLCBwYXJhbXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5jb21tYW5kV2ViSW5zcGVjdG9yKG1ldGhvZCwgcGFyYW1zLCBhcHBJZEtleSwgY29ubklkLCBzZW5kZXJJZCwgcGFnZUlkS2V5KTtcbiAgICB9XG4gIH1cblxuICBjb21tYW5kV2ViSW5zcGVjdG9yIChtZXRob2QsIHBhcmFtcywgYXBwSWRLZXksIGNvbm5JZCwgc2VuZGVySWQsIHBhZ2VJZEtleSkge1xuICAgIGxldCBwbGlzdCA9IHtcbiAgICAgIF9fYXJndW1lbnQ6IHtcbiAgICAgICAgV0lSQXBwbGljYXRpb25JZGVudGlmaWVyS2V5OiBhcHBJZEtleSxcbiAgICAgICAgV0lSU29ja2V0RGF0YUtleToge1xuICAgICAgICAgIG1ldGhvZCxcbiAgICAgICAgICBwYXJhbXM6IHtcbiAgICAgICAgICAgIG9iamVjdEdyb3VwOiAnY29uc29sZScsXG4gICAgICAgICAgICBpbmNsdWRlQ29tbWFuZExpbmVBUEk6IHRydWUsXG4gICAgICAgICAgICBkb05vdFBhdXNlT25FeGNlcHRpb25zQW5kTXV0ZUNvbnNvbGU6IHRydWUsXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBXSVJDb25uZWN0aW9uSWRlbnRpZmllcktleTogY29ubklkLFxuICAgICAgICBXSVJTZW5kZXJLZXk6IHNlbmRlcklkLFxuICAgICAgICBXSVJQYWdlSWRlbnRpZmllcktleTogcGFnZUlkS2V5LFxuICAgICAgICBXSVJBdXRvbWF0aWNhbGx5UGF1c2U6IHRydWUsXG4gICAgICB9LFxuICAgICAgX19zZWxlY3RvcjogJ19ycGNfZm9yd2FyZFNvY2tldERhdGE6J1xuICAgIH07XG4gICAgaWYgKHBhcmFtcykge1xuICAgICAgcGxpc3QuX19hcmd1bWVudC5XSVJTb2NrZXREYXRhS2V5LnBhcmFtcyA9XG4gICAgICAgIF8uZXh0ZW5kKHBsaXN0Ll9fYXJndW1lbnQuV0lSU29ja2V0RGF0YUtleS5wYXJhbXMsIHBhcmFtcyk7XG4gICAgfVxuICAgIHJldHVybiBwbGlzdDtcbiAgfVxuXG4gIC8vZ2VuZXJhdGUgYSBqc29uIHJlcXVlc3QgdXNpbmcgdGhlIHdlYmtpdCBwcm90b2NvbFxuICBjb21tYW5kV2ViS2l0IChtZXRob2QsIHBhcmFtcykge1xuICAgIGxldCBqc29uUmVxdWVzdCA9IHtcbiAgICAgIG1ldGhvZCxcbiAgICAgIHBhcmFtczoge1xuICAgICAgICBvYmplY3RHcm91cDogJ2NvbnNvbGUnLFxuICAgICAgICBpbmNsdWRlQ29tbWFuZExpbmVBUEk6IHRydWUsXG4gICAgICAgIGRvTm90UGF1c2VPbkV4Y2VwdGlvbnNBbmRNdXRlQ29uc29sZTogdHJ1ZVxuICAgICAgfVxuICAgIH07XG4gICAgaWYgKHBhcmFtcykge1xuICAgICAgLy9pZiB0aGVyZSBhbnkgcGFyYW1ldGVycyBhZGQgdGhlbVxuICAgICAganNvblJlcXVlc3QucGFyYW1zID0gXy5leHRlbmQoanNvblJlcXVlc3QucGFyYW1zLCBwYXJhbXMpO1xuICAgIH1cbiAgICByZXR1cm4ganNvblJlcXVlc3Q7XG4gIH1cblxuICBnZXRSZW1vdGVDb21tYW5kIChjb21tYW5kLCBvcHRzKSB7XG4gICAgbGV0IGNtZDtcblxuICAgIGNvbnN0IHtcbiAgICAgIGNvbm5JZCxcbiAgICAgIGFwcElkS2V5LFxuICAgICAgc2VuZGVySWQsXG4gICAgICBwYWdlSWRLZXksXG4gICAgICBkZWJ1Z2dlclR5cGUsXG4gICAgfSA9IG9wdHM7XG5cbiAgICBzd2l0Y2ggKGNvbW1hbmQpIHtcbiAgICAgIGNhc2UgJ3NldENvbm5lY3Rpb25LZXknOlxuICAgICAgICBjbWQgPSB0aGlzLnNldENvbm5lY3Rpb25LZXkoY29ubklkKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdjb25uZWN0VG9BcHAnOlxuICAgICAgICBjbWQgPSB0aGlzLmNvbm5lY3RUb0FwcChjb25uSWQsIGFwcElkS2V5KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdzZXRTZW5kZXJLZXknOlxuICAgICAgICBjbWQgPSB0aGlzLnNldFNlbmRlcktleShjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdpbmRpY2F0ZVdlYlZpZXcnOlxuICAgICAgICBjbWQgPSB0aGlzLmluZGljYXRlV2ViVmlldyhjb25uSWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIG9wdHMpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3NlbmRKU0NvbW1hbmQnOlxuICAgICAgICBjbWQgPSB0aGlzLnNlbmRKU0NvbW1hbmQoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlLCBvcHRzKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdjYWxsSlNGdW5jdGlvbic6XG4gICAgICAgIGNtZCA9IHRoaXMuY2FsbEpTRnVuY3Rpb24oY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlLCBvcHRzKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdzZXRVcmwnOlxuICAgICAgICBjbWQgPSB0aGlzLnNldFVybChjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUsIG9wdHMpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2VuYWJsZVBhZ2UnOlxuICAgICAgICBjbWQgPSB0aGlzLmVuYWJsZVBhZ2UoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdzdGFydFRpbWVsaW5lJzpcbiAgICAgICAgY21kID0gdGhpcy5zdGFydFRpbWVsaW5lKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnc3RvcFRpbWVsaW5lJzpcbiAgICAgICAgY21kID0gdGhpcy5zdG9wVGltZWxpbmUoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdzdGFydENvbnNvbGUnOlxuICAgICAgICBjbWQgPSB0aGlzLnN0YXJ0Q29uc29sZShjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3N0b3BDb25zb2xlJzpcbiAgICAgICAgY21kID0gdGhpcy5zdG9wQ29uc29sZShjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3N0YXJ0TmV0d29yayc6XG4gICAgICAgIGNtZCA9IHRoaXMuc3RhcnROZXR3b3JrKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnc3RvcE5ldHdvcmsnOlxuICAgICAgICBjbWQgPSB0aGlzLnN0b3BOZXR3b3JrKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnZ2V0Q29va2llcyc6XG4gICAgICAgIGNtZCA9IHRoaXMuZ2V0Q29va2llcyhjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUsIG9wdHMpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2RlbGV0ZUNvb2tpZSc6XG4gICAgICAgIGNtZCA9IHRoaXMuZGVsZXRlQ29va2llKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSwgb3B0cyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnZ2FyYmFnZUNvbGxlY3QnOlxuICAgICAgICBjbWQgPSB0aGlzLmdhcmJhZ2VDb2xsZWN0KGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIGNvbW1hbmQ6ICR7Y29tbWFuZH1gKTtcbiAgICB9XG5cbiAgICByZXR1cm4gY21kO1xuICB9XG59XG5cbmV4cG9ydCB7IFJlbW90ZU1lc3NhZ2VzIH07XG5leHBvcnQgZGVmYXVsdCBSZW1vdGVNZXNzYWdlcztcbiJdLCJmaWxlIjoibGliL3JlbW90ZS1tZXNzYWdlcy5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
