"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.helpers = exports.commands = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _appiumBaseDriver = require("appium-base-driver");

var _appiumSupport = require("appium-support");

var _cookies = _interopRequireDefault(require("../cookies"));

var _logger = _interopRequireDefault(require("../logger"));

let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;
const ELEMENT_OFFSET = 5000;
const {
  W3C_WEB_ELEMENT_IDENTIFIER
} = _appiumSupport.util;

commands.setFrame = async function setFrame(frame) {
  if (!this.isWebContext()) {
    frame = frame ? frame : 'target.frontMostApp()';
    let command = `wd_frame = ${frame}`;
    return await this.uiAutoClient.sendCommand(command);
  }

  let atom;

  if (_lodash.default.isNull(frame)) {
    this.curWebFrames = [];

    _logger.default.debug('Leaving web frame and going back to default content');

    return;
  }

  if (helpers.hasElementId(frame)) {
    let atomsElement = this.useAtomsElement(helpers.getElementId(frame));
    let value = await this.executeAtom('get_frame_window', [atomsElement]);

    _logger.default.debug(`Entering new web frame: '${value.WINDOW}'`);

    this.curWebFrames.unshift(value.WINDOW);
  } else {
    atom = _lodash.default.isNumber(frame) ? 'frame_by_index' : 'frame_by_id_or_name';
    let value = await this.executeAtom(atom, [frame]);

    if (_lodash.default.isNull(value) || _lodash.default.isUndefined(value.WINDOW)) {
      throw new _appiumBaseDriver.errors.NoSuchFrameError();
    }

    _logger.default.debug(`Entering new web frame: '${value.WINDOW}'`);

    this.curWebFrames.unshift(value.WINDOW);
  }
};

commands.getCssProperty = async function getCssProperty(propertyName, el) {
  let atomsElement = this.useAtomsElement(el);
  return await this.executeAtom('get_value_of_css_property', [atomsElement, propertyName]);
};

commands.submit = async function submit(el) {
  if (this.isWebContext()) {
    let atomsElement = this.useAtomsElement(el);
    await this.executeAtom('submit', [atomsElement]);
  } else {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }
};

commands.refresh = async function refresh() {
  if (this.isWebContext()) {
    await this.executeAtom('refresh', []);
  } else {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }
};

commands.getUrl = async function getUrl() {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  let url = await this.remote.execute('window.location.href');
  return url;
};

commands.title = async function title() {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  return await this.executeAtom('title', [], true);
};

commands.getCookies = async function getCookies() {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  _logger.default.debug('Retrieving all cookies');

  let script = 'return document.cookie';
  let jsCookies = await this.executeAtom('execute_script', [script, []]);
  let cookies = [];

  try {
    for (let [name, value] of _lodash.default.toPairs(_cookies.default.createJWPCookie(undefined, jsCookies))) {
      cookies.push({
        name,
        value
      });
    }

    return cookies;
  } catch (err) {
    _logger.default.error(err);

    throw new _appiumBaseDriver.errors.UnknownError(`Error parsing cookies from result: '${jsCookies}'`);
  }
};

commands.setCookie = async function setCookie(cookie) {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  cookie = _lodash.default.clone(cookie);

  if (!cookie.path) {
    cookie.path = '/';
  }

  const jsCookie = _cookies.default.createJSCookie(cookie.name, cookie.value, {
    expires: _lodash.default.isNumber(cookie.expiry) ? new Date(cookie.expiry * 1000).toUTCString() : cookie.expiry,
    path: cookie.path,
    domain: cookie.domain,
    httpOnly: cookie.httpOnly,
    secure: cookie.secure
  });

  let script = `document.cookie = ${JSON.stringify(jsCookie)}`;
  await this.executeAtom('execute_script', [script, []]);
};

commands.deleteCookie = async function deleteCookie(cookieName) {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  let cookies = await this.getCookies();

  if (_lodash.default.indexOf(_lodash.default.map(cookies, 'name'), cookieName) === -1) {
    _logger.default.debug(`Cookie '${cookieName}' not found. Ignoring.`);

    return true;
  }

  return await this._deleteCookie(cookieName);
};

commands.deleteCookies = async function deleteCookies() {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  let cookies = await this.getCookies();

  if (cookies.length) {
    for (let cookie of cookies) {
      await this._deleteCookie(cookie.name);
    }
  }

  return true;
};

helpers._deleteCookie = async function _deleteCookie(cookieName) {
  _logger.default.debug(`Deleting cookie '${cookieName}'`);

  let webCookie = _cookies.default.expireCookie(cookieName, {
    path: '/'
  });

  let script = `document.cookie = ${JSON.stringify(webCookie)}`;
  await this.executeAtom('execute_script', [script, []]);
};

extensions.findWebElementOrElements = async function findWebElementOrElements(strategy, selector, many, ctx) {
  let atomsElement = this.getAtomsElement(ctx);
  let element;

  let doFind = async () => {
    element = await this.executeAtom(`find_element${many ? 's' : ''}`, [strategy, selector, atomsElement]);
    return !_lodash.default.isNull(element);
  };

  try {
    await this.implicitWaitForCondition(doFind);
  } catch (err) {
    if (err.message && _lodash.default.isFunction(err.message.match) && err.message.match(/Condition unmet/)) {
      element = [];
    } else {
      throw err;
    }
  }

  if (many) {
    return element;
  } else {
    if (!element || _lodash.default.size(element) === 0) {
      throw new _appiumBaseDriver.errors.NoSuchElementError();
    }

    return element;
  }
};

extensions.webFlickElement = async function webFlickElement(el, xoffset, yoffset) {
  let atomsElement = await this.useAtomsElement(el);
  let {
    x,
    y
  } = await this.executeAtom('get_top_left_coordinates', [atomsElement]);
  let {
    width,
    height
  } = await this.executeAtom('get_size', [atomsElement]);
  x = x + width / 2;
  y = y + height / 2;
  let from = await this.translateWebCoords({
    x,
    y
  });
  let to = await this.translateWebCoords({
    x: x + xoffset,
    y: y + yoffset
  });
  let args = {
    from,
    to
  };
  let command = `au.flick(${JSON.stringify(args)})`;
  await this.uiAutoClient.sendCommand(command);
};

extensions.mobileWebNav = async function mobileWebNav(navType) {
  this.remote.allowNavigationWithoutReload();
  await this.executeAtom('execute_script', [`history.${navType}();`, null]);
};

extensions.nativeWebTap = async function nativeWebTap(el) {
  let atomsElement = this.useAtomsElement(el);
  let {
    x,
    y
  } = await this.executeAtom('get_top_left_coordinates', [atomsElement]);
  let {
    width,
    height
  } = await this.executeAtom('get_size', [atomsElement]);
  x = x + width / 2;
  y = y + height / 2 + (await this.getExtraNativeWebTapOffset());
  this.curWebCoords = {
    x,
    y
  };
  await this.clickWebCoords();
  await _bluebird.default.delay(500);
};

extensions.getExtraNativeWebTapOffset = async function getExtraNativeWebTapOffset() {
  return 0;
};

extensions.clickWebCoords = async function clickWebCoords() {
  let coords = await this.translateWebCoords(this.curWebCoords);
  await this.clickCoords(coords);
};

extensions.translateWebCoords = async function translateWebCoords(coords) {
  _logger.default.debug(`Translating coordinates (${JSON.stringify(coords)}) to web coordinates`);

  let wvCmd = 'au.getElementsByType(\'webview\')';
  let webviewIndex = this.webContextIndex();
  let yOffset = this.opts.curOrientation === 'LANDSCAPE' ? this.landscapeWebCoordsOffset : 0;
  let webviews = await this.uiAutoClient.sendCommand(wvCmd);

  if (webviews.length < 1) {
    throw new _appiumBaseDriver.errors.UnknownError.code('Could not find any webviews to click inside!');
  }

  if (_lodash.default.isUndefined(webviews[webviewIndex])) {
    _logger.default.warn(`Could not find webview at index ${webviewIndex}, taking ` + `last available one for clicking purposes`);

    webviewIndex = webviews.length - 1;
  }

  let wvId = helpers.getElementId(webviews[webviewIndex]);
  let locCmd = `au.getElement('${wvId}').rect()`;
  let rect = await this.uiAutoClient.sendCommand(locCmd);
  let wvPos = {
    x: rect.origin.x,
    y: rect.origin.y
  };
  let realDims = {
    w: rect.size.width,
    h: rect.size.height
  };
  let cmd = '(function () { return {w: document.width, h: document.height}; })()';
  let {
    w,
    h
  } = await this.remote.execute(cmd);
  let wvDims = {
    w,
    h
  };

  if (wvDims && realDims && wvPos) {
    let xRatio = realDims.w / wvDims.w;
    let yRatio = realDims.h / wvDims.h;
    let serviceBarHeight = 20;

    if (parseFloat(this.opts.platformVersion) >= 8) {
      serviceBarHeight = 0;
    }

    let newCoords = {
      x: wvPos.x + Math.round(xRatio * coords.x),
      y: wvPos.y + yOffset + Math.round(yRatio * coords.y) - serviceBarHeight
    };

    _logger.default.debug(`Converted web coords ${JSON.stringify(coords)} ` + `into real coords ${JSON.stringify(newCoords)}`);

    return newCoords;
  }
};

helpers.clickCoords = async function clickCoords(coords) {
  if (this.useRobot) {
    throw new _appiumBaseDriver.errors.NotYetImplementedError();
  } else {
    let opts = coords;
    opts.tapCount = 1;
    opts.duration = 0.3;
    opts.touchCount = 1;
    let command = `au.complexTap(${JSON.stringify(opts)})`;
    await this.uiAutoClient.sendCommand(command);
  }
};

helpers.executeAtom = async function executeAtom(atom, args, alwaysDefaultFrame = false) {
  let frames = alwaysDefaultFrame === true ? [] : this.curWebFrames;
  let promise = this.remote.executeAtom(atom, args, frames);
  return await this.waitForAtom(promise);
};

helpers.executeAtomAsync = async function executeAtomAsync(atom, args, responseUrl) {
  let promise = new _bluebird.default((resolve, reject) => {
    this.asyncPromise = {
      resolve,
      reject
    };
  });
  await this.remote.executeAtomAsync(atom, args, this.curWebFrames, responseUrl);
  return await this.waitForAtom(promise);
};

helpers.waitForAtom = async function waitForAtom(promise) {
  let done = false;
  let error = null;
  promise.then(res => {
    done = true;
    return res;
  }).catch(err => {
    _logger.default.debug(`Error received while executing atom: ${err.message}`);

    done = true;
    error = err;
  });

  for (let i = 0; i < 10; i++) {
    if (done) break;
    await _bluebird.default.delay(500);
    if (done) break;

    if (await this.checkForAlert()) {
      return '';
    }
  }

  let res = await promise;

  if (error) {
    throw error;
  }

  return this.parseExecuteResponse(res);
};

helpers.checkForAlert = async function checkForAlert() {
  if (!_lodash.default.isNull(this.uiAutoClient)) {
    _logger.default.debug('atom did not return yet, checking to see if ' + 'we are blocked by an alert');

    let present = await this.uiAutoClient.sendCommand('au.alertIsPresent()');

    if (!present) {
      _logger.default.debug('No alert found.');
    } else {
      _logger.default.debug('Found an alert, returning control to client');
    }

    return present;
  }
};

helpers.getAtomsElement = function getAtomsElement(wdId) {
  let atomsId;

  try {
    atomsId = this.webElementIds[parseInt(wdId, 10) - ELEMENT_OFFSET];
  } catch (e) {
    return null;
  }

  if (_lodash.default.isUndefined(atomsId)) {
    return null;
  }

  return {
    ELEMENT: atomsId
  };
};

helpers.useAtomsElement = function useAtomsElement(el) {
  if (parseInt(el, 10) < ELEMENT_OFFSET) {
    _logger.default.debug(`Element with id '${el}' passed in for use with ` + `atoms, but it's out of our internal scope. Adding ${ELEMENT_OFFSET}.`);

    el = (parseInt(el, 10) + ELEMENT_OFFSET).toString();
  }

  let atomsElement = this.getAtomsElement(el);

  if (atomsElement === null) {
    throw new _appiumBaseDriver.errors.UnknownError(`Error converting element ID for using in WD atoms: '${el}'`);
  }

  return atomsElement;
};

helpers.convertElementsForAtoms = function convertElementsForAtoms(args = []) {
  let newArgs = [];

  for (let arg of args) {
    if (helpers.hasElementId(arg)) {
      let elementId = helpers.getElementId(arg);
      let atomsElement = this.getAtomsElement(elementId);

      if (atomsElement === null) {
        throw new _appiumBaseDriver.errors.UnknownError(`Error converting element ID for using in WD atoms: '${elementId}'`);
      }

      newArgs.push(atomsElement);
    } else {
      newArgs.push(arg);
    }
  }

  return newArgs;
};

helpers.parseExecuteResponse = function parseExecuteResponse(res) {
  if (_lodash.default.isNull(res) || _lodash.default.isUndefined(res)) return null;
  let wdElement = null;

  if (!_lodash.default.isArray(res)) {
    if (helpers.hasElementId(res)) {
      wdElement = this.parseElementResponse(res);

      if (wdElement === null) {
        throw new _appiumBaseDriver.errors.UnknownError(`Error converting element ID atom for using in WD: '${helpers.getElementId(res)}'`);
      }

      res = wdElement;
    }
  } else {
    let args = [];

    for (let arg of res) {
      wdElement = arg;

      if (helpers.hasElementId(arg)) {
        wdElement = this.parseElementResponse(arg);

        if (wdElement === null) {
          throw new _appiumBaseDriver.errors.UnknownError(`Error converting element ID atom for using in WD: '${helpers.getElementId(arg)}'`);
        }

        args.push(wdElement);
      } else {
        args.push(arg);
      }
    }

    res = args;
  }

  return res;
};

helpers.parseElementResponse = function parseElementResponse(element) {
  let objId = helpers.getElementId(element);
  let clientId = (ELEMENT_OFFSET + this.webElementIds.length).toString();
  this.webElementIds.push(objId);
  return {
    ELEMENT: clientId
  };
};

helpers.getElementId = function getElementId(element) {
  return element.ELEMENT || element[W3C_WEB_ELEMENT_IDENTIFIER];
};

helpers.hasElementId = function hasElementId(element) {
  return _appiumSupport.util.hasValue(element) && (_appiumSupport.util.hasValue(element.ELEMENT) || _appiumSupport.util.hasValue(element[W3C_WEB_ELEMENT_IDENTIFIER]));
};

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy93ZWIuanMiXSwibmFtZXMiOlsiY29tbWFuZHMiLCJoZWxwZXJzIiwiZXh0ZW5zaW9ucyIsIkVMRU1FTlRfT0ZGU0VUIiwiVzNDX1dFQl9FTEVNRU5UX0lERU5USUZJRVIiLCJ1dGlsIiwic2V0RnJhbWUiLCJmcmFtZSIsImlzV2ViQ29udGV4dCIsImNvbW1hbmQiLCJ1aUF1dG9DbGllbnQiLCJzZW5kQ29tbWFuZCIsImF0b20iLCJfIiwiaXNOdWxsIiwiY3VyV2ViRnJhbWVzIiwibG9nZ2VyIiwiZGVidWciLCJoYXNFbGVtZW50SWQiLCJhdG9tc0VsZW1lbnQiLCJ1c2VBdG9tc0VsZW1lbnQiLCJnZXRFbGVtZW50SWQiLCJ2YWx1ZSIsImV4ZWN1dGVBdG9tIiwiV0lORE9XIiwidW5zaGlmdCIsImlzTnVtYmVyIiwiaXNVbmRlZmluZWQiLCJlcnJvcnMiLCJOb1N1Y2hGcmFtZUVycm9yIiwiZ2V0Q3NzUHJvcGVydHkiLCJwcm9wZXJ0eU5hbWUiLCJlbCIsInN1Ym1pdCIsIk5vdEltcGxlbWVudGVkRXJyb3IiLCJyZWZyZXNoIiwiZ2V0VXJsIiwidXJsIiwicmVtb3RlIiwiZXhlY3V0ZSIsInRpdGxlIiwiZ2V0Q29va2llcyIsInNjcmlwdCIsImpzQ29va2llcyIsImNvb2tpZXMiLCJuYW1lIiwidG9QYWlycyIsImNvb2tpZVV0aWxzIiwiY3JlYXRlSldQQ29va2llIiwidW5kZWZpbmVkIiwicHVzaCIsImVyciIsImVycm9yIiwiVW5rbm93bkVycm9yIiwic2V0Q29va2llIiwiY29va2llIiwiY2xvbmUiLCJwYXRoIiwianNDb29raWUiLCJjcmVhdGVKU0Nvb2tpZSIsImV4cGlyZXMiLCJleHBpcnkiLCJEYXRlIiwidG9VVENTdHJpbmciLCJkb21haW4iLCJodHRwT25seSIsInNlY3VyZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJkZWxldGVDb29raWUiLCJjb29raWVOYW1lIiwiaW5kZXhPZiIsIm1hcCIsIl9kZWxldGVDb29raWUiLCJkZWxldGVDb29raWVzIiwibGVuZ3RoIiwid2ViQ29va2llIiwiZXhwaXJlQ29va2llIiwiZmluZFdlYkVsZW1lbnRPckVsZW1lbnRzIiwic3RyYXRlZ3kiLCJzZWxlY3RvciIsIm1hbnkiLCJjdHgiLCJnZXRBdG9tc0VsZW1lbnQiLCJlbGVtZW50IiwiZG9GaW5kIiwiaW1wbGljaXRXYWl0Rm9yQ29uZGl0aW9uIiwibWVzc2FnZSIsImlzRnVuY3Rpb24iLCJtYXRjaCIsInNpemUiLCJOb1N1Y2hFbGVtZW50RXJyb3IiLCJ3ZWJGbGlja0VsZW1lbnQiLCJ4b2Zmc2V0IiwieW9mZnNldCIsIngiLCJ5Iiwid2lkdGgiLCJoZWlnaHQiLCJmcm9tIiwidHJhbnNsYXRlV2ViQ29vcmRzIiwidG8iLCJhcmdzIiwibW9iaWxlV2ViTmF2IiwibmF2VHlwZSIsImFsbG93TmF2aWdhdGlvbldpdGhvdXRSZWxvYWQiLCJuYXRpdmVXZWJUYXAiLCJnZXRFeHRyYU5hdGl2ZVdlYlRhcE9mZnNldCIsImN1cldlYkNvb3JkcyIsImNsaWNrV2ViQ29vcmRzIiwiQiIsImRlbGF5IiwiY29vcmRzIiwiY2xpY2tDb29yZHMiLCJ3dkNtZCIsIndlYnZpZXdJbmRleCIsIndlYkNvbnRleHRJbmRleCIsInlPZmZzZXQiLCJvcHRzIiwiY3VyT3JpZW50YXRpb24iLCJsYW5kc2NhcGVXZWJDb29yZHNPZmZzZXQiLCJ3ZWJ2aWV3cyIsImNvZGUiLCJ3YXJuIiwid3ZJZCIsImxvY0NtZCIsInJlY3QiLCJ3dlBvcyIsIm9yaWdpbiIsInJlYWxEaW1zIiwidyIsImgiLCJjbWQiLCJ3dkRpbXMiLCJ4UmF0aW8iLCJ5UmF0aW8iLCJzZXJ2aWNlQmFySGVpZ2h0IiwicGFyc2VGbG9hdCIsInBsYXRmb3JtVmVyc2lvbiIsIm5ld0Nvb3JkcyIsIk1hdGgiLCJyb3VuZCIsInVzZVJvYm90IiwiTm90WWV0SW1wbGVtZW50ZWRFcnJvciIsInRhcENvdW50IiwiZHVyYXRpb24iLCJ0b3VjaENvdW50IiwiYWx3YXlzRGVmYXVsdEZyYW1lIiwiZnJhbWVzIiwicHJvbWlzZSIsIndhaXRGb3JBdG9tIiwiZXhlY3V0ZUF0b21Bc3luYyIsInJlc3BvbnNlVXJsIiwicmVzb2x2ZSIsInJlamVjdCIsImFzeW5jUHJvbWlzZSIsImRvbmUiLCJ0aGVuIiwicmVzIiwiY2F0Y2giLCJpIiwiY2hlY2tGb3JBbGVydCIsInBhcnNlRXhlY3V0ZVJlc3BvbnNlIiwicHJlc2VudCIsIndkSWQiLCJhdG9tc0lkIiwid2ViRWxlbWVudElkcyIsInBhcnNlSW50IiwiZSIsIkVMRU1FTlQiLCJ0b1N0cmluZyIsImNvbnZlcnRFbGVtZW50c0ZvckF0b21zIiwibmV3QXJncyIsImFyZyIsImVsZW1lbnRJZCIsIndkRWxlbWVudCIsImlzQXJyYXkiLCJwYXJzZUVsZW1lbnRSZXNwb25zZSIsIm9iaklkIiwiY2xpZW50SWQiLCJoYXNWYWx1ZSIsIk9iamVjdCIsImFzc2lnbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQSxJQUFJQSxRQUFRLEdBQUcsRUFBZjtBQUFBLElBQW1CQyxPQUFPLEdBQUcsRUFBN0I7QUFBQSxJQUFpQ0MsVUFBVSxHQUFHLEVBQTlDOzs7QUFFQSxNQUFNQyxjQUFjLEdBQUcsSUFBdkI7QUFDQSxNQUFNO0FBQUVDLEVBQUFBO0FBQUYsSUFBaUNDLG1CQUF2Qzs7QUFFQUwsUUFBUSxDQUFDTSxRQUFULEdBQW9CLGVBQWVBLFFBQWYsQ0FBeUJDLEtBQXpCLEVBQWdDO0FBQ2xELE1BQUksQ0FBQyxLQUFLQyxZQUFMLEVBQUwsRUFBMEI7QUFDeEJELElBQUFBLEtBQUssR0FBR0EsS0FBSyxHQUFHQSxLQUFILEdBQVcsdUJBQXhCO0FBQ0EsUUFBSUUsT0FBTyxHQUFJLGNBQWFGLEtBQU0sRUFBbEM7QUFDQSxXQUFPLE1BQU0sS0FBS0csWUFBTCxDQUFrQkMsV0FBbEIsQ0FBOEJGLE9BQTlCLENBQWI7QUFDRDs7QUFFRCxNQUFJRyxJQUFKOztBQUNBLE1BQUlDLGdCQUFFQyxNQUFGLENBQVNQLEtB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LFlBQVIsR0FBdUIsU0FBU0EsWUFBVCxDQUF1QitELE9BQXZCLEVBQWdDO0FBQ3JELFNBQU9BLE9BQU8sQ0FBQ3FGLE9BQVIsSUFBbUJyRixPQUFPLENBQUNoRiwwQkFBRCxDQUFqQztBQUNELENBRkQ7O0FBSUFILE9BQU8sQ0FBQ2lCLFlBQVIsR0FBdUIsU0FBU0EsWUFBVCxDQUF1QmtFLE9BQXZCLEVBQWdDO0FBQ3JELFNBQU8vRSxvQkFBSytLLFFBQUwsQ0FBY2hHLE9BQWQsTUFBMkIvRSxvQkFBSytLLFFBQUwsQ0FBY2hHLE9BQU8sQ0FBQ3FGLE9BQXRCLEtBQWtDcEssb0JBQUsrSyxRQUFMLENBQWNoRyxPQUFPLENBQUNoRiwwQkFBRCxDQUFyQixDQUE3RCxDQUFQO0FBQ0QsQ0FGRDs7QUFLQWlMLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjcEwsVUFBZCxFQUEwQkYsUUFBMUIsRUFBb0NDLE9BQXBDO2VBRWVDLFUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IHsgZXJyb3JzIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcbmltcG9ydCB7IHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgY29va2llVXRpbHMgZnJvbSAnLi4vY29va2llcyc7XG5pbXBvcnQgbG9nZ2VyIGZyb20gJy4uL2xvZ2dlcic7XG5cblxubGV0IGNvbW1hbmRzID0ge30sIGhlbHBlcnMgPSB7fSwgZXh0ZW5zaW9ucyA9IHt9O1xuXG5jb25zdCBFTEVNRU5UX09GRlNFVCA9IDUwMDA7XG5jb25zdCB7IFczQ19XRUJfRUxFTUVOVF9JREVOVElGSUVSIH0gPSB1dGlsO1xuXG5jb21tYW5kcy5zZXRGcmFtZSA9IGFzeW5jIGZ1bmN0aW9uIHNldEZyYW1lIChmcmFtZSkge1xuICBpZiAoIXRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICBmcmFtZSA9IGZyYW1lID8gZnJhbWUgOiAndGFyZ2V0LmZyb250TW9zdEFwcCgpJztcbiAgICBsZXQgY29tbWFuZCA9IGB3ZF9mcmFtZSA9ICR7ZnJhbWV9YDtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoY29tbWFuZCk7XG4gIH1cblxuICBsZXQgYXRvbTtcbiAgaWYgKF8uaXNOdWxsKGZyYW1lKSkge1xuICAgIHRoaXMuY3VyV2ViRnJhbWVzID0gW107XG4gICAgbG9nZ2VyLmRlYnVnKCdMZWF2aW5nIHdlYiBmcmFtZSBhbmQgZ29pbmcgYmFjayB0byBkZWZhdWx0IGNvbnRlbnQnKTtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKGhlbHBlcnMuaGFzRWxlbWVudElkKGZyYW1lKSkge1xuICAgIGxldCBhdG9tc0VsZW1lbnQgPSB0aGlzLnVzZUF0b21zRWxlbWVudChoZWxwZXJzLmdldEVsZW1lbnRJZChmcmFtZSkpO1xuICAgIGxldCB2YWx1ZSA9IGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ2dldF9mcmFtZV93aW5kb3cnLCBbYXRvbXNFbGVtZW50XSk7XG4gICAgbG9nZ2VyLmRlYnVnKGBFbnRlcmluZyBuZXcgd2ViIGZyYW1lOiAnJHt2YWx1ZS5XSU5ET1d9J2ApO1xuICAgIHRoaXMuY3VyV2ViRnJhbWVzLnVuc2hpZnQodmFsdWUuV0lORE9XKTtcbiAgfSBlbHNlIHtcbiAgICBhdG9tID0gXy5pc051bWJlcihmcmFtZSkgPyAnZnJhbWVfYnlfaW5kZXgnIDogJ2ZyYW1lX2J5X2lkX29yX25hbWUnO1xuICAgIGxldCB2YWx1ZSA9IGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oYXRvbSwgW2ZyYW1lXSk7XG4gICAgaWYgKF8uaXNOdWxsKHZhbHVlKSB8fCBfLmlzVW5kZWZpbmVkKHZhbHVlLldJTkRPVykpIHtcbiAgICAgIHRocm93IG5ldyBlcnJvcnMuTm9TdWNoRnJhbWVFcnJvcigpO1xuICAgIH1cbiAgICBsb2dnZXIuZGVidWcoYEVudGVyaW5nIG5ldyB3ZWIgZnJhbWU6ICcke3ZhbHVlLldJTkRPV30nYCk7XG4gICAgdGhpcy5jdXJXZWJGcmFtZXMudW5zaGlmdCh2YWx1ZS5XSU5ET1cpO1xuICB9XG59O1xuXG5jb21tYW5kcy5nZXRDc3NQcm9wZXJ0eSA9IGFzeW5jIGZ1bmN0aW9uIGdldENzc1Byb3BlcnR5IChwcm9wZXJ0eU5hbWUsIGVsKSB7XG4gIGxldCBhdG9tc0VsZW1lbnQgPSB0aGlzLnVzZUF0b21zRWxlbWVudChlbCk7XG4gIHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdnZXRfdmFsdWVfb2ZfY3NzX3Byb3BlcnR5JywgW2F0b21zRWxlbWVudCwgcHJvcGVydHlOYW1lXSk7XG59O1xuXG5jb21tYW5kcy5zdWJtaXQgPSBhc3luYyBmdW5jdGlvbiBzdWJtaXQgKGVsKSB7XG4gIGlmICh0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgbGV0IGF0b21zRWxlbWVudCA9IHRoaXMudXNlQXRvbXNFbGVtZW50KGVsKTtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdzdWJtaXQnLCBbYXRvbXNFbGVtZW50XSk7XG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob3RJbXBsZW1lbnRlZEVycm9yKCk7XG4gIH1cbn07XG5cbmNvbW1hbmRzLnJlZnJlc2ggPSBhc3luYyBmdW5jdGlvbiByZWZyZXNoICgpIHtcbiAgaWYgKHRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdyZWZyZXNoJywgW10pO1xuICB9IGVsc2Uge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm90SW1wbGVtZW50ZWRFcnJvcigpO1xuICB9XG59O1xuXG5jb21tYW5kcy5nZXRVcmwgPSBhc3luYyBmdW5jdGlvbiBnZXRVcmwgKCkge1xuICBpZiAoIXRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vdEltcGxlbWVudGVkRXJyb3IoKTtcbiAgfVxuICBsZXQgdXJsID0gYXdhaXQgdGhpcy5yZW1vdGUuZXhlY3V0ZSgnd2luZG93LmxvY2F0aW9uLmhyZWYnKTtcbiAgcmV0dXJuIHVybDtcbn07XG5cbmNvbW1hbmRzLnRpdGxlID0gYXN5bmMgZnVuY3Rpb24gdGl0bGUgKCkge1xuICBpZiAoIXRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vdEltcGxlbWVudGVkRXJyb3IoKTtcbiAgfVxuICByZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgndGl0bGUnLCBbXSwgdHJ1ZSk7XG59O1xuXG5jb21tYW5kcy5nZXRDb29raWVzID0gYXN5bmMgZnVuY3Rpb24gZ2V0Q29va2llcyAoKSB7XG4gIGlmICghdGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm90SW1wbGVtZW50ZWRFcnJvcigpO1xuICB9XG5cbiAgbG9nZ2VyLmRlYnVnKCdSZXRyaWV2aW5nIGFsbCBjb29raWVzJyk7XG5cbiAgbGV0IHNjcmlwdCA9ICdyZXR1cm4gZG9jdW1lbnQuY29va2llJztcbiAgbGV0IGpzQ29va2llcyA9IGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ2V4ZWN1dGVfc2NyaXB0JywgW3NjcmlwdCwgW11dKTtcblxuICBsZXQgY29va2llcyA9IFtdO1xuICB0cnkge1xuICAgIGZvciAobGV0IFtuYW1lLCB2YWx1ZV0gb2YgXy50b1BhaXJzKGNvb2tpZVV0aWxzLmNyZWF0ZUpXUENvb2tpZSh1bmRlZmluZWQsIGpzQ29va2llcykpKSB7XG4gICAgICBjb29raWVzLnB1c2goe25hbWUsIHZhbHVlfSk7XG4gICAgfVxuICAgIHJldHVybiBjb29raWVzO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2dnZXIuZXJyb3IoZXJyKTtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLlVua25vd25FcnJvcihgRXJyb3IgcGFyc2luZyBjb29raWVzIGZyb20gcmVzdWx0OiAnJHtqc0Nvb2tpZXN9J2ApO1xuICB9XG59O1xuXG5jb21tYW5kcy5zZXRDb29raWUgPSBhc3luYyBmdW5jdGlvbiBzZXRDb29raWUgKGNvb2tpZSkge1xuICBpZiAoIXRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vdEltcGxlbWVudGVkRXJyb3IoKTtcbiAgfVxuXG4gIGNvb2tpZSA9IF8uY2xvbmUoY29va2llKTtcblxuICAvLyBpZiBgcGF0aGAgZmllbGQgaXMgbm90IHNwZWNpZmllZCwgU2FmYXJpIHdpbGwgbm90IHVwZGF0ZSBjb29raWVzIGFzIGV4cGVjdGVkOyBlZyBpc3N1ZSAjMTcwOFxuICBpZiAoIWNvb2tpZS5wYXRoKSB7XG4gICAgY29va2llLnBhdGggPSAnLyc7XG4gIH1cblxuICBjb25zdCBqc0Nvb2tpZSA9IGNvb2tpZVV0aWxzLmNyZWF0ZUpTQ29va2llKGNvb2tpZS5uYW1lLCBjb29raWUudmFsdWUsIHtcbiAgICBleHBpcmVzOiBfLmlzTnVtYmVyKGNvb2tpZS5leHBpcnkpID8gKG5ldyBEYXRlKGNvb2tpZS5leHBpcnkgKiAxMDAwKSkudG9VVENTdHJpbmcoKSA6XG4gICAgICBjb29raWUuZXhwaXJ5LFxuICAgIHBhdGg6IGNvb2tpZS5wYXRoLFxuICAgIGRvbWFpbjogY29va2llLmRvbWFpbixcbiAgICBodHRwT25seTogY29va2llLmh0dHBPbmx5LFxuICAgIHNlY3VyZTogY29va2llLnNlY3VyZVxuICB9KTtcbiAgbGV0IHNjcmlwdCA9IGBkb2N1bWVudC5jb29raWUgPSAke0pTT04uc3RyaW5naWZ5KGpzQ29va2llKX1gO1xuICBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdleGVjdXRlX3NjcmlwdCcsIFtzY3JpcHQsIFtdXSk7XG59O1xuXG5jb21tYW5kcy5kZWxldGVDb29raWUgPSBhc3luYyBmdW5jdGlvbiBkZWxldGVDb29raWUgKGNvb2tpZU5hbWUpIHtcbiAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob3RJbXBsZW1lbnRlZEVycm9yKCk7XG4gIH1cblxuICAvLyBjaGVjayBjb29raWUgZXhpc3RlbmNlXG4gIGxldCBjb29raWVzID0gYXdhaXQgdGhpcy5nZXRDb29raWVzKCk7XG4gIGlmIChfLmluZGV4T2YoXy5tYXAoY29va2llcywgJ25hbWUnKSwgY29va2llTmFtZSkgPT09IC0xKSB7XG4gICAgbG9nZ2VyLmRlYnVnKGBDb29raWUgJyR7Y29va2llTmFtZX0nIG5vdCBmb3VuZC4gSWdub3JpbmcuYCk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICByZXR1cm4gYXdhaXQgdGhpcy5fZGVsZXRlQ29va2llKGNvb2tpZU5hbWUpO1xufTtcblxuY29tbWFuZHMuZGVsZXRlQ29va2llcyA9IGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUNvb2tpZXMgKCkge1xuICBpZiAoIXRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vdEltcGxlbWVudGVkRXJyb3IoKTtcbiAgfVxuXG4gIGxldCBjb29raWVzID0gYXdhaXQgdGhpcy5nZXRDb29raWVzKCk7XG4gIGlmIChjb29raWVzLmxlbmd0aCkge1xuICAgIGZvciAobGV0IGNvb2tpZSBvZiBjb29raWVzKSB7XG4gICAgICBhd2FpdCB0aGlzLl9kZWxldGVDb29raWUoY29va2llLm5hbWUpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbmhlbHBlcnMuX2RlbGV0ZUNvb2tpZSA9IGFzeW5jIGZ1bmN0aW9uIF9kZWxldGVDb29raWUgKGNvb2tpZU5hbWUpIHtcbiAgbG9nZ2VyLmRlYnVnKGBEZWxldGluZyBjb29raWUgJyR7Y29va2llTmFtZX0nYCk7XG4gIGxldCB3ZWJDb29raWUgPSBjb29raWVVdGlscy5leHBpcmVDb29raWUoY29va2llTmFtZSwge3BhdGg6ICcvJ30pO1xuICBsZXQgc2NyaXB0ID0gYGRvY3VtZW50LmNvb2tpZSA9ICR7SlNPTi5zdHJpbmdpZnkod2ViQ29va2llKX1gO1xuICBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdleGVjdXRlX3NjcmlwdCcsIFtzY3JpcHQsIFtdXSk7XG59O1xuXG5leHRlbnNpb25zLmZpbmRXZWJFbGVtZW50T3JFbGVtZW50cyA9IGFzeW5jIGZ1bmN0aW9uIGZpbmRXZWJFbGVtZW50T3JFbGVtZW50cyAoc3RyYXRlZ3ksIHNlbGVjdG9yLCBtYW55LCBjdHgpIHtcbiAgbGV0IGF0b21zRWxlbWVudCA9IHRoaXMuZ2V0QXRvbXNFbGVtZW50KGN0eCk7XG4gIGxldCBlbGVtZW50O1xuICBsZXQgZG9GaW5kID0gYXN5bmMgKCkgPT4ge1xuICAgIGVsZW1lbnQgPSBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKGBmaW5kX2VsZW1lbnQke21hbnkgPyAncycgOiAnJ31gLCBbc3RyYXRlZ3ksIHNlbGVjdG9yLCBhdG9tc0VsZW1lbnRdKTtcbiAgICByZXR1cm4gIV8uaXNOdWxsKGVsZW1lbnQpO1xuICB9O1xuICB0cnkge1xuICAgIGF3YWl0IHRoaXMuaW1wbGljaXRXYWl0Rm9yQ29uZGl0aW9uKGRvRmluZCk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGlmIChlcnIubWVzc2FnZSAmJiBfLmlzRnVuY3Rpb24oZXJyLm1lc3NhZ2UubWF0Y2gpICYmIGVyci5tZXNzYWdlLm1hdGNoKC9Db25kaXRpb24gdW5tZXQvKSkge1xuICAgICAgLy8gY29uZGl0aW9uIHdhcyBub3QgbWV0IHNldHRpbmcgcmVzIHRvIGVtcHR5IGFycmF5XG4gICAgICBlbGVtZW50ID0gW107XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gIH1cblxuICBpZiAobWFueSkge1xuICAgIHJldHVybiBlbGVtZW50O1xuICB9IGVsc2Uge1xuICAgIGlmICghZWxlbWVudCB8fCBfLnNpemUoZWxlbWVudCkgPT09IDApIHtcbiAgICAgIHRocm93IG5ldyBlcnJvcnMuTm9TdWNoRWxlbWVudEVycm9yKCk7XG4gICAgfVxuICAgIHJldHVybiBlbGVtZW50O1xuICB9XG59O1xuXG5leHRlbnNpb25zLndlYkZsaWNrRWxlbWVudCA9IGFzeW5jIGZ1bmN0aW9uIHdlYkZsaWNrRWxlbWVudCAoZWwsIHhvZmZzZXQsIHlvZmZzZXQpIHtcbiAgbGV0IGF0b21zRWxlbWVudCA9IGF3YWl0IHRoaXMudXNlQXRvbXNFbGVtZW50KGVsKTtcblxuICBsZXQge3gsIHl9ID0gYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnZ2V0X3RvcF9sZWZ0X2Nvb3JkaW5hdGVzJywgW2F0b21zRWxlbWVudF0pO1xuICBsZXQge3dpZHRoLCBoZWlnaHR9ID0gYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnZ2V0X3NpemUnLCBbYXRvbXNFbGVtZW50XSk7XG5cbiAgLy8gdHJhbnNsYXRlIHRvIHByb3BlciBjb29yZGluYXRlc1xuICB4ID0geCArICh3aWR0aCAvIDIpO1xuICB5ID0geSArIChoZWlnaHQgLyAyKTtcblxuICBsZXQgZnJvbSA9IGF3YWl0IHRoaXMudHJhbnNsYXRlV2ViQ29vcmRzKHt4LCB5fSk7XG4gIGxldCB0byA9IGF3YWl0IHRoaXMudHJhbnNsYXRlV2ViQ29vcmRzKHt4OiB4ICsgeG9mZnNldCwgeTogeSArIHlvZmZzZXR9KTtcblxuICBsZXQgYXJncyA9IHtmcm9tLCB0b307XG4gIGxldCBjb21tYW5kID0gYGF1LmZsaWNrKCR7SlNPTi5zdHJpbmdpZnkoYXJncyl9KWA7XG4gIGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKGNvbW1hbmQpO1xufTtcblxuZXh0ZW5zaW9ucy5tb2JpbGVXZWJOYXYgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVXZWJOYXYgKG5hdlR5cGUpIHtcbiAgdGhpcy5yZW1vdGUuYWxsb3dOYXZpZ2F0aW9uV2l0aG91dFJlbG9hZCgpO1xuICBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdleGVjdXRlX3NjcmlwdCcsIFtgaGlzdG9yeS4ke25hdlR5cGV9KCk7YCwgbnVsbF0pO1xufTtcblxuXG5leHRlbnNpb25zLm5hdGl2ZVdlYlRhcCA9IGFzeW5jIGZ1bmN0aW9uIG5hdGl2ZVdlYlRhcCAoZWwpIHtcbiAgbGV0IGF0b21zRWxlbWVudCA9IHRoaXMudXNlQXRvbXNFbGVtZW50KGVsKTtcbiAgbGV0IHt4LCB5fSA9IGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ2dldF90b3BfbGVmdF9jb29yZGluYXRlcycsIFthdG9tc0VsZW1lbnRdKTtcbiAgbGV0IHt3aWR0aCwgaGVpZ2h0fSA9IGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ2dldF9zaXplJywgW2F0b21zRWxlbWVudF0pO1xuICB4ID0geCArICh3aWR0aCAvIDIpO1xuICB5ID0geSArIChoZWlnaHQgLyAyKSArIGF3YWl0IHRoaXMuZ2V0RXh0cmFOYXRpdmVXZWJUYXBPZmZzZXQoKTtcblxuICB0aGlzLmN1cldlYkNvb3JkcyA9IHt4LCB5fTtcbiAgYXdhaXQgdGhpcy5jbGlja1dlYkNvb3JkcygpO1xuICAvLyBtYWtlIHN1cmUgcmVhbCB0YXAgYWN0dWFsbHkgaGFzIHRpbWUgdG8gcmVnaXN0ZXJcbiAgYXdhaXQgQi5kZWxheSg1MDApO1xufTtcblxuZXh0ZW5zaW9ucy5nZXRFeHRyYU5hdGl2ZVdlYlRhcE9mZnNldCA9IGFzeW5jIGZ1bmN0aW9uIGdldEV4dHJhTmF0aXZlV2ViVGFwT2Zmc2V0ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gIC8vIHRoaXMgd2lsbCBiZSBmaWxsZWQgaW4gYnkgZHJpdmVycyB1c2luZyBpdFxuICByZXR1cm4gMDtcbn07XG5cbmV4dGVuc2lvbnMuY2xpY2tXZWJDb29yZHMgPSBhc3luYyBmdW5jdGlvbiBjbGlja1dlYkNvb3JkcyAoKSB7XG4gIGxldCBjb29yZHMgPSBhd2FpdCB0aGlzLnRyYW5zbGF0ZVdlYkNvb3Jkcyh0aGlzLmN1cldlYkNvb3Jkcyk7XG4gIGF3YWl0IHRoaXMuY2xpY2tDb29yZHMoY29vcmRzKTtcbn07XG5cbmV4dGVuc2lvbnMudHJhbnNsYXRlV2ViQ29vcmRzID0gYXN5bmMgZnVuY3Rpb24gdHJhbnNsYXRlV2ViQ29vcmRzIChjb29yZHMpIHtcbiAgbG9nZ2VyLmRlYnVnKGBUcmFuc2xhdGluZyBjb29yZGluYXRlcyAoJHtKU09OLnN0cmluZ2lmeShjb29yZHMpfSkgdG8gd2ViIGNvb3JkaW5hdGVzYCk7XG4gIGxldCB3dkNtZCA9ICdhdS5nZXRFbGVtZW50c0J5VHlwZShcXCd3ZWJ2aWV3XFwnKSc7XG4gIGxldCB3ZWJ2aWV3SW5kZXggPSB0aGlzLndlYkNvbnRleHRJbmRleCgpO1xuXG4gIC8vIGFkZCBzdGF0aWMgb2Zmc2V0IGZvciBzYWZhcmkgaW4gbGFuZHNjYXBlIG1vZGVcbiAgbGV0IHlPZmZzZXQgPSB0aGlzLm9wdHMuY3VyT3JpZW50YXRpb24gPT09ICdMQU5EU0NBUEUnID8gdGhpcy5sYW5kc2NhcGVXZWJDb29yZHNPZmZzZXQgOiAwO1xuXG4gIC8vIGFic29sdXRpemUgd2ViIGNvb3Jkc1xuICBsZXQgd2Vidmlld3MgPSBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zZW5kQ29tbWFuZCh3dkNtZCk7XG4gIGlmICh3ZWJ2aWV3cy5sZW5ndGggPCAxKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duRXJyb3IuY29kZSgnQ291bGQgbm90IGZpbmQgYW55IHdlYnZpZXdzIHRvIGNsaWNrIGluc2lkZSEnKTtcbiAgfVxuICBpZiAoXy5pc1VuZGVmaW5lZCh3ZWJ2aWV3c1t3ZWJ2aWV3SW5kZXhdKSkge1xuICAgIGxvZ2dlci53YXJuKGBDb3VsZCBub3QgZmluZCB3ZWJ2aWV3IGF0IGluZGV4ICR7d2Vidmlld0luZGV4fSwgdGFraW5nIGAgK1xuICAgICAgICAgICAgICAgIGBsYXN0IGF2YWlsYWJsZSBvbmUgZm9yIGNsaWNraW5nIHB1cnBvc2VzYCk7XG4gICAgd2Vidmlld0luZGV4ID0gd2Vidmlld3MubGVuZ3RoIC0gMTtcbiAgfVxuXG4gIGxldCB3dklkID0gaGVscGVycy5nZXRFbGVtZW50SWQod2Vidmlld3Nbd2Vidmlld0luZGV4XSk7XG4gIGxldCBsb2NDbWQgPSBgYXUuZ2V0RWxlbWVudCgnJHt3dklkfScpLnJlY3QoKWA7XG4gIGxldCByZWN0ID0gYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQobG9jQ21kKTtcbiAgbGV0IHd2UG9zID0ge3g6IHJlY3Qub3JpZ2luLngsIHk6IHJlY3Qub3JpZ2luLnl9O1xuICBsZXQgcmVhbERpbXMgPSB7dzogcmVjdC5zaXplLndpZHRoLCBoOiByZWN0LnNpemUuaGVpZ2h0fTtcblxuICBsZXQgY21kID0gJyhmdW5jdGlvbiAoKSB7IHJldHVybiB7dzogZG9jdW1lbnQud2lkdGgsIGg6IGRvY3VtZW50LmhlaWdodH07IH0pKCknO1xuICBsZXQge3csIGh9ID0gYXdhaXQgdGhpcy5yZW1vdGUuZXhlY3V0ZShjbWQpO1xuICBsZXQgd3ZEaW1zID0ge3csIGh9O1xuXG4gIGlmICh3dkRpbXMgJiYgcmVhbERpbXMgJiYgd3ZQb3MpIHtcbiAgICBsZXQgeFJhdGlvID0gcmVhbERpbXMudyAvIHd2RGltcy53O1xuICAgIGxldCB5UmF0aW8gPSByZWFsRGltcy5oIC8gd3ZEaW1zLmg7XG4gICAgbGV0IHNlcnZpY2VCYXJIZWlnaHQgPSAyMDtcbiAgICBpZiAocGFyc2VGbG9hdCh0aGlzLm9wdHMucGxhdGZvcm1WZXJzaW9uKSA+PSA4KSB7XG4gICAgICAvLyBpb3M4IGluY2x1ZGVzIHRoZSBzZXJ2aWNlIGJhciBoZWlnaHQgaW4gdGhlIGFwcFxuICAgICAgc2VydmljZUJhckhlaWdodCA9IDA7XG4gICAgfVxuICAgIGxldCBuZXdDb29yZHMgPSB7XG4gICAgICB4OiB3dlBvcy54ICsgTWF0aC5yb3VuZCh4UmF0aW8gKiBjb29yZHMueCksXG4gICAgICB5OiB3dlBvcy55ICsgeU9mZnNldCArIE1hdGgucm91bmQoeVJhdGlvICogY29vcmRzLnkpIC0gc2VydmljZUJhckhlaWdodFxuICAgIH07XG4gICAgbG9nZ2VyLmRlYnVnKGBDb252ZXJ0ZWQgd2ViIGNvb3JkcyAke0pTT04uc3RyaW5naWZ5KGNvb3Jkcyl9IGAgK1xuICAgICAgICAgICAgICAgIGBpbnRvIHJlYWwgY29vcmRzICR7SlNPTi5zdHJpbmdpZnkobmV3Q29vcmRzKX1gKTtcbiAgICByZXR1cm4gbmV3Q29vcmRzO1xuICB9XG59O1xuXG5oZWxwZXJzLmNsaWNrQ29vcmRzID0gYXN5bmMgZnVuY3Rpb24gY2xpY2tDb29yZHMgKGNvb3Jkcykge1xuICBpZiAodGhpcy51c2VSb2JvdCkge1xuICAgIC8vIHZhciB0YXBVcmwgPSB0aGlzLmFyZ3Mucm9ib3RVcmwgKyBcIi90YXBcIjtcbiAgICAvLyByZXF1ZXN0LnBvc3Qoe3VybDp0YXBVcmwsIGZvcm06IHt4OmNvb3Jkcy54LCB5OmNvb3Jkcy55fX0sIGNiKTtcbiAgICAvKlRPRE8qL3Rocm93IG5ldyBlcnJvcnMuTm90WWV0SW1wbGVtZW50ZWRFcnJvcigpO1xuICB9IGVsc2Uge1xuICAgIGxldCBvcHRzID0gY29vcmRzO1xuICAgIG9wdHMudGFwQ291bnQgPSAxO1xuICAgIG9wdHMuZHVyYXRpb24gPSAwLjM7XG4gICAgb3B0cy50b3VjaENvdW50ID0gMTtcbiAgICBsZXQgY29tbWFuZCA9IGBhdS5jb21wbGV4VGFwKCR7SlNPTi5zdHJpbmdpZnkob3B0cyl9KWA7XG4gICAgYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoY29tbWFuZCk7XG4gIH1cbn07XG5cbmhlbHBlcnMuZXhlY3V0ZUF0b20gPSBhc3luYyBmdW5jdGlvbiBleGVjdXRlQXRvbSAoYXRvbSwgYXJncywgYWx3YXlzRGVmYXVsdEZyYW1lID0gZmFsc2UpIHtcbiAgbGV0IGZyYW1lcyA9IGFsd2F5c0RlZmF1bHRGcmFtZSA9PT0gdHJ1ZSA/IFtdIDogdGhpcy5jdXJXZWJGcmFtZXM7XG4gIGxldCBwcm9taXNlID0gdGhpcy5yZW1vdGUuZXhlY3V0ZUF0b20oYXRvbSwgYXJncywgZnJhbWVzKTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMud2FpdEZvckF0b20ocHJvbWlzZSk7XG59O1xuXG5oZWxwZXJzLmV4ZWN1dGVBdG9tQXN5bmMgPSBhc3luYyBmdW5jdGlvbiBleGVjdXRlQXRvbUFzeW5jIChhdG9tLCBhcmdzLCByZXNwb25zZVVybCkge1xuICAvLyBzYXZlIHRoZSByZXNvbHZlIGFuZCByZWplY3QgbWV0aG9kcyBvZiB0aGUgcHJvbWlzZSB0byBiZSB3YWl0ZWQgZm9yXG4gIGxldCBwcm9taXNlID0gbmV3IEIoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIHRoaXMuYXN5bmNQcm9taXNlID0ge3Jlc29sdmUsIHJlamVjdH07XG4gIH0pO1xuICBhd2FpdCB0aGlzLnJlbW90ZS5leGVjdXRlQXRvbUFzeW5jKGF0b20sIGFyZ3MsIHRoaXMuY3VyV2ViRnJhbWVzLCByZXNwb25zZVVybCk7XG4gIHJldHVybiBhd2FpdCB0aGlzLndhaXRGb3JBdG9tKHByb21pc2UpO1xufTtcblxuaGVscGVycy53YWl0Rm9yQXRvbSA9IGFzeW5jIGZ1bmN0aW9uIHdhaXRGb3JBdG9tIChwcm9taXNlKSB7XG4gIC8vIG5lZWQgdG8gY2hlY2sgZm9yIGFsZXJ0IHdoaWxlIHRoZSBhdG9tIGlzIGJlaW5nIGV4ZWN1dGVkLlxuICAvLyBzbyBub3RpZnkgb3Vyc2VsdmVzIHdoZW4gaXQgaGFwcGVuc1xuICBsZXQgZG9uZSA9IGZhbHNlO1xuICBsZXQgZXJyb3IgPSBudWxsO1xuICBwcm9taXNlLnRoZW4oKHJlcykgPT4geyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHByb21pc2UvcHJlZmVyLWF3YWl0LXRvLXRoZW5cbiAgICBkb25lID0gdHJ1ZTtcbiAgICByZXR1cm4gcmVzO1xuICB9KVxuICAuY2F0Y2goKGVycikgPT4geyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHByb21pc2UvcHJlZmVyLWF3YWl0LXRvLWNhbGxiYWNrc1xuICAgIGxvZ2dlci5kZWJ1ZyhgRXJyb3IgcmVjZWl2ZWQgd2hpbGUgZXhlY3V0aW5nIGF0b206ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgLy8gZXJyb3IgZ2V0cyBzd2FsbG93ZWQsIHNvIHNhdmUgYW5kIGNoZWNrIGxhdGVyXG4gICAgZG9uZSA9IHRydWU7XG4gICAgZXJyb3IgPSBlcnI7XG4gIH0pO1xuICAvLyB0cnkgdGVuIHRpbWVzIHRvIGNoZWNrIGFsZXJ0LCBpZiB3ZSBhcmUgbm90IGRvbmUgeWV0XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgIC8vIGNoZWNrIGlmIHRoZSBwcm9taXNlIGhhcyBiZWVuIHJlc29sdmVkXG4gICAgaWYgKGRvbmUpIGJyZWFrOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGN1cmx5XG4gICAgYXdhaXQgQi5kZWxheSg1MDApO1xuICAgIGlmIChkb25lKSBicmVhazsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjdXJseVxuICAgIC8vIGNoZWNrIGlmIHRoZXJlIGlzIGFuIGFsZXJ0XG4gICAgaWYgKGF3YWl0IHRoaXMuY2hlY2tGb3JBbGVydCgpKSB7XG4gICAgICAvLyB3ZSBmb3VuZCBhbiBhbGVydCwgYW5kIHNob3VsZCBqdXN0IHJldHVybiBjb250cm9sXG4gICAgICByZXR1cm4gJyc7XG4gICAgfVxuICB9XG5cbiAgbGV0IHJlcyA9IGF3YWl0IHByb21pc2U7XG4gIGlmIChlcnJvcikge1xuICAgIHRocm93IGVycm9yO1xuICB9XG4gIHJldHVybiB0aGlzLnBhcnNlRXhlY3V0ZVJlc3BvbnNlKHJlcyk7XG59O1xuXG5oZWxwZXJzLmNoZWNrRm9yQWxlcnQgPSBhc3luYyBmdW5jdGlvbiBjaGVja0ZvckFsZXJ0ICgpIHtcbiAgaWYgKCFfLmlzTnVsbCh0aGlzLnVpQXV0b0NsaWVudCkpIHtcbiAgICBsb2dnZXIuZGVidWcoJ2F0b20gZGlkIG5vdCByZXR1cm4geWV0LCBjaGVja2luZyB0byBzZWUgaWYgJyArXG4gICAgICAgICAgICAgICAgICd3ZSBhcmUgYmxvY2tlZCBieSBhbiBhbGVydCcpO1xuICAgIGxldCBwcmVzZW50ID0gYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoJ2F1LmFsZXJ0SXNQcmVzZW50KCknKTtcbiAgICBpZiAoIXByZXNlbnQpIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnTm8gYWxlcnQgZm91bmQuJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnRm91bmQgYW4gYWxlcnQsIHJldHVybmluZyBjb250cm9sIHRvIGNsaWVudCcpO1xuICAgIH1cbiAgICByZXR1cm4gcHJlc2VudDtcbiAgfVxufTtcblxuaGVscGVycy5nZXRBdG9tc0VsZW1lbnQgPSBmdW5jdGlvbiBnZXRBdG9tc0VsZW1lbnQgKHdkSWQpIHtcbiAgbGV0IGF0b21zSWQ7XG4gIHRyeSB7XG4gICAgYXRvbXNJZCA9IHRoaXMud2ViRWxlbWVudElkc1twYXJzZUludCh3ZElkLCAxMCkgLSBFTEVNRU5UX09GRlNFVF07XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICBpZiAoXy5pc1VuZGVmaW5lZChhdG9tc0lkKSkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIHJldHVybiB7RUxFTUVOVDogYXRvbXNJZH07XG59O1xuXG5oZWxwZXJzLnVzZUF0b21zRWxlbWVudCA9IGZ1bmN0aW9uIHVzZUF0b21zRWxlbWVudCAoZWwpIHtcbiAgaWYgKHBhcnNlSW50KGVsLCAxMCkgPCBFTEVNRU5UX09GRlNFVCkge1xuICAgIGxvZ2dlci5kZWJ1ZyhgRWxlbWVudCB3aXRoIGlkICcke2VsfScgcGFzc2VkIGluIGZvciB1c2Ugd2l0aCBgICtcbiAgICAgICAgICAgICAgICAgYGF0b21zLCBidXQgaXQncyBvdXQgb2Ygb3VyIGludGVybmFsIHNjb3BlLiBBZGRpbmcgJHtFTEVNRU5UX09GRlNFVH0uYCk7XG4gICAgZWwgPSAocGFyc2VJbnQoZWwsIDEwKSArIEVMRU1FTlRfT0ZGU0VUKS50b1N0cmluZygpO1xuICB9XG4gIGxldCBhdG9tc0VsZW1lbnQgPSB0aGlzLmdldEF0b21zRWxlbWVudChlbCk7XG4gIGlmIChhdG9tc0VsZW1lbnQgPT09IG51bGwpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLlVua25vd25FcnJvcihgRXJyb3IgY29udmVydGluZyBlbGVtZW50IElEIGZvciB1c2luZyBpbiBXRCBhdG9tczogJyR7ZWx9J2ApO1xuICB9XG4gIHJldHVybiBhdG9tc0VsZW1lbnQ7XG59O1xuXG5oZWxwZXJzLmNvbnZlcnRFbGVtZW50c0ZvckF0b21zID0gZnVuY3Rpb24gY29udmVydEVsZW1lbnRzRm9yQXRvbXMgKGFyZ3MgPSBbXSkge1xuICBsZXQgbmV3QXJncyA9IFtdO1xuICBmb3IgKGxldCBhcmcgb2YgYXJncykge1xuICAgIGlmIChoZWxwZXJzLmhhc0VsZW1lbnRJZChhcmcpKSB7XG4gICAgICAvLyBHZXQgdGhlIGVsZW1lbnQga2V5IGZyb20gVzNDIG9yIE1KU09OV1Aga2V5XG4gICAgICBsZXQgZWxlbWVudElkID0gaGVscGVycy5nZXRFbGVtZW50SWQoYXJnKTtcbiAgICAgIGxldCBhdG9tc0VsZW1lbnQgPSB0aGlzLmdldEF0b21zRWxlbWVudChlbGVtZW50SWQpO1xuICAgICAgaWYgKGF0b21zRWxlbWVudCA9PT0gbnVsbCkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JzLlVua25vd25FcnJvcihgRXJyb3IgY29udmVydGluZyBlbGVtZW50IElEIGZvciB1c2luZyBpbiBXRCBhdG9tczogJyR7ZWxlbWVudElkfSdgKTtcbiAgICAgIH1cbiAgICAgIG5ld0FyZ3MucHVzaChhdG9tc0VsZW1lbnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBuZXdBcmdzLnB1c2goYXJnKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG5ld0FyZ3M7XG59O1xuXG5oZWxwZXJzLnBhcnNlRXhlY3V0ZVJlc3BvbnNlID0gZnVuY3Rpb24gcGFyc2VFeGVjdXRlUmVzcG9uc2UgKHJlcykge1xuICBpZiAoXy5pc051bGwocmVzKSB8fCBfLmlzVW5kZWZpbmVkKHJlcykpIHJldHVybiBudWxsOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGN1cmx5XG5cbiAgbGV0IHdkRWxlbWVudCA9IG51bGw7XG4gIGlmICghXy5pc0FycmF5KHJlcykpIHtcbiAgICBpZiAoaGVscGVycy5oYXNFbGVtZW50SWQocmVzKSkge1xuICAgICAgd2RFbGVtZW50ID0gdGhpcy5wYXJzZUVsZW1lbnRSZXNwb25zZShyZXMpO1xuICAgICAgaWYgKHdkRWxlbWVudCA9PT0gbnVsbCkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JzLlVua25vd25FcnJvcihgRXJyb3IgY29udmVydGluZyBlbGVtZW50IElEIGF0b20gZm9yIHVzaW5nIGluIFdEOiAnJHtoZWxwZXJzLmdldEVsZW1lbnRJZChyZXMpfSdgKTtcbiAgICAgIH1cbiAgICAgIHJlcyA9IHdkRWxlbWVudDtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgLy8gdmFsdWUgaXMgYW4gYXJyYXksIHNvIGdvIHRocm91Z2ggYW5kIGNvbnZlcnQgZWFjaFxuICAgIGxldCBhcmdzID0gW107XG4gICAgZm9yIChsZXQgYXJnIG9mIHJlcykge1xuICAgICAgd2RFbGVtZW50ID0gYXJnO1xuICAgICAgaWYgKGhlbHBlcnMuaGFzRWxlbWVudElkKGFyZykpIHtcbiAgICAgICAgd2RFbGVtZW50ID0gdGhpcy5wYXJzZUVsZW1lbnRSZXNwb25zZShhcmcpO1xuICAgICAgICBpZiAod2RFbGVtZW50ID09PSBudWxsKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duRXJyb3IoYEVycm9yIGNvbnZlcnRpbmcgZWxlbWVudCBJRCBhdG9tIGZvciB1c2luZyBpbiBXRDogJyR7aGVscGVycy5nZXRFbGVtZW50SWQoYXJnKX0nYCk7XG4gICAgICAgIH1cbiAgICAgICAgYXJncy5wdXNoKHdkRWxlbWVudCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhcmdzLnB1c2goYXJnKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmVzID0gYXJncztcbiAgfVxuICByZXR1cm4gcmVzO1xufTtcblxuaGVscGVycy5wYXJzZUVsZW1lbnRSZXNwb25zZSA9IGZ1bmN0aW9uIHBhcnNlRWxlbWVudFJlc3BvbnNlIChlbGVtZW50KSB7XG4gIGxldCBvYmpJZCA9IGhlbHBlcnMuZ2V0RWxlbWVudElkKGVsZW1lbnQpO1xuICBsZXQgY2xpZW50SWQgPSAoRUxFTUVOVF9PRkZTRVQgKyB0aGlzLndlYkVsZW1lbnRJZHMubGVuZ3RoKS50b1N0cmluZygpO1xuICB0aGlzLndlYkVsZW1lbnRJZHMucHVzaChvYmpJZCk7XG4gIHJldHVybiB7RUxFTUVOVDogY2xpZW50SWR9O1xufTtcblxuaGVscGVycy5nZXRFbGVtZW50SWQgPSBmdW5jdGlvbiBnZXRFbGVtZW50SWQgKGVsZW1lbnQpIHtcbiAgcmV0dXJuIGVsZW1lbnQuRUxFTUVOVCB8fCBlbGVtZW50W1czQ19XRUJfRUxFTUVOVF9JREVOVElGSUVSXTtcbn07XG5cbmhlbHBlcnMuaGFzRWxlbWVudElkID0gZnVuY3Rpb24gaGFzRWxlbWVudElkIChlbGVtZW50KSB7XG4gIHJldHVybiB1dGlsLmhhc1ZhbHVlKGVsZW1lbnQpICYmICh1dGlsLmhhc1ZhbHVlKGVsZW1lbnQuRUxFTUVOVCkgfHwgdXRpbC5oYXNWYWx1ZShlbGVtZW50W1czQ19XRUJfRUxFTUVOVF9JREVOVElGSUVSXSkpO1xufTtcblxuXG5PYmplY3QuYXNzaWduKGV4dGVuc2lvbnMsIGNvbW1hbmRzLCBoZWxwZXJzKTtcbmV4cG9ydCB7IGNvbW1hbmRzLCBoZWxwZXJzIH07XG5leHBvcnQgZGVmYXVsdCBleHRlbnNpb25zO1xuIl0sImZpbGUiOiJsaWIvY29tbWFuZHMvd2ViLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
