"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.parseWindows = parseWindows;
exports.parseSurfaceLine = parseSurfaceLine;
exports.default = exports.helpers = exports.commands = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _androidHelpers = _interopRequireDefault(require("../android-helpers"));

var _appiumSupport = require("appium-support");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _logger = _interopRequireDefault(require("../logger"));

var _moment = _interopRequireDefault(require("moment"));

var _asyncbox = require("asyncbox");

let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;

commands.keys = async function (keys) {
  keys = _lodash.default.isArray(keys) ? keys.join('') : keys;
  let params = {
    text: keys,
    replace: false
  };

  if (this.opts.unicodeKeyboard) {
    params.unicodeKeyboard = true;
  }

  await this.doSendKeys(params);
};

commands.doSendKeys = async function (params) {
  return await this.bootstrap.sendAction('setText', params);
};

const DEFAULT_DEVICE_TIME = 'YYYY-MM-DDTHH:mm:ssZ';

commands.getDeviceTime = async function (format = DEFAULT_DEVICE_TIME) {
  _logger.default.info('Attempting to capture android device date and time');

  if (!_lodash.default.isString(format)) {
    _logger.default.errorAndThrow(`The format specifier is expected to be a valid string specifier like '${DEFAULT_DEVICE_TIME}'. ` + `The current value is: ${format}`);
  }

  const deviceTimestamp = (await this.adb.shell(['date', '+%Y-%m-%dT%T%z'])).trim();
  const parsedTimestamp = (0, _moment.default)(deviceTimestamp, 'YYYY-MM-DDTHH:mm:ssZ');

  if (!parsedTimestamp.isValid()) {
    _logger.default.warn(`Cannot parse the returned timestamp '${deviceTimestamp}'. Returning as is`);

    return deviceTimestamp;
  }

  return parsedTimestamp.format(format);
};

commands.getPageSource = async function () {
  return await this.bootstrap.sendAction('source');
};

commands.back = async function () {
  return await this.bootstrap.sendAction('pressBack');
};

commands.isKeyboardShown = async function () {
  let keyboardInfo = await this.adb.isSoftKeyboardPresent();
  return keyboardInfo.isKeyboardShown;
};

commands.hideKeyboard = async function () {
  let {
    isKeyboardShown,
    canCloseKeyboard
  } = await this.adb.isSoftKeyboardPresent();

  if (!isKeyboardShown) {
    _logger.default.info('Keyboard has no UI; no closing necessary');

    return;
  }

  for (const keyCode of [111, 4]) {
    if (canCloseKeyboard) {
      await this.adb.keyevent(keyCode);
    }

    try {
      return await (0, _asyncbox.waitForCondition)(async () => {
        ({
          isKeyboardShown
        } = await this.adb.isSoftKeyboardPresent());
        return !isKeyboardShown;
      }, {
        waitMs: 1000,
        intervalMs: 500
      });
    } catch (ign) {}
  }

  throw new Error(`The software keyboard cannot be closed`);
};

commands.openSettingsActivity = async function (setting) {
  let {
    appPackage,
    appActivity
  } = await this.adb.getFocusedPackageAndActivity();
  await this.adb.shell(['am', 'start', '-a', `android.settings.${setting}`]);
  await this.adb.waitForNotActivity(appPackage, appActivity, 5000);
};

commands.getWindowSize = async function () {
  return await this.bootstrap.sendAction('getDeviceSize');
};

commands.getWindowRect = async function () {
  const {
    width,
    height
  } = await this.getWindowSize();
  return {
    width,
    height,
    x: 0,
    y: 0
  };
};

commands.getCurrentActivity = async function () {
  return (await this.adb.getFocusedPackageAndActivity()).appActivity;
};

commands.getCurrentPackage = async function () {
  return (await this.adb.getFocusedPackageAndActivity()).appPackage;
};

commands.background = async function (seconds) {
  if (seconds < 0) {
    await this.adb.goToHome();
    return true;
  }

  let {
    appPackage,
    appActivity
  } = await this.adb.getFocusedPackageAndActivity();
  await this.adb.goToHome();
  await _bluebird.default.delay(seconds * 1000);
  let args;

  if (this._cachedActivityArgs && this._cachedActivityArgs[`${appPackage}/${appActivity}`]) {
    args = this._cachedActivityArgs[`${appPackage}/${appActivity}`];
  } else {
    try {
      _logger.default.debug(`Activating app '${appPackage}' in order to restore it`);

      await this.activateApp(appPackage);
      return true;
    } catch (ign) {}

    args = appPackage === this.opts.appPackage && appActivity === this.opts.appActivity || appPackage === this.opts.appWaitPackage && (this.opts.appWaitActivity || '').split(',').includes(appActivity) ? {
      pkg: this.opts.appPackage,
      activity: this.opts.appActivity,
      action: this.opts.intentAction,
      category: this.opts.intentCategory,
      flags: this.opts.intentFlags,
      waitPkg: this.opts.appWaitPackage,
      waitActivity: this.opts.appWaitActivity,
      optionalIntentArguments: this.opts.optionalIntentArguments,
      stopApp: false,
      user: this.opts.userProfile
    } : {
      pkg: appPackage,
      activity: appActivity,
      waitPkg: appPackage,
      waitActivity: appActivity,
      stopApp: false
    };
  }

  args = await _appiumSupport.util.filterObject(args);

  _logger.default.debug(`Bringing application back to foreground with arguments: ${JSON.stringify(args)}`);

  return await this.adb.startApp(args);
};

commands.getStrings = async function (language) {
  if (!language) {
    language = await this.adb.getDeviceLanguage();

    _logger.default.info(`No language specified, returning strings for: ${language}`);
  }

  const preprocessStringsMap = mapping => {
    const result = {};

    for (const [key, value] of _lodash.default.toPairs(mapping)) {
      result[key] = _lodash.default.isString(value) ? value : JSON.stringify(value);
    }

    return result;
  };

  if (this.apkStrings[language]) {
    return preprocessStringsMap(this.apkStrings[language]);
  }

  this.apkStrings[language] = await _androidHelpers.default.pushStrings(language, this.adb, this.opts);

  if (this.bootstrap) {
    await this.bootstrap.sendAction('updateStrings');
  }

  return preprocessStringsMap(this.apkStrings[language]);
};

commands.launchApp = async function () {
  await this.initAUT();
  await this.startAUT();
};

commands.startActivity = async function (appPackage, appActivity, appWaitPackage, appWaitActivity, intentAction, intentCategory, intentFlags, optionalIntentArguments, dontStopAppOnReset) {
  _logger.default.debug(`Starting package '${appPackage}' and activity '${appActivity}'`);

  if (!_appiumSupport.util.hasValue(dontStopAppOnReset)) {
    dontStopAppOnReset = !!this.opts.dontStopAppOnReset;
  }

  let args = {
    pkg: appPackage,
    activity: appActivity,
    waitPkg: appWaitPackage || appPackage,
    waitActivity: appWaitActivity || appActivity,
    action: intentAction,
    category: intentCategory,
    flags: intentFlags,
    optionalIntentArguments,
    stopApp: !dontStopAppOnReset
  };
  this._cachedActivityArgs = this._cachedActivityArgs || {};
  this._cachedActivityArgs[`${args.waitPkg}/${args.waitActivity}`] = args;
  await this.adb.startApp(args);
};

commands.reset = async function () {
  await _androidHelpers.default.resetApp(this.adb, Object.assign({}, this.opts, {
    fastReset: true
  }));
  await this.setContext();
  return (await this.isChromeSession) ? this.startChromeSession() : this.startAUT();
};

commands.startAUT = async function () {
  await this.adb.startApp({
    pkg: this.opts.appPackage,
    activity: this.opts.appActivity,
    action: this.opts.intentAction,
    category: this.opts.intentCategory,
    flags: this.opts.intentFlags,
    waitPkg: this.opts.appWaitPackage,
    waitActivity: this.opts.appWaitActivity,
    waitDuration: this.opts.appWaitDuration,
    optionalIntentArguments: this.opts.optionalIntentArguments,
    stopApp: !this.opts.dontStopAppOnReset,
    user: this.opts.userProfile
  });
};

commands.setUrl = async function (uri) {
  await this.adb.startUri(uri, this.opts.appPackage);
};

commands.closeApp = async function () {
  await this.adb.forceStop(this.opts.appPackage);
  await this.setContext();
};

commands.getDisplayDensity = async function () {
  let out = await this.adb.shell(['getprop', 'ro.sf.lcd_density']);

  if (out) {
    let val = parseInt(out, 10);

    if (!isNaN(val)) {
      return val;
    }

    _logger.default.debug(`Parsed density value was NaN: "${out}"`);
  }

  out = await this.adb.shell(['getprop', 'qemu.sf.lcd_density']);

  if (out) {
    let val = parseInt(out, 10);

    if (!isNaN(val)) {
      return val;
    }

    _logger.default.debug(`Parsed density value was NaN: "${out}"`);
  }

  _logger.default.errorAndThrow('Failed to get display density property.');
};

function parseSurfaceLine(line) {
  let bounds = line.split('rect=')[1].replace(/[(), x]+/g, ' ').trim().split(' ');
  return {
    visible: line.indexOf('shown=true') !== -1,
    x: parseFloat(bounds[0]),
    y: parseFloat(bounds[1]),
    width: parseFloat(bounds[2]),
    height: parseFloat(bounds[3])
  };
}

function parseWindows(lines) {
  let atStatusBar = false;
  let atNavBar = false;
  let statusBar;
  let navigationBar;
  lines.split('\n').forEach(line => {
    if (line.indexOf('  Window #') !== -1) {
      atStatusBar = line.indexOf('StatusBar') !== -1;
      atNavBar = line.indexOf('NavigationBar') !== -1;
      return;
    }

    if (line.indexOf('      Surface:') === -1) {
      return;
    }

    if (atStatusBar) {
      statusBar = parseSurfaceLine(line);
      atStatusBar = false;
    } else if (atNavBar) {
      navigationBar = parseSurfaceLine(line);
      atNavBar = false;
    }
  });

  if (!statusBar) {
    _logger.default.errorAndThrow('Failed to parse status bar information.');
  }

  if (!navigationBar) {
    _logger.default.errorAndThrow('Failed to parse navigation bar information.');
  }

  return {
    statusBar,
    navigationBar
  };
}

commands.getSystemBars = async function () {
  let out = await this.adb.shell(['dumpsys', 'window', 'windows']);

  if (!out) {
    _logger.default.errorAndThrow('Did not get window manager output.');
  }

  return parseWindows(out);
};

commands.mobilePerformEditorAction = async function (opts = {}) {
  const {
    action
  } = opts;

  if (!_appiumSupport.util.hasValue(action)) {
    _logger.default.errorAndThrow(`'action' argument is required`);
  }

  await this.adb.performEditorAction(action);
};

const PERMISSION_ACTION = {
  GRANT: 'grant',
  REVOKE: 'revoke'
};

commands.mobileChangePermissions = async function (opts = {}) {
  const {
    permissions,
    appPackage = this.opts.appPackage,
    action = PERMISSION_ACTION.GRANT
  } = opts;

  if (!_appiumSupport.util.hasValue(permissions)) {
    _logger.default.errorAndThrow(`'permissions' argument is required`);
  }

  let actionFunc;

  switch (_lodash.default.toLower(action)) {
    case PERMISSION_ACTION.GRANT:
      actionFunc = (appPackage, permission) => this.adb.grantPermission(appPackage, permission);

      break;

    case PERMISSION_ACTION.REVOKE:
      actionFunc = (appPackage, permission) => this.adb.revokePermission(appPackage, permission);

      break;

    default:
      _logger.default.errorAndThrow(`Unknown action '${action}'. ` + `Only ${JSON.stringify(_lodash.default.values(PERMISSION_ACTION))} actions are supported`);

      break;
  }

  for (const permission of _lodash.default.isArray(permissions) ? permissions : [permissions]) {
    await actionFunc(appPackage, permission);
  }
};

const PERMISSIONS_TYPE = {
  DENIED: 'denied',
  GRANTED: 'granted',
  REQUESTED: 'requested'
};

commands.mobileGetPermissions = async function (opts = {}) {
  const {
    type = PERMISSIONS_TYPE.REQUESTED,
    appPackage = this.opts.appPackage
  } = opts;
  let actionFunc;

  switch (_lodash.default.toLower(type)) {
    case PERMISSIONS_TYPE.REQUESTED:
      actionFunc = appPackage => this.adb.getReqPermissions(appPackage);

      break;

    case PERMISSIONS_TYPE.GRANTED:
      actionFunc = appPackage => this.adb.getGrantedPermissions(appPackage);

      break;

    case PERMISSIONS_TYPE.DENIED:
      actionFunc = appPackage => this.adb.getDeniedPermissions(appPackage);

      break;

    default:
      _logger.default.errorAndThrow(`Unknown permissions type '${type}'. ` + `Only ${JSON.stringify(_lodash.default.values(PERMISSIONS_TYPE))} types are supported`);

      break;
  }

  return await actionFunc(appPackage);
};

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9nZW5lcmFsLmpzIl0sIm5hbWVzIjpbImNvbW1hbmRzIiwiaGVscGVycyIsImV4dGVuc2lvbnMiLCJrZXlzIiwiXyIsImlzQXJyYXkiLCJqb2luIiwicGFyYW1zIiwidGV4dCIsInJlcGxhY2UiLCJvcHRzIiwidW5pY29kZUtleWJvYXJkIiwiZG9TZW5kS2V5cyIsImJvb3RzdHJhcCIsInNlbmRBY3Rpb24iLCJERUZBVUxUX0RFVklDRV9USU1FIiwiZ2V0RGV2aWNlVGltZSIsImZvcm1hdCIsImxvZyIsImluZm8iLCJpc1N0cmluZyIsImVycm9yQW5kVGhyb3ciLCJkZXZpY2VUaW1lc3RhbXAiLCJhZGIiLCJzaGVsbCIsInRyaW0iLCJwYXJzZWRUaW1lc3RhbXAiLCJpc1ZhbGlkIiwid2FybiIsImdldFBhZ2VTb3VyY2UiLCJiYWNrIiwiaXNLZXlib2FyZFNob3duIiwia2V5Ym9hcmRJbmZvIiwiaXNTb2Z0S2V5Ym9hcmRQcmVzZW50IiwiaGlkZUtleWJvYXJkIiwiY2FuQ2xvc2VLZXlib2FyZCIsImtleUNvZGUiLCJrZXlldmVudCIsIndhaXRNcyIsImludGVydmFsTXMiLCJpZ24iLCJFcnJvciIsIm9wZW5TZXR0aW5nc0FjdGl2aXR5Iiwic2V0dGluZyIsImFwcFBhY2thZ2UiLCJhcHBBY3Rpdml0eSIsImdldEZvY3VzZWRQYWNrYWdlQW5kQWN0aXZpdHkiLCJ3YWl0Rm9yTm90QWN0aXZpdHkiLCJnZXRXaW5kb3dTaXplIiwiZ2V0V2luZG93UmVjdCIsIndpZHRoIiwiaGVpZ2h0IiwieCIsInkiLCJnZXRDdXJyZW50QWN0aXZpdHkiLCJnZXRDdXJyZW50UGFja2FnZSIsImJhY2tncm91bmQiLCJzZWNvbmRzIiwiZ29Ub0hvbWUiLCJCIiwiZGVsYXkiLCJhcmdzIiwiX2NhY2hlZEFjdGl2aXR5QXJncyIsImRlYnVnIiwiYWN0aXZhdGVBcHAiLCJhcHBXYWl0UGFja2FnZSIsImFwcFdhaXRBY3Rpdml0eSIsInNwbGl0IiwiaW5jbHVkZXMiLCJwa2ciLCJhY3Rpdml0eSIsImFjdGlvbiIsImludGVudEFjdGlvbiIsImNhdGVnb3J5IiwiaW50ZW50Q2F0ZWdvcnkiLCJmbGFncyIsImludGVudEZsYWdzIiwid2FpdFBrZyIsIndhaXRBY3Rpdml0eSIsIm9wdGlvbmFsSW50ZW50QXJndW1lbnRzIiwic3RvcEFwcCIsInVzZXIiLCJ1c2VyUHJvZmlsZSIsInV0aWwiLCJmaWx0ZXJPYmplY3QiLCJKU09OIiwic3RyaW5naWZ5Iiwic3RhcnRBcHAiLCJnZXRTdHJpbmdzIiwibGFuZ3VhZ2UiLCJnZXREZXZpY2VMYW5ndWFnZSIsInByZXByb2Nlc3NTdHJpbmdzTWFwIiwibWFwcGluZyIsInJlc3VsdCIsImtleSIsInZhbHVlIiwidG9QYWlycyIsImFwa1N0cmluZ3MiLCJhbmRyb2lkSGVscGVycyIsInB1c2hTdHJpbmdzIiwibGF1bmNoQXBwIiwiaW5pdEFVVCIsInN0YXJ0QVVUIiwic3RhcnRBY3Rpdml0eSIsImRvbnRTdG9wQXBwT25SZXNldCIsImhhc1ZhbHVlIiwicmVzZXQiLCJyZXNldEFwcCIsIk9iamVjdCIsImFzc2lnbiIsImZhc3RSZXNldCIsInNldENvbnRleHQiLCJpc0Nocm9tZVNlc3Npb24iLCJzdGFydENocm9tZVNlc3Npb24iLCJ3YWl0RHVyYXRpb24iLCJhcHBXYWl0RHVyYXRpb24iLCJzZXRVcmwiLCJ1cmkiLCJzdGFydFVyaSIsImNsb3NlQXBwIiwiZm9yY2VTdG9wIiwiZ2V0RGlzcGxheURlbnNpdHkiLCJvdXQiLCJ2YWwiLCJwYXJzZUludCIsImlzTmFOIiwicGFyc2VTdXJmYWNlTGluZSIsImxpbmUiLCJib3VuZHMiLCJ2aXNpYmxlIiwiaW5kZXhPZiIsInBhcnNlRmxvYXQiLCJwYXJzZVdpbmRvd3MiLCJsaW5lcyIsImF0U3RhdHVzQmFyIiwiYXROYXZCYXIiLCJzdGF0dXNCYXIiLCJuYXZpZ2F0aW9uQmFyIiwiZm9yRWFjaCIsImdldFN5c3RlbUJhcnMiLCJtb2JpbGVQZXJmb3JtRWRpdG9yQWN0aW9uIiwicGVyZm9ybUVkaXRvckFjdGlvbiIsIlBFUk1JU1NJT05fQUNUSU9OIiwiR1JBTlQiLCJSRVZPS0UiLCJtb2JpbGVDaGFuZ2VQZXJtaXNzaW9ucyIsInBlcm1pc3Npb25zIiwiYWN0aW9uRnVuYyIsInRvTG93ZXIiLCJwZXJtaXNzaW9uIiwiZ3JhbnRQZXJtaXNzaW9uIiwicmV2b2tlUGVybWlzc2lvbiIsInZhbHVlcyIsIlBFUk1JU1NJT05TX1RZUEUiLCJERU5JRUQiLCJHUkFOVEVEIiwiUkVRVUVTVEVEIiwibW9iaWxlR2V0UGVybWlzc2lvbnMiLCJ0eXBlIiwiZ2V0UmVxUGVybWlzc2lvbnMiLCJnZXRHcmFudGVkUGVybWlzc2lvbnMiLCJnZXREZW5pZWRQZXJtaXNzaW9ucyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBLElBQUlBLFFBQVEsR0FBRyxFQUFmO0FBQUEsSUFBbUJDLE9BQU8sR0FBRyxFQUE3QjtBQUFBLElBQWlDQyxVQUFVLEdBQUcsRUFBOUM7Ozs7QUFFQUYsUUFBUSxDQUFDRyxJQUFULEdBQWdCLGdCQUFnQkEsSUFBaEIsRUFBc0I7QUFFcENBLEVBQUFBLElBQUksR0FBR0MsZ0JBQUVDLE9BQUYsQ0FBVUYsSUFBVixJQUFrQkEsSUFBSSxDQUFDRyxJQUFMLENBQVUsRUFBVixDQUFsQixHQUFrQ0gsSUFBekM7QUFDQSxNQUFJSSxNQUFNLEdBQUc7QUFDWEMsSUFBQUEsSUFBSSxFQUFFTCxJQURLO0FBRVhNLElBQUFBLE9BQU8sRUFBRTtBQUZFLEdBQWI7O0FBSUEsTUFBSSxLQUFLQyxJQUFMLENBQVVDLGVBQWQsRUFBK0I7QUFDN0JKLElBQUFBLE1BQU0sQ0FBQ0ksZUFBUCxHQUF5QixJQUF6QjtBQUNEOztBQUNELFFBQU0sS0FBS0MsVUFBTCxDQUFnQkwsTUFBaEIsQ0FBTjtBQUNELENBWEQ7O0FBYUFQLFFBQVEsQ0FBQ1ksVUFBVCxHQUFzQixnQkFBZ0JMLE1BQWhCLEVBQXdCO0FBQzVDLFNBQU8s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TU4sVUFBVSxDQUFDdkcsVUFBRCxDQUF2QjtBQUNELENBdkJEOztBQXlCQWdFLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjM0csVUFBZCxFQUEwQkYsUUFBMUIsRUFBb0NDLE9BQXBDO2VBRWVDLFUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IGFuZHJvaWRIZWxwZXJzIGZyb20gJy4uL2FuZHJvaWQtaGVscGVycyc7XG5pbXBvcnQgeyB1dGlsIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IGxvZyBmcm9tICcuLi9sb2dnZXInO1xuaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQnO1xuaW1wb3J0IHsgd2FpdEZvckNvbmRpdGlvbiB9IGZyb20gJ2FzeW5jYm94JztcblxubGV0IGNvbW1hbmRzID0ge30sIGhlbHBlcnMgPSB7fSwgZXh0ZW5zaW9ucyA9IHt9O1xuXG5jb21tYW5kcy5rZXlzID0gYXN5bmMgZnVuY3Rpb24gKGtleXMpIHtcbiAgLy8gUHJvdG9jb2wgc2VuZHMgYW4gYXJyYXk7IHJldGhpbmsgYXBwcm9hY2hcbiAga2V5cyA9IF8uaXNBcnJheShrZXlzKSA/IGtleXMuam9pbignJykgOiBrZXlzO1xuICBsZXQgcGFyYW1zID0ge1xuICAgIHRleHQ6IGtleXMsXG4gICAgcmVwbGFjZTogZmFsc2VcbiAgfTtcbiAgaWYgKHRoaXMub3B0cy51bmljb2RlS2V5Ym9hcmQpIHtcbiAgICBwYXJhbXMudW5pY29kZUtleWJvYXJkID0gdHJ1ZTtcbiAgfVxuICBhd2FpdCB0aGlzLmRvU2VuZEtleXMocGFyYW1zKTtcbn07XG5cbmNvbW1hbmRzLmRvU2VuZEtleXMgPSBhc3luYyBmdW5jdGlvbiAocGFyYW1zKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKCdzZXRUZXh0JywgcGFyYW1zKTtcbn07XG5cbi8qKlxuICogUmV0cmlldmVzIHRoZSBjdXJyZW50IGRldmljZSdzIHRpbWVzdGFtcC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gZm9ybWF0IC0gVGhlIHNldCBvZiBmb3JtYXQgc3BlY2lmaWVycy4gUmVhZFxuICogICAgICAgICAgICAgICAgICAgICAgICAgIGh0dHBzOi8vbW9tZW50anMuY29tL2RvY3MvIHRvIGdldCB0aGUgZnVsbCBsaXN0IG9mIHN1cHBvcnRlZFxuICogICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGV0aW1lIGZvcm1hdCBzcGVjaWZpZXJzLiBUaGUgZGVmYXVsdCBmb3JtYXQgaXNcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICBgWVlZWS1NTS1ERFRISDptbTpzc1pgLCB3aGljaCBjb21wbGllcyB0byBJU08tODYwMVxuICogQHJldHVybnMgRm9ybWF0dGVkIGRhdGV0aW1lIHN0cmluZyBvciB0aGUgcmF3IGNvbW1hbmQgb3V0cHV0IGlmIGZvcm1hdHRpbmcgZmFpbHNcbiAqL1xuY29uc3QgREVGQVVMVF9ERVZJQ0VfVElNRSA9ICdZWVlZLU1NLUREVEhIOm1tOnNzWic7XG5jb21tYW5kcy5nZXREZXZpY2VUaW1lID0gYXN5bmMgZnVuY3Rpb24gKGZvcm1hdCA9IERFRkFVTFRfREVWSUNFX1RJTUUpIHtcbiAgbG9nLmluZm8oJ0F0dGVtcHRpbmcgdG8gY2FwdHVyZSBhbmRyb2lkIGRldmljZSBkYXRlIGFuZCB0aW1lJyk7XG5cbiAgaWYgKCFfLmlzU3RyaW5nKGZvcm1hdCkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgVGhlIGZvcm1hdCBzcGVjaWZpZXIgaXMgZXhwZWN0ZWQgdG8gYmUgYSB2YWxpZCBzdHJpbmcgc3BlY2lmaWVyIGxpa2UgJyR7REVGQVVMVF9ERVZJQ0VfVElNRX0nLiBgICtcbiAgICAgICAgYFRoZSBjdXJyZW50IHZhbHVlIGlzOiAke2Zvcm1hdH1gKTtcbiAgfVxuXG4gIGNvbnN0IGRldmljZVRpbWVzdGFtcCA9IChhd2FpdCB0aGlzLmFkYi5zaGVsbChbJ2RhdGUnLCAnKyVZLSVtLSVkVCVUJXonXSkpLnRyaW0oKTtcbiAgY29uc3QgcGFyc2VkVGltZXN0YW1wID0gbW9tZW50KGRldmljZVRpbWVzdGFtcCwgJ1lZWVktTU0tRERUSEg6bW06c3NaJyk7XG4gIGlmICghcGFyc2VkVGltZXN0YW1wLmlzVmFsaWQoKSkge1xuICAgIGxvZy53YXJuKGBDYW5ub3QgcGFyc2UgdGhlIHJldHVybmVkIHRpbWVzdGFtcCAnJHtkZXZpY2VUaW1lc3RhbXB9Jy4gUmV0dXJuaW5nIGFzIGlzYCk7XG4gICAgcmV0dXJuIGRldmljZVRpbWVzdGFtcDtcbiAgfVxuICByZXR1cm4gcGFyc2VkVGltZXN0YW1wLmZvcm1hdChmb3JtYXQpO1xufTtcblxuY29tbWFuZHMuZ2V0UGFnZVNvdXJjZSA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ3NvdXJjZScpO1xufTtcblxuY29tbWFuZHMuYmFjayA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ3ByZXNzQmFjaycpO1xufTtcblxuY29tbWFuZHMuaXNLZXlib2FyZFNob3duID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICBsZXQga2V5Ym9hcmRJbmZvID0gYXdhaXQgdGhpcy5hZGIuaXNTb2Z0S2V5Ym9hcmRQcmVzZW50KCk7XG4gIHJldHVybiBrZXlib2FyZEluZm8uaXNLZXlib2FyZFNob3duO1xufTtcblxuY29tbWFuZHMuaGlkZUtleWJvYXJkID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICBsZXQge2lzS2V5Ym9hcmRTaG93biwgY2FuQ2xvc2VLZXlib2FyZH0gPSBhd2FpdCB0aGlzLmFkYi5pc1NvZnRLZXlib2FyZFByZXNlbnQoKTtcbiAgaWYgKCFpc0tleWJvYXJkU2hvd24pIHtcbiAgICBsb2cuaW5mbygnS2V5Ym9hcmQgaGFzIG5vIFVJOyBubyBjbG9zaW5nIG5lY2Vzc2FyeScpO1xuICAgIHJldHVybjtcbiAgfVxuICAvLyBUcnkgRVNDIHRoZW4gQkFDSyBpZiB0aGUgZmlyc3Qgb25lIGZhaWxzXG4gIGZvciAoY29uc3Qga2V5Q29kZSBvZiBbMTExLCA0XSkge1xuICAgIGlmIChjYW5DbG9zZUtleWJvYXJkKSB7XG4gICAgICBhd2FpdCB0aGlzLmFkYi5rZXlldmVudChrZXlDb2RlKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCB3YWl0Rm9yQ29uZGl0aW9uKGFzeW5jICgpID0+IHtcbiAgICAgICAgKHtpc0tleWJvYXJkU2hvd259ID0gYXdhaXQgdGhpcy5hZGIuaXNTb2Z0S2V5Ym9hcmRQcmVzZW50KCkpO1xuICAgICAgICByZXR1cm4gIWlzS2V5Ym9hcmRTaG93bjtcbiAgICAgIH0sIHt3YWl0TXM6IDEwMDAsIGludGVydmFsTXM6IDUwMH0pO1xuICAgIH0gY2F0Y2ggKGlnbikge31cbiAgfVxuICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBzb2Z0d2FyZSBrZXlib2FyZCBjYW5ub3QgYmUgY2xvc2VkYCk7XG59O1xuXG5jb21tYW5kcy5vcGVuU2V0dGluZ3NBY3Rpdml0eSA9IGFzeW5jIGZ1bmN0aW9uIChzZXR0aW5nKSB7XG4gIGxldCB7YXBwUGFja2FnZSwgYXBwQWN0aXZpdHl9ID0gYXdhaXQgdGhpcy5hZGIuZ2V0Rm9jdXNlZFBhY2thZ2VBbmRBY3Rpdml0eSgpO1xuICBhd2FpdCB0aGlzLmFkYi5zaGVsbChbJ2FtJywgJ3N0YXJ0JywgJy1hJywgYGFuZHJvaWQuc2V0dGluZ3MuJHtzZXR0aW5nfWBdKTtcbiAgYXdhaXQgdGhpcy5hZGIud2FpdEZvck5vdEFjdGl2aXR5KGFwcFBhY2thZ2UsIGFwcEFjdGl2aXR5LCA1MDAwKTtcbn07XG5cbmNvbW1hbmRzLmdldFdpbmRvd1NpemUgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKCdnZXREZXZpY2VTaXplJyk7XG59O1xuXG4vLyBGb3IgVzNDXG5jb21tYW5kcy5nZXRXaW5kb3dSZWN0ID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IGF3YWl0IHRoaXMuZ2V0V2luZG93U2l6ZSgpO1xuICByZXR1cm4ge1xuICAgIHdpZHRoLFxuICAgIGhlaWdodCxcbiAgICB4OiAwLFxuICAgIHk6IDBcbiAgfTtcbn07XG5cbmNvbW1hbmRzLmdldEN1cnJlbnRBY3Rpdml0eSA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIChhd2FpdCB0aGlzLmFkYi5nZXRGb2N1c2VkUGFja2FnZUFuZEFjdGl2aXR5KCkpLmFwcEFjdGl2aXR5O1xufTtcblxuY29tbWFuZHMuZ2V0Q3VycmVudFBhY2thZ2UgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiAoYXdhaXQgdGhpcy5hZGIuZ2V0Rm9jdXNlZFBhY2thZ2VBbmRBY3Rpdml0eSgpKS5hcHBQYWNrYWdlO1xufTtcblxuY29tbWFuZHMuYmFja2dyb3VuZCA9IGFzeW5jIGZ1bmN0aW9uIChzZWNvbmRzKSB7XG4gIGlmIChzZWNvbmRzIDwgMCkge1xuICAgIC8vIGlmIHVzZXIgcGFzc2VzIGluIGEgbmVnYXRpdmUgc2Vjb25kcyB2YWx1ZSwgaW50ZXJwcmV0IHRoYXQgYXMgdGhlIGluc3RydWN0aW9uXG4gICAgLy8gdG8gbm90IGJyaW5nIHRoZSBhcHAgYmFjayBhdCBhbGxcbiAgICBhd2FpdCB0aGlzLmFkYi5nb1RvSG9tZSgpO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGxldCB7YXBwUGFja2FnZSwgYXBwQWN0aXZpdHl9ID0gYXdhaXQgdGhpcy5hZGIuZ2V0Rm9jdXNlZFBhY2thZ2VBbmRBY3Rpdml0eSgpO1xuICBhd2FpdCB0aGlzLmFkYi5nb1RvSG9tZSgpO1xuICBhd2FpdCBCLmRlbGF5KHNlY29uZHMgKiAxMDAwKTtcblxuICBsZXQgYXJncztcbiAgaWYgKHRoaXMuX2NhY2hlZEFjdGl2aXR5QXJncyAmJiB0aGlzLl9jYWNoZWRBY3Rpdml0eUFyZ3NbYCR7YXBwUGFja2FnZX0vJHthcHBBY3Rpdml0eX1gXSkge1xuICAgIC8vIHRoZSBhY3Rpdml0eSB3YXMgc3RhcnRlZCB3aXRoIGBzdGFydEFjdGl2aXR5YCwgc28gdXNlIHRob3NlIGFyZ3MgdG8gcmVzdGFydFxuICAgIGFyZ3MgPSB0aGlzLl9jYWNoZWRBY3Rpdml0eUFyZ3NbYCR7YXBwUGFja2FnZX0vJHthcHBBY3Rpdml0eX1gXTtcbiAgfSBlbHNlIHtcbiAgICB0cnkge1xuICAgICAgbG9nLmRlYnVnKGBBY3RpdmF0aW5nIGFwcCAnJHthcHBQYWNrYWdlfScgaW4gb3JkZXIgdG8gcmVzdG9yZSBpdGApO1xuICAgICAgYXdhaXQgdGhpcy5hY3RpdmF0ZUFwcChhcHBQYWNrYWdlKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2ggKGlnbikge31cbiAgICBhcmdzID0gKChhcHBQYWNrYWdlID09PSB0aGlzLm9wdHMuYXBwUGFja2FnZSAmJiBhcHBBY3Rpdml0eSA9PT0gdGhpcy5vcHRzLmFwcEFjdGl2aXR5KSB8fFxuICAgICAgICAgICAgKGFwcFBhY2thZ2UgPT09IHRoaXMub3B0cy5hcHBXYWl0UGFja2FnZSAmJiAodGhpcy5vcHRzLmFwcFdhaXRBY3Rpdml0eSB8fCAnJykuc3BsaXQoJywnKS5pbmNsdWRlcyhhcHBBY3Rpdml0eSkpKVxuICAgICAgPyB7Ly8gdGhlIGFjdGl2aXR5IGlzIHRoZSBvcmlnaW5hbCBzZXNzaW9uIGFjdGl2aXR5LCBzbyB1c2UgdGhlIG9yaWdpbmFsIGFyZ3NcbiAgICAgICAgcGtnOiB0aGlzLm9wdHMuYXBwUGFja2FnZSxcbiAgICAgICAgYWN0aXZpdHk6IHRoaXMub3B0cy5hcHBBY3Rpdml0eSxcbiAgICAgICAgYWN0aW9uOiB0aGlzLm9wdHMuaW50ZW50QWN0aW9uLFxuICAgICAgICBjYXRlZ29yeTogdGhpcy5vcHRzLmludGVudENhdGVnb3J5LFxuICAgICAgICBmbGFnczogdGhpcy5vcHRzLmludGVudEZsYWdzLFxuICAgICAgICB3YWl0UGtnOiB0aGlzLm9wdHMuYXBwV2FpdFBhY2thZ2UsXG4gICAgICAgIHdhaXRBY3Rpdml0eTogdGhpcy5vcHRzLmFwcFdhaXRBY3Rpdml0eSxcbiAgICAgICAgb3B0aW9uYWxJbnRlbnRBcmd1bWVudHM6IHRoaXMub3B0cy5vcHRpb25hbEludGVudEFyZ3VtZW50cyxcbiAgICAgICAgc3RvcEFwcDogZmFsc2UsXG4gICAgICAgIHVzZXI6IHRoaXMub3B0cy51c2VyUHJvZmlsZX1cbiAgICAgIDogey8vIHRoZSBhY3Rpdml0eSB3YXMgc3RhcnRlZCBzb21lIG90aGVyIHdheSwgc28gdXNlIGRlZmF1bHRzXG4gICAgICAgIHBrZzogYXBwUGFja2FnZSxcbiAgICAgICAgYWN0aXZpdHk6IGFwcEFjdGl2aXR5LFxuICAgICAgICB3YWl0UGtnOiBhcHBQYWNrYWdlLFxuICAgICAgICB3YWl0QWN0aXZpdHk6IGFwcEFjdGl2aXR5LFxuICAgICAgICBzdG9wQXBwOiBmYWxzZX07XG4gIH1cbiAgYXJncyA9IGF3YWl0IHV0aWwuZmlsdGVyT2JqZWN0KGFyZ3MpO1xuICBsb2cuZGVidWcoYEJyaW5naW5nIGFwcGxpY2F0aW9uIGJhY2sgdG8gZm9yZWdyb3VuZCB3aXRoIGFyZ3VtZW50czogJHtKU09OLnN0cmluZ2lmeShhcmdzKX1gKTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYWRiLnN0YXJ0QXBwKGFyZ3MpO1xufTtcblxuY29tbWFuZHMuZ2V0U3RyaW5ncyA9IGFzeW5jIGZ1bmN0aW9uIChsYW5ndWFnZSkge1xuICBpZiAoIWxhbmd1YWdlKSB7XG4gICAgbGFuZ3VhZ2UgPSBhd2FpdCB0aGlzLmFkYi5nZXREZXZpY2VMYW5ndWFnZSgpO1xuICAgIGxvZy5pbmZvKGBObyBsYW5ndWFnZSBzcGVjaWZpZWQsIHJldHVybmluZyBzdHJpbmdzIGZvcjogJHtsYW5ndWFnZX1gKTtcbiAgfVxuXG4gIC8vIENsaWVudHMgcmVxdWlyZSB0aGUgcmVzdWx0aW5nIG1hcHBpbmcgdG8gaGF2ZSBib3RoIGtleXNcbiAgLy8gYW5kIHZhbHVlcyBvZiB0eXBlIHN0cmluZ1xuICBjb25zdCBwcmVwcm9jZXNzU3RyaW5nc01hcCA9IChtYXBwaW5nKSA9PiB7XG4gICAgY29uc3QgcmVzdWx0ID0ge307XG4gICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgXy50b1BhaXJzKG1hcHBpbmcpKSB7XG4gICAgICByZXN1bHRba2V5XSA9IF8uaXNTdHJpbmcodmFsdWUpID8gdmFsdWUgOiBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgaWYgKHRoaXMuYXBrU3RyaW5nc1tsYW5ndWFnZV0pIHtcbiAgICAvLyBSZXR1cm4gY2FjaGVkIHN0cmluZ3NcbiAgICByZXR1cm4gcHJlcHJvY2Vzc1N0cmluZ3NNYXAodGhpcy5hcGtTdHJpbmdzW2xhbmd1YWdlXSk7XG4gIH1cblxuICB0aGlzLmFwa1N0cmluZ3NbbGFuZ3VhZ2VdID0gYXdhaXQgYW5kcm9pZEhlbHBlcnMucHVzaFN0cmluZ3MobGFuZ3VhZ2UsIHRoaXMuYWRiLCB0aGlzLm9wdHMpO1xuICBpZiAodGhpcy5ib290c3RyYXApIHtcbiAgICAvLyBUT0RPOiBUaGlzIGlzIG11dGF0aW5nIHRoZSBjdXJyZW50IGxhbmd1YWdlLCBidXQgaXQncyBob3cgYXBwaXVtIGN1cnJlbnRseSB3b3Jrc1xuICAgIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ3VwZGF0ZVN0cmluZ3MnKTtcbiAgfVxuXG4gIHJldHVybiBwcmVwcm9jZXNzU3RyaW5nc01hcCh0aGlzLmFwa1N0cmluZ3NbbGFuZ3VhZ2VdKTtcbn07XG5cbmNvbW1hbmRzLmxhdW5jaEFwcCA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgYXdhaXQgdGhpcy5pbml0QVVUKCk7XG4gIGF3YWl0IHRoaXMuc3RhcnRBVVQoKTtcbn07XG5cbmNvbW1hbmRzLnN0YXJ0QWN0aXZpdHkgPSBhc3luYyBmdW5jdGlvbiAoYXBwUGFja2FnZSwgYXBwQWN0aXZpdHksXG4gIGFwcFdhaXRQYWNrYWdlLCBhcHBXYWl0QWN0aXZpdHksIGludGVudEFjdGlvbiwgaW50ZW50Q2F0ZWdvcnksIGludGVudEZsYWdzLFxuICBvcHRpb25hbEludGVudEFyZ3VtZW50cywgZG9udFN0b3BBcHBPblJlc2V0KSB7XG4gIGxvZy5kZWJ1ZyhgU3RhcnRpbmcgcGFja2FnZSAnJHthcHBQYWNrYWdlfScgYW5kIGFjdGl2aXR5ICcke2FwcEFjdGl2aXR5fSdgKTtcblxuICAvLyBkb250U3RvcEFwcE9uUmVzZXQgaXMgYm90aCBhbiBhcmd1bWVudCBoZXJlLCBhbmQgYSBkZXNpcmVkIGNhcGFiaWxpdHlcbiAgLy8gaWYgdGhlIGFyZ3VtZW50IGlzIHNldCwgdXNlIGl0LCBvdGhlcndpc2UgdXNlIHRoZSBjYXBcbiAgaWYgKCF1dGlsLmhhc1ZhbHVlKGRvbnRTdG9wQXBwT25SZXNldCkpIHtcbiAgICBkb250U3RvcEFwcE9uUmVzZXQgPSAhIXRoaXMub3B0cy5kb250U3RvcEFwcE9uUmVzZXQ7XG4gIH1cblxuICBsZXQgYXJncyA9IHtcbiAgICBwa2c6IGFwcFBhY2thZ2UsXG4gICAgYWN0aXZpdHk6IGFwcEFjdGl2aXR5LFxuICAgIHdhaXRQa2c6IGFwcFdhaXRQYWNrYWdlIHx8IGFwcFBhY2thZ2UsXG4gICAgd2FpdEFjdGl2aXR5OiBhcHBXYWl0QWN0aXZpdHkgfHwgYXBwQWN0aXZpdHksXG4gICAgYWN0aW9uOiBpbnRlbnRBY3Rpb24sXG4gICAgY2F0ZWdvcnk6IGludGVudENhdGVnb3J5LFxuICAgIGZsYWdzOiBpbnRlbnRGbGFncyxcbiAgICBvcHRpb25hbEludGVudEFyZ3VtZW50cyxcbiAgICBzdG9wQXBwOiAhZG9udFN0b3BBcHBPblJlc2V0XG4gIH07XG4gIHRoaXMuX2NhY2hlZEFjdGl2aXR5QXJncyA9IHRoaXMuX2NhY2hlZEFjdGl2aXR5QXJncyB8fCB7fTtcbiAgdGhpcy5fY2FjaGVkQWN0aXZpdHlBcmdzW2Ake2FyZ3Mud2FpdFBrZ30vJHthcmdzLndhaXRBY3Rpdml0eX1gXSA9IGFyZ3M7XG4gIGF3YWl0IHRoaXMuYWRiLnN0YXJ0QXBwKGFyZ3MpO1xufTtcblxuY29tbWFuZHMucmVzZXQgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGF3YWl0IGFuZHJvaWRIZWxwZXJzLnJlc2V0QXBwKHRoaXMuYWRiLCBPYmplY3QuYXNzaWduKHt9LCB0aGlzLm9wdHMsIHtmYXN0UmVzZXQ6IHRydWV9KSk7XG4gIC8vIHJlc2V0IGNvbnRleHQgc2luY2Ugd2UgZG9uJ3Qga25vdyB3aGF0IGtpbmQgb24gY29udGV4dCB3ZSB3aWxsIGVuZCB1cCBhZnRlciBhcHAgbGF1bmNoLlxuICBhd2FpdCB0aGlzLnNldENvbnRleHQoKTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuaXNDaHJvbWVTZXNzaW9uID8gdGhpcy5zdGFydENocm9tZVNlc3Npb24oKSA6IHRoaXMuc3RhcnRBVVQoKTtcbn07XG5cbmNvbW1hbmRzLnN0YXJ0QVVUID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICBhd2FpdCB0aGlzLmFkYi5zdGFydEFwcCh7XG4gICAgcGtnOiB0aGlzLm9wdHMuYXBwUGFja2FnZSxcbiAgICBhY3Rpdml0eTogdGhpcy5vcHRzLmFwcEFjdGl2aXR5LFxuICAgIGFjdGlvbjogdGhpcy5vcHRzLmludGVudEFjdGlvbixcbiAgICBjYXRlZ29yeTogdGhpcy5vcHRzLmludGVudENhdGVnb3J5LFxuICAgIGZsYWdzOiB0aGlzLm9wdHMuaW50ZW50RmxhZ3MsXG4gICAgd2FpdFBrZzogdGhpcy5vcHRzLmFwcFdhaXRQYWNrYWdlLFxuICAgIHdhaXRBY3Rpdml0eTogdGhpcy5vcHRzLmFwcFdhaXRBY3Rpdml0eSxcbiAgICB3YWl0RHVyYXRpb246IHRoaXMub3B0cy5hcHBXYWl0RHVyYXRpb24sXG4gICAgb3B0aW9uYWxJbnRlbnRBcmd1bWVudHM6IHRoaXMub3B0cy5vcHRpb25hbEludGVudEFyZ3VtZW50cyxcbiAgICBzdG9wQXBwOiAhdGhpcy5vcHRzLmRvbnRTdG9wQXBwT25SZXNldCxcbiAgICB1c2VyOiB0aGlzLm9wdHMudXNlclByb2ZpbGUsXG4gIH0pO1xufTtcblxuLy8gd2Ugb3ZlcnJpZGUgc2V0VXJsIHRvIHRha2UgYW4gYW5kcm9pZCBVUkkgd2hpY2ggY2FuIGJlIHVzZWQgZm9yIGRlZXAtbGlua2luZ1xuLy8gaW5zaWRlIGFuIGFwcCwgc2ltaWxhciB0byBzdGFydGluZyBhbiBpbnRlbnRcbmNvbW1hbmRzLnNldFVybCA9IGFzeW5jIGZ1bmN0aW9uICh1cmkpIHtcbiAgYXdhaXQgdGhpcy5hZGIuc3RhcnRVcmkodXJpLCB0aGlzLm9wdHMuYXBwUGFja2FnZSk7XG59O1xuXG4vLyBjbG9zaW5nIGFwcCB1c2luZyBmb3JjZSBzdG9wXG5jb21tYW5kcy5jbG9zZUFwcCA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgYXdhaXQgdGhpcy5hZGIuZm9yY2VTdG9wKHRoaXMub3B0cy5hcHBQYWNrYWdlKTtcbiAgLy8gcmVzZXQgY29udGV4dCBzaW5jZSB3ZSBkb24ndCBrbm93IHdoYXQga2luZCBvbiBjb250ZXh0IHdlIHdpbGwgZW5kIHVwIGFmdGVyIGFwcCBsYXVuY2guXG4gIGF3YWl0IHRoaXMuc2V0Q29udGV4dCgpO1xufTtcblxuY29tbWFuZHMuZ2V0RGlzcGxheURlbnNpdHkgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIC8vIGZpcnN0IHRyeSB0aGUgcHJvcGVydHkgZm9yIGRldmljZXNcbiAgbGV0IG91dCA9IGF3YWl0IHRoaXMuYWRiLnNoZWxsKFsnZ2V0cHJvcCcsICdyby5zZi5sY2RfZGVuc2l0eSddKTtcbiAgaWYgKG91dCkge1xuICAgIGxldCB2YWwgPSBwYXJzZUludChvdXQsIDEwKTtcbiAgICAvLyBpZiB0aGUgdmFsdWUgaXMgTmFOLCB0cnkgZ2V0dGluZyB0aGUgZW11bGF0b3IgcHJvcGVydHlcbiAgICBpZiAoIWlzTmFOKHZhbCkpIHtcbiAgICAgIHJldHVybiB2YWw7XG4gICAgfVxuICAgIGxvZy5kZWJ1ZyhgUGFyc2VkIGRlbnNpdHkgdmFsdWUgd2FzIE5hTjogXCIke291dH1cImApO1xuICB9XG4gIC8vIGZhbGxiYWNrIHRvIHRyeWluZyBwcm9wZXJ0eSBmb3IgZW11bGF0b3JzXG4gIG91dCA9IGF3YWl0IHRoaXMuYWRiLnNoZWxsKFsnZ2V0cHJvcCcsICdxZW11LnNmLmxjZF9kZW5zaXR5J10pO1xuICBpZiAob3V0KSB7XG4gICAgbGV0IHZhbCA9IHBhcnNlSW50KG91dCwgMTApO1xuICAgIGlmICghaXNOYU4odmFsKSkge1xuICAgICAgcmV0dXJuIHZhbDtcbiAgICB9XG4gICAgbG9nLmRlYnVnKGBQYXJzZWQgZGVuc2l0eSB2YWx1ZSB3YXMgTmFOOiBcIiR7b3V0fVwiYCk7XG4gIH1cbiAgLy8gY291bGRuJ3QgZ2V0IGFueXRoaW5nLCBzbyBlcnJvciBvdXRcbiAgbG9nLmVycm9yQW5kVGhyb3coJ0ZhaWxlZCB0byBnZXQgZGlzcGxheSBkZW5zaXR5IHByb3BlcnR5LicpO1xufTtcblxuLyoqXG4gKiBQYXJzZXMgdGhlIGdpdmVuIHdpbmRvdyBtYW5hZ2VyIFN1cmZhY2Ugc3RyaW5nIHRvIGdldCBpbmZvLlxuICogQHBhcmFtIGxpbmU6IFRvIHBhcnNlLiBUaGlzIGlzIGFzc3VtZWQgdG8gYmUgdmFsaWQuXG4gKiBAcmV0dXJuOiBWaXNpYmlsaXR5IGFuZCBib3VuZHMgb2YgdGhlIFN1cmZhY2UuXG4gKi9cbmZ1bmN0aW9uIHBhcnNlU3VyZmFjZUxpbmUgKGxpbmUpIHtcbiAgLy8gdGhlIHN1cmZhY2UgYm91bmRzIGFyZSBpbiB0aGUgZm9ybWF0OlxuICAvLyBcInJlY3Q9KDAuMCwxMTg0LjApIDc2OC4wIHggOTYuMFwiXG4gIC8vICAgICAgIF4gbG9jYXRpb24gICBeIHNpemVcbiAgLy8gY3V0IG91dCB0aGUgc3R1ZmYgYmVmb3JlIHRoZSAncmVjdCcgYW5kIHRoZW4gc3BsaXQgdGhlIG51bWJlcnMgYXBhcnRcbiAgbGV0IGJvdW5kcyA9IGxpbmUuc3BsaXQoJ3JlY3Q9JylbMV1cbiAgLnJlcGxhY2UoL1soKSwgeF0rL2csICcgJylcbiAgLnRyaW0oKVxuICAuc3BsaXQoJyAnKTtcblxuICByZXR1cm4ge1xuICAgIHZpc2libGU6IChsaW5lLmluZGV4T2YoJ3Nob3duPXRydWUnKSAhPT0gLTEpLFxuICAgIHg6IHBhcnNlRmxvYXQoYm91bmRzWzBdKSxcbiAgICB5OiBwYXJzZUZsb2F0KGJvdW5kc1sxXSksXG4gICAgd2lkdGg6IHBhcnNlRmxvYXQoYm91bmRzWzJdKSxcbiAgICBoZWlnaHQ6IHBhcnNlRmxvYXQoYm91bmRzWzNdKVxuICB9O1xufVxuXG4vKipcbiAqIEV4dHJhY3RzIHN0YXR1cyBhbmQgbmF2aWdhdGlvbiBiYXIgaW5mb3JtYXRpb24gZnJvbSB0aGUgd2luZG93IG1hbmFnZXIgb3V0cHV0LlxuICogQHBhcmFtIGxpbmVzOiBPdXRwdXQgZnJvbSBkdW1wc3lzIGNvbW1hbmRcbiAqIEByZXR1cm46IFZpc2liaWxpdHkgYW5kIGJvdW5kcyBpbmZvIG9mIHN0YXR1cyBhbmQgbmF2aWdhdGlvbiBiYXJcbiAqL1xuZnVuY3Rpb24gcGFyc2VXaW5kb3dzIChsaW5lcykge1xuICBsZXQgYXRTdGF0dXNCYXIgPSBmYWxzZTtcbiAgbGV0IGF0TmF2QmFyID0gZmFsc2U7XG4gIGxldCBzdGF0dXNCYXI7XG4gIGxldCBuYXZpZ2F0aW9uQmFyO1xuICAvLyB0aGUgd2luZG93IG1hbmFnZXIgb3V0cHV0IGxvb2tzIGxpa2U6XG4gIC8vIFdpbmRvdyAjMSAuLi4gV2luZG93SURcbiAgLy8gICBBIGJ1bmNoIG9mIHByb3BlcnRpZXNcbiAgLy8gV2luZG93ICMyIC4uLiBXaW5kb3dJRFxuICAvLyAgIEEgYnVuY2ggb2YgcHJvcGVydGllc1xuICBsaW5lcy5zcGxpdCgnXFxuJykuZm9yRWFjaCgobGluZSkgPT4ge1xuICAgIC8vIHRoZSBzdGFydCBvZiBhIG5ldyB3aW5kb3cgc2VjdGlvblxuICAgIGlmIChsaW5lLmluZGV4T2YoJyAgV2luZG93ICMnKSAhPT0gLTEpIHtcbiAgICAgIC8vIGRldGVybWluZSB3aGljaCBzZWN0aW9uIHdlJ3JlIGluXG4gICAgICAvLyBvbmx5IG9uZSB3aWxsIGJlIHRydWVcbiAgICAgIGF0U3RhdHVzQmFyID0gKGxpbmUuaW5kZXhPZignU3RhdHVzQmFyJykgIT09IC0xKTtcbiAgICAgIGF0TmF2QmFyID0gKGxpbmUuaW5kZXhPZignTmF2aWdhdGlvbkJhcicpICE9PSAtMSk7XG4gICAgICAvLyBkb24ndCBuZWVkIGFueXRoaW5nIGVsc2UuIG1vdmUgdG8gbmV4dCBsaW5lXG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIG9uY2Ugd2UncmUgaW4gYSB3aW5kb3cgc2VjdGlvbiwgbG9vayBmb3IgdGhlIHN1cmZhY2UgZGF0YSBsaW5lXG4gICAgaWYgKGxpbmUuaW5kZXhPZignICAgICAgU3VyZmFjZTonKSA9PT0gLTEpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGF0U3RhdHVzQmFyKSB7XG4gICAgICBzdGF0dXNCYXIgPSBwYXJzZVN1cmZhY2VMaW5lKGxpbmUpO1xuICAgICAgYXRTdGF0dXNCYXIgPSBmYWxzZTtcbiAgICB9IGVsc2UgaWYgKGF0TmF2QmFyKSB7XG4gICAgICBuYXZpZ2F0aW9uQmFyID0gcGFyc2VTdXJmYWNlTGluZShsaW5lKTtcbiAgICAgIGF0TmF2QmFyID0gZmFsc2U7XG4gICAgfVxuICB9KTtcblxuICBpZiAoIXN0YXR1c0Jhcikge1xuICAgIGxvZy5lcnJvckFuZFRocm93KCdGYWlsZWQgdG8gcGFyc2Ugc3RhdHVzIGJhciBpbmZvcm1hdGlvbi4nKTtcbiAgfVxuICBpZiAoIW5hdmlnYXRpb25CYXIpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdygnRmFpbGVkIHRvIHBhcnNlIG5hdmlnYXRpb24gYmFyIGluZm9ybWF0aW9uLicpO1xuICB9XG5cbiAgcmV0dXJuIHtzdGF0dXNCYXIsIG5hdmlnYXRpb25CYXJ9O1xufVxuXG5jb21tYW5kcy5nZXRTeXN0ZW1CYXJzID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICBsZXQgb3V0ID0gYXdhaXQgdGhpcy5hZGIuc2hlbGwoWydkdW1wc3lzJywgJ3dpbmRvdycsICd3aW5kb3dzJ10pO1xuICBpZiAoIW91dCkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KCdEaWQgbm90IGdldCB3aW5kb3cgbWFuYWdlciBvdXRwdXQuJyk7XG4gIH1cbiAgcmV0dXJuIHBhcnNlV2luZG93cyhvdXQpO1xufTtcblxuY29tbWFuZHMubW9iaWxlUGVyZm9ybUVkaXRvckFjdGlvbiA9IGFzeW5jIGZ1bmN0aW9uIChvcHRzID0ge30pIHtcbiAgY29uc3Qge2FjdGlvbn0gPSBvcHRzO1xuICBpZiAoIXV0aWwuaGFzVmFsdWUoYWN0aW9uKSkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KGAnYWN0aW9uJyBhcmd1bWVudCBpcyByZXF1aXJlZGApO1xuICB9XG5cbiAgYXdhaXQgdGhpcy5hZGIucGVyZm9ybUVkaXRvckFjdGlvbihhY3Rpb24pO1xufTtcblxuY29uc3QgUEVSTUlTU0lPTl9BQ1RJT04gPSB7XG4gIEdSQU5UOiAnZ3JhbnQnLFxuICBSRVZPS0U6ICdyZXZva2UnLFxufTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBDaGFuZ2VQZXJtaXNzaW9uc09wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7IXN0cmluZ3xBcnJheTxzdHJpbmc+fSBwZXJtaXNzaW9ucyAtIFRoZSBmdWxsIG5hbWUgb2YgdGhlIHBlcm1pc3Npb24gdG8gYmUgY2hhbmdlZFxuICogb3IgYSBsaXN0IG9mIHBlcm1pc3Npb25zLiBNYW5kYXRvcnkgYXJndW1lbnQuXG4gKiBAcHJvcGVydHkge3N0cmluZ30gYXBwUGFja2FnZSBbdGhpcy5vcHRzLmFwcFBhY2thZ2VdIC0gVGhlIGFwcGxpY2F0aW9uIHBhY2thZ2UgdG8gc2V0IGNoYW5nZVxuICogcGVybWlzc2lvbnMgb24uIERlZmF1bHRzIHRvIHRoZSBwYWNrYWdlIG5hbWUgdW5kZXIgdGVzdC5cbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBhY3Rpb24gW2dyYW50XSAtIE9uZSBvZiBgUEVSTUlTU0lPTl9BQ1RJT05gIHZhbHVlc1xuICovXG5cbi8qKlxuICogQ2hhbmdlcyBwYWNrYWdlIHBlcm1pc3Npb25zIGluIHJ1bnRpbWUuXG4gKlxuICogQHBhcmFtIHs/Q2hhbmdlUGVybWlzc2lvbnNPcHRpb25zfSBvcHRzIC0gQXZhaWxhYmxlIG9wdGlvbnMgbWFwcGluZy5cbiAqIEB0aHJvd3Mge0Vycm9yfSBpZiB0aGVyZSB3YXMgYSBmYWlsdXJlIHdoaWxlIGNoYW5naW5nIHBlcm1pc3Npb25zXG4gKi9cbmNvbW1hbmRzLm1vYmlsZUNoYW5nZVBlcm1pc3Npb25zID0gYXN5bmMgZnVuY3Rpb24gKG9wdHMgPSB7fSkge1xuICBjb25zdCB7XG4gICAgcGVybWlzc2lvbnMsXG4gICAgYXBwUGFja2FnZSA9IHRoaXMub3B0cy5hcHBQYWNrYWdlLFxuICAgIGFjdGlvbiA9IFBFUk1JU1NJT05fQUNUSU9OLkdSQU5ULFxuICB9ID0gb3B0cztcbiAgaWYgKCF1dGlsLmhhc1ZhbHVlKHBlcm1pc3Npb25zKSkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KGAncGVybWlzc2lvbnMnIGFyZ3VtZW50IGlzIHJlcXVpcmVkYCk7XG4gIH1cblxuICBsZXQgYWN0aW9uRnVuYztcbiAgc3dpdGNoIChfLnRvTG93ZXIoYWN0aW9uKSkge1xuICAgIGNhc2UgUEVSTUlTU0lPTl9BQ1RJT04uR1JBTlQ6XG4gICAgICBhY3Rpb25GdW5jID0gKGFwcFBhY2thZ2UsIHBlcm1pc3Npb24pID0+IHRoaXMuYWRiLmdyYW50UGVybWlzc2lvbihhcHBQYWNrYWdlLCBwZXJtaXNzaW9uKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgUEVSTUlTU0lPTl9BQ1RJT04uUkVWT0tFOlxuICAgICAgYWN0aW9uRnVuYyA9IChhcHBQYWNrYWdlLCBwZXJtaXNzaW9uKSA9PiB0aGlzLmFkYi5yZXZva2VQZXJtaXNzaW9uKGFwcFBhY2thZ2UsIHBlcm1pc3Npb24pO1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIGxvZy5lcnJvckFuZFRocm93KGBVbmtub3duIGFjdGlvbiAnJHthY3Rpb259Jy4gYCArXG4gICAgICAgIGBPbmx5ICR7SlNPTi5zdHJpbmdpZnkoXy52YWx1ZXMoUEVSTUlTU0lPTl9BQ1RJT04pKX0gYWN0aW9ucyBhcmUgc3VwcG9ydGVkYCk7XG4gICAgICBicmVhaztcbiAgfVxuICBmb3IgKGNvbnN0IHBlcm1pc3Npb24gb2YgKF8uaXNBcnJheShwZXJtaXNzaW9ucykgPyBwZXJtaXNzaW9ucyA6IFtwZXJtaXNzaW9uc10pKSB7XG4gICAgYXdhaXQgYWN0aW9uRnVuYyhhcHBQYWNrYWdlLCBwZXJtaXNzaW9uKTtcbiAgfVxufTtcblxuY29uc3QgUEVSTUlTU0lPTlNfVFlQRSA9IHtcbiAgREVOSUVEOiAnZGVuaWVkJyxcbiAgR1JBTlRFRDogJ2dyYW50ZWQnLFxuICBSRVFVRVNURUQ6ICdyZXF1ZXN0ZWQnLFxufTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBHZXRQZXJtaXNzaW9uc09wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB0eXBlIFtyZXF1ZXN0ZWRdIC0gT25lIG9mIHBvc3NpYmxlIHBlcm1pc3Npb24gdHlwZXMgdG8gZ2V0LlxuICogQ2FuIGJlIGFueSBvZiBgUEVSTUlTU0lPTlNfVFlQRWAgdmFsdWVzLlxuICogQHByb3BlcnR5IHtzdHJpbmd9IGFwcFBhY2thZ2UgW3RoaXMub3B0cy5hcHBQYWNrYWdlXSAtIFRoZSBhcHBsaWNhdGlvbiBwYWNrYWdlIHRvIHNldCBjaGFuZ2VcbiAqIHBlcm1pc3Npb25zIG9uLiBEZWZhdWx0cyB0byB0aGUgcGFja2FnZSBuYW1lIHVuZGVyIHRlc3QuXG4gKi9cblxuLyoqXG4gKiBHZXRzIHJ1bnRpbWUgcGVybWlzc2lvbnMgbGlzdCBmb3IgdGhlIGdpdmVuIGFwcGxpY2F0aW9uIHBhY2thZ2UuXG4gKlxuICogQHBhcmFtIHtHZXRQZXJtaXNzaW9uc09wdGlvbnN9IG9wdHMgLSBBdmFpbGFibGUgb3B0aW9ucyBtYXBwaW5nLlxuICogQHJldHVybnMge0FycmF5PHN0cmluZz59IFRoZSBsaXN0IG9mIHJldHJpZXZlZCBwZXJtaXNzaW9ucyBmb3IgdGhlIGdpdmVuIHR5cGVcbiAqIChjYW4gYWxzbyBiZSBlbXB0eSkuXG4gKiBAdGhyb3dzIHtFcnJvcn0gaWYgdGhlcmUgd2FzIGFuIGVycm9yIHdoaWxlIGdldHRpbmcgcGVybWlzc2lvbnMuXG4gKi9cbmNvbW1hbmRzLm1vYmlsZUdldFBlcm1pc3Npb25zID0gYXN5bmMgZnVuY3Rpb24gKG9wdHMgPSB7fSkge1xuICBjb25zdCB7XG4gICAgdHlwZSA9IFBFUk1JU1NJT05TX1RZUEUuUkVRVUVTVEVELFxuICAgIGFwcFBhY2thZ2UgPSB0aGlzLm9wdHMuYXBwUGFja2FnZSxcbiAgfSA9IG9wdHM7XG5cbiAgbGV0IGFjdGlvbkZ1bmM7XG4gIHN3aXRjaCAoXy50b0xvd2VyKHR5cGUpKSB7XG4gICAgY2FzZSBQRVJNSVNTSU9OU19UWVBFLlJFUVVFU1RFRDpcbiAgICAgIGFjdGlvbkZ1bmMgPSAoYXBwUGFja2FnZSkgPT4gdGhpcy5hZGIuZ2V0UmVxUGVybWlzc2lvbnMoYXBwUGFja2FnZSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlIFBFUk1JU1NJT05TX1RZUEUuR1JBTlRFRDpcbiAgICAgIGFjdGlvbkZ1bmMgPSAoYXBwUGFja2FnZSkgPT4gdGhpcy5hZGIuZ2V0R3JhbnRlZFBlcm1pc3Npb25zKGFwcFBhY2thZ2UpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSBQRVJNSVNTSU9OU19UWVBFLkRFTklFRDpcbiAgICAgIGFjdGlvbkZ1bmMgPSAoYXBwUGFja2FnZSkgPT4gdGhpcy5hZGIuZ2V0RGVuaWVkUGVybWlzc2lvbnMoYXBwUGFja2FnZSk7XG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgICAgbG9nLmVycm9yQW5kVGhyb3coYFVua25vd24gcGVybWlzc2lvbnMgdHlwZSAnJHt0eXBlfScuIGAgK1xuICAgICAgICBgT25seSAke0pTT04uc3RyaW5naWZ5KF8udmFsdWVzKFBFUk1JU1NJT05TX1RZUEUpKX0gdHlwZXMgYXJlIHN1cHBvcnRlZGApO1xuICAgICAgYnJlYWs7XG4gIH1cbiAgcmV0dXJuIGF3YWl0IGFjdGlvbkZ1bmMoYXBwUGFja2FnZSk7XG59O1xuXG5PYmplY3QuYXNzaWduKGV4dGVuc2lvbnMsIGNvbW1hbmRzLCBoZWxwZXJzKTtcbmV4cG9ydCB7IGNvbW1hbmRzLCBoZWxwZXJzIH07XG5leHBvcnQgZGVmYXVsdCBleHRlbnNpb25zO1xuLy8gZm9yIHVuaXQgdGVzdHNcbmV4cG9ydCB7IHBhcnNlV2luZG93cywgcGFyc2VTdXJmYWNlTGluZSB9O1xuIl0sImZpbGUiOiJsaWIvY29tbWFuZHMvZ2VuZXJhbC5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
