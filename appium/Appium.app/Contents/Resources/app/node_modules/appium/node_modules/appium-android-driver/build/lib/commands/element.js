"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.helpers = exports.commands = void 0;

require("source-map-support/register");

var _androidHelpers = _interopRequireDefault(require("../android-helpers"));

var _asyncbox = require("asyncbox");

var _logger = _interopRequireDefault(require("../logger"));

let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;

commands.getAttribute = async function (attribute, elementId) {
  let p = {
    attribute,
    elementId
  };
  return await this.bootstrap.sendAction('element:getAttribute', p);
};

commands.getName = async function (elementId) {
  return await this.getAttribute('className', elementId);
};

commands.elementDisplayed = async function (elementId) {
  return (await this.getAttribute('displayed', elementId)) === 'true';
};

commands.elementEnabled = async function (elementId) {
  return (await this.getAttribute('enabled', elementId)) === 'true';
};

commands.elementSelected = async function (elementId) {
  return (await this.getAttribute('selected', elementId)) === 'true';
};

helpers.setElementValue = async function (keys, elementId, replace = false) {
  let text = keys;

  if (keys instanceof Array) {
    text = keys.join('');
  }

  let params = {
    elementId,
    text,
    replace,
    unicodeKeyboard: this.opts.unicodeKeyboard
  };
  return await this.doSetElementValue(params);
};

helpers.doSetElementValue = async function (params) {
  return await this.bootstrap.sendAction('element:setText', params);
};

commands.setValue = async function (keys, elementId) {
  return await this.setElementValue(keys, elementId, false);
};

commands.replaceValue = async function (keys, elementId) {
  return await this.setElementValue(keys, elementId, true);
};

commands.setValueImmediate = async function (keys, elementId) {
  let text = keys;

  if (keys instanceof Array) {
    text = keys.join('');
  }

  await this.click(elementId);
  await this.adb.inputText(text);
};

commands.getText = async function (elementId) {
  return await this.bootstrap.sendAction('element:getText', {
    elementId
  });
};

commands.clear = async function (elementId) {
  let text = (await this.getText(elementId)) || '';
  let length = text.length;

  if (length === 0) {
    length = 100;
  }

  await this.click(elementId);

  _logger.default.debug(`Sending up to ${length} clear characters to device`);

  return await (0, _asyncbox.retryInterval)(5, 500, async () => {
    let remainingLength = length;

    while (remainingLength > 0) {
      let lengthToSend = remainingLength < 50 ? remainingLength : 50;

      _logger.default.debug(`Sending ${lengthToSend} clear characters to device`);

      await this.adb.clearTextField(lengthToSend);
      remainingLength -= lengthToSend;
    }
  });
};

commands.click = async function (elementId) {
  return await this.bootstrap.sendAction('element:click', {
    elementId
  });
};

commands.getLocation = async function (elementId) {
  return await this.bootstrap.sendAction('element:getLocation', {
    elementId
  });
};

commands.getLocationInView = async function (elementId) {
  return await this.getLocation(elementId);
};

commands.getSize = async function (elementId) {
  return await this.bootstrap.sendAction('element:getSize', {
    elementId
  });
};

commands.getElementRect = async function (elementId) {
  return await this.bootstrap.sendAction('element:getRect', {
    elementId
  });
};

commands.touchLongClick = async function (elementId, x, y, duration) {
  let params = {
    elementId,
    x,
    y,
    duration
  };

  _androidHelpers.default.removeNullProperties(params);

  return await this.bootstrap.sendAction('element:touchLongClick', params);
};

commands.touchDown = async function (elementId, x, y) {
  let params = {
    elementId,
    x,
    y
  };

  _androidHelpers.default.removeNullProperties(params);

  return await this.bootstrap.sendAction('element:touchDown', params);
};

commands.touchUp = async function (elementId, x, y) {
  let params = {
    elementId,
    x,
    y
  };

  _androidHelpers.default.removeNullProperties(params);

  return await this.bootstrap.sendAction('element:touchUp', params);
};

commands.touchMove = async function (elementId, x, y) {
  let params = {
    elementId,
    x,
    y
  };

  _androidHelpers.default.removeNullProperties(params);

  return await this.bootstrap.sendAction('element:touchMove', params);
};

commands.complexTap = async function (tapCount, touchCount, duration, x, y) {
  return await this.bootstrap.sendAction('click', {
    x,
    y
  });
};

commands.tap = async function (elementId, x = 0, y = 0, count = 1) {
  for (let i = 0; i < count; i++) {
    if (elementId) {
      if (x !== 0 || y !== 0) {
        await this.bootstrap.sendAction('element:click', {
          elementId,
          x,
          y
        });
      } else {
        await this.bootstrap.sendAction('element:click', {
          elementId
        });
      }
    } else {
      await this.bootstrap.sendAction('click', {
        x,
        y
      });
    }
  }
};

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9lbGVtZW50LmpzIl0sIm5hbWVzIjpbImNvbW1hbmRzIiwiaGVscGVycyIsImV4dGVuc2lvbnMiLCJnZXRBdHRyaWJ1dGUiLCJhdHRyaWJ1dGUiLCJlbGVtZW50SWQiLCJwIiwiYm9vdHN0cmFwIiwic2VuZEFjdGlvbiIsImdldE5hbWUiLCJlbGVtZW50RGlzcGxheWVkIiwiZWxlbWVudEVuYWJsZWQiLCJlbGVtZW50U2VsZWN0ZWQiLCJzZXRFbGVtZW50VmFsdWUiLCJrZXlzIiwicmVwbGFjZSIsInRleHQiLCJBcnJheSIsImpvaW4iLCJwYXJhbXMiLCJ1bmljb2RlS2V5Ym9hcmQiLCJvcHRzIiwiZG9TZXRFbGVtZW50VmFsdWUiLCJzZXRWYWx1ZSIsInJlcGxhY2VWYWx1ZSIsInNldFZhbHVlSW1tZWRpYXRlIiwiY2xpY2siLCJhZGIiLCJpbnB1dFRleHQiLCJnZXRUZXh0IiwiY2xlYXIiLCJsZW5ndGgiLCJsb2dnZXIiLCJkZWJ1ZyIsInJlbWFpbmluZ0xlbmd0aCIsImxlbmd0aFRvU2VuZCIsImNsZWFyVGV4dEZpZWxkIiwiZ2V0TG9jYXRpb24iLCJnZXRMb2NhdGlvbkluVmlldyIsImdldFNpemUiLCJnZXRFbGVtZW50UmVjdCIsInRvdWNoTG9uZ0NsaWNrIiwieCIsInkiLCJkdXJhdGlvbiIsImFuZHJvaWRIZWxwZXJzIiwicmVtb3ZlTnVsbFByb3BlcnRpZXMiLCJ0b3VjaERvd24iLCJ0b3VjaFVwIiwidG91Y2hNb3ZlIiwiY29tcGxleFRhcCIsInRhcENvdW50IiwidG91Y2hDb3VudCIsInRhcCIsImNvdW50IiwiaSIsIk9iamVjdCIsImFzc2lnbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFHQSxJQUFJQSxRQUFRLEdBQUcsRUFBZjtBQUFBLElBQW1CQyxPQUFPLEdBQUcsRUFBN0I7QUFBQSxJQUFpQ0MsVUFBVSxHQUFHLEVBQTlDOzs7O0FBRUFGLFFBQVEsQ0FBQ0csWUFBVCxHQUF3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LENBQWVDLFVBQWYsQ0FBMEIsT0FBMUIsRUFBbUM7QUFBQ2tDLElBQUFBLENBQUQ7QUFBSUMsSUFBQUE7QUFBSixHQUFuQyxDQUFiO0FBQ0QsQ0FGRDs7QUFJQTNDLFFBQVEsQ0FBQ3FELEdBQVQsR0FBZSxnQkFBZ0JoRCxTQUFoQixFQUEyQnFDLENBQUMsR0FBRyxDQUEvQixFQUFrQ0MsQ0FBQyxHQUFHLENBQXRDLEVBQXlDVyxLQUFLLEdBQUcsQ0FBakQsRUFBb0Q7QUFDakUsT0FBSyxJQUFJQyxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHRCxLQUFwQixFQUEyQkMsQ0FBQyxFQUE1QixFQUFnQztBQUM5QixRQUFJbEQsU0FBSixFQUFlO0FBR2IsVUFBSXFDLENBQUMsS0FBSyxDQUFOLElBQVdDLENBQUMsS0FBSyxDQUFyQixFQUF3QjtBQUN0QixjQUFNLEtBQUtwQyxTQUFMLENBQWVDLFVBQWYsQ0FBMEIsZUFBMUIsRUFBMkM7QUFBQ0gsVUFBQUEsU0FBRDtBQUFZcUMsVUFBQUEsQ0FBWjtBQUFlQyxVQUFBQTtBQUFmLFNBQTNDLENBQU47QUFDRCxPQUZELE1BRU87QUFDTCxjQUFNLEtBQUtwQyxTQUFMLENBQWVDLFVBQWYsQ0FBMEIsZUFBMUIsRUFBMkM7QUFBQ0gsVUFBQUE7QUFBRCxTQUEzQyxDQUFOO0FBQ0Q7QUFDRixLQVJELE1BUU87QUFDTCxZQUFNLEtBQUtFLFNBQUwsQ0FBZUMsVUFBZixDQUEwQixPQUExQixFQUFtQztBQUFDa0MsUUFBQUEsQ0FBRDtBQUFJQyxRQUFBQTtBQUFKLE9BQW5DLENBQU47QUFDRDtBQUNGO0FBQ0YsQ0FkRDs7QUFnQkFhLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjdkQsVUFBZCxFQUEwQkYsUUFBMUIsRUFBb0NDLE9BQXBDO2VBRWVDLFUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYW5kcm9pZEhlbHBlcnMgZnJvbSAnLi4vYW5kcm9pZC1oZWxwZXJzJztcbmltcG9ydCB7IHJldHJ5SW50ZXJ2YWwgfSBmcm9tICdhc3luY2JveCc7XG5pbXBvcnQgbG9nZ2VyIGZyb20gJy4uL2xvZ2dlcic7XG5cblxubGV0IGNvbW1hbmRzID0ge30sIGhlbHBlcnMgPSB7fSwgZXh0ZW5zaW9ucyA9IHt9O1xuXG5jb21tYW5kcy5nZXRBdHRyaWJ1dGUgPSBhc3luYyBmdW5jdGlvbiAoYXR0cmlidXRlLCBlbGVtZW50SWQpIHtcbiAgbGV0IHAgPSB7YXR0cmlidXRlLCBlbGVtZW50SWR9O1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbignZWxlbWVudDpnZXRBdHRyaWJ1dGUnLCBwKTtcbn07XG5cbmNvbW1hbmRzLmdldE5hbWUgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLmdldEF0dHJpYnV0ZSgnY2xhc3NOYW1lJywgZWxlbWVudElkKTtcbn07XG5cbmNvbW1hbmRzLmVsZW1lbnREaXNwbGF5ZWQgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLmdldEF0dHJpYnV0ZSgnZGlzcGxheWVkJywgZWxlbWVudElkKSA9PT0gJ3RydWUnO1xufTtcblxuY29tbWFuZHMuZWxlbWVudEVuYWJsZWQgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLmdldEF0dHJpYnV0ZSgnZW5hYmxlZCcsIGVsZW1lbnRJZCkgPT09ICd0cnVlJztcbn07XG5cbmNvbW1hbmRzLmVsZW1lbnRTZWxlY3RlZCA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuZ2V0QXR0cmlidXRlKCdzZWxlY3RlZCcsIGVsZW1lbnRJZCkgPT09ICd0cnVlJztcbn07XG5cbmhlbHBlcnMuc2V0RWxlbWVudFZhbHVlID0gYXN5bmMgZnVuY3Rpb24gKGtleXMsIGVsZW1lbnRJZCwgcmVwbGFjZSA9IGZhbHNlKSB7XG4gIGxldCB0ZXh0ID0ga2V5cztcbiAgaWYgKGtleXMgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgIHRleHQgPSBrZXlzLmpvaW4oJycpO1xuICB9XG5cbiAgbGV0IHBhcmFtcyA9IHtcbiAgICBlbGVtZW50SWQsXG4gICAgdGV4dCxcbiAgICByZXBsYWNlLFxuICAgIHVuaWNvZGVLZXlib2FyZDogdGhpcy5vcHRzLnVuaWNvZGVLZXlib2FyZFxuICB9O1xuXG4gIHJldHVybiBhd2FpdCB0aGlzLmRvU2V0RWxlbWVudFZhbHVlKHBhcmFtcyk7XG59O1xuXG4vKipcbiAqIFJlYXNvbiBmb3IgaXNvbGF0aW5nIGRvU2V0RWxlbWVudFZhbHVlIGZyb20gc2V0RWxlbWVudFZhbHVlIGlzIGZvciByZXVzaW5nIHNldEVsZW1lbnRWYWx1ZVxuICogYWNyb3NzIGFuZHJvaWQtZHJpdmVycyAobGlrZSBhcHBpdW0tdWlhdXRvbWF0b3IyLWRyaXZlcikgYW5kIHRvIGF2b2lkIGNvZGUgZHVwbGljYXRpb24uXG4gKiBPdGhlciBhbmRyb2lkLWRyaXZlcnMgKGxpa2UgYXBwaXVtLXVpYXV0b21hdG9yMi1kcml2ZXIpIG5lZWQgdG8gb3ZlcnJpZGUgZG9TZXRFbGVtZW50VmFsdWVcbiAqIHRvIGZhY2lsaXRhdGUgc2V0RWxlbWVudFZhbHVlLlxuICovXG5oZWxwZXJzLmRvU2V0RWxlbWVudFZhbHVlID0gYXN5bmMgZnVuY3Rpb24gKHBhcmFtcykge1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbignZWxlbWVudDpzZXRUZXh0JywgcGFyYW1zKTtcbn07XG5cbmNvbW1hbmRzLnNldFZhbHVlID0gYXN5bmMgZnVuY3Rpb24gKGtleXMsIGVsZW1lbnRJZCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5zZXRFbGVtZW50VmFsdWUoa2V5cywgZWxlbWVudElkLCBmYWxzZSk7XG59O1xuXG5jb21tYW5kcy5yZXBsYWNlVmFsdWUgPSBhc3luYyBmdW5jdGlvbiAoa2V5cywgZWxlbWVudElkKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLnNldEVsZW1lbnRWYWx1ZShrZXlzLCBlbGVtZW50SWQsIHRydWUpO1xufTtcblxuY29tbWFuZHMuc2V0VmFsdWVJbW1lZGlhdGUgPSBhc3luYyBmdW5jdGlvbiAoa2V5cywgZWxlbWVudElkKSB7XG4gIGxldCB0ZXh0ID0ga2V5cztcbiAgaWYgKGtleXMgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgIHRleHQgPSBrZXlzLmpvaW4oJycpO1xuICB9XG5cbiAgLy8gZmlyc3QsIG1ha2Ugc3VyZSB3ZSBhcmUgZm9jdXNlZCBvbiB0aGUgZWxlbWVudFxuICBhd2FpdCB0aGlzLmNsaWNrKGVsZW1lbnRJZCk7XG5cbiAgLy8gdGhlbiBzZW5kIHRocm91Z2ggYWRiXG4gIGF3YWl0IHRoaXMuYWRiLmlucHV0VGV4dCh0ZXh0KTtcbn07XG5cbmNvbW1hbmRzLmdldFRleHQgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKCdlbGVtZW50OmdldFRleHQnLCB7ZWxlbWVudElkfSk7XG59O1xuXG5jb21tYW5kcy5jbGVhciA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgbGV0IHRleHQgPSAoYXdhaXQgdGhpcy5nZXRUZXh0KGVsZW1lbnRJZCkpIHx8ICcnO1xuICBsZXQgbGVuZ3RoID0gdGV4dC5sZW5ndGg7XG4gIGlmIChsZW5ndGggPT09IDApIHtcbiAgICAvLyBpZiBsZW5ndGggaXMgemVybyB0aGVyZSBhcmUgdHdvIHBvc3NpYmlsaXRpZXM6XG4gICAgLy8gICAxLiB0aGVyZSBpcyBub3RoaW5nIGluIHRoZSB0ZXh0IGZpZWxkXG4gICAgLy8gICAyLiBpdCBpcyBhIHBhc3N3b3JkIGZpZWxkXG4gICAgLy8gc2luY2UgdGhlcmUgaXMgbGl0dGxlIG92ZXJoZWFkIHRvIHRoZSBhZGIgY2FsbCwgZGVsZXRlIDEwMCBlbGVtZW50c1xuICAgIC8vIGlmIHdlIGdldCB6ZXJvLCBqdXN0IGluIGNhc2UgaXQgaXMgIzJcbiAgICBsZW5ndGggPSAxMDA7XG4gIH1cbiAgYXdhaXQgdGhpcy5jbGljayhlbGVtZW50SWQpO1xuICBsb2dnZXIuZGVidWcoYFNlbmRpbmcgdXAgdG8gJHtsZW5ndGh9IGNsZWFyIGNoYXJhY3RlcnMgdG8gZGV2aWNlYCk7XG4gIHJldHVybiBhd2FpdCByZXRyeUludGVydmFsKDUsIDUwMCwgYXN5bmMgKCkgPT4ge1xuICAgIGxldCByZW1haW5pbmdMZW5ndGggPSBsZW5ndGg7XG4gICAgd2hpbGUgKHJlbWFpbmluZ0xlbmd0aCA+IDApIHtcbiAgICAgIGxldCBsZW5ndGhUb1NlbmQgPSByZW1haW5pbmdMZW5ndGggPCA1MCA/IHJlbWFpbmluZ0xlbmd0aCA6IDUwO1xuICAgICAgbG9nZ2VyLmRlYnVnKGBTZW5kaW5nICR7bGVuZ3RoVG9TZW5kfSBjbGVhciBjaGFyYWN0ZXJzIHRvIGRldmljZWApO1xuICAgICAgYXdhaXQgdGhpcy5hZGIuY2xlYXJUZXh0RmllbGQobGVuZ3RoVG9TZW5kKTtcbiAgICAgIHJlbWFpbmluZ0xlbmd0aCAtPSBsZW5ndGhUb1NlbmQ7XG4gICAgfVxuICB9KTtcbn07XG5cbmNvbW1hbmRzLmNsaWNrID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbignZWxlbWVudDpjbGljaycsIHtlbGVtZW50SWR9KTtcbn07XG5cbmNvbW1hbmRzLmdldExvY2F0aW9uID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbignZWxlbWVudDpnZXRMb2NhdGlvbicsIHtlbGVtZW50SWR9KTtcbn07XG5cbmNvbW1hbmRzLmdldExvY2F0aW9uSW5WaWV3ID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5nZXRMb2NhdGlvbihlbGVtZW50SWQpO1xufTtcblxuY29tbWFuZHMuZ2V0U2l6ZSA9IGFzeW5jIGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ2VsZW1lbnQ6Z2V0U2l6ZScsIHtlbGVtZW50SWR9KTtcbn07XG5cbmNvbW1hbmRzLmdldEVsZW1lbnRSZWN0ID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbignZWxlbWVudDpnZXRSZWN0Jywge2VsZW1lbnRJZH0pO1xufTtcblxuY29tbWFuZHMudG91Y2hMb25nQ2xpY2sgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkLCB4LCB5LCBkdXJhdGlvbikge1xuICBsZXQgcGFyYW1zID0ge2VsZW1lbnRJZCwgeCwgeSwgZHVyYXRpb259O1xuICBhbmRyb2lkSGVscGVycy5yZW1vdmVOdWxsUHJvcGVydGllcyhwYXJhbXMpO1xuICByZXR1cm4gYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbignZWxlbWVudDp0b3VjaExvbmdDbGljaycsIHBhcmFtcyk7XG59O1xuXG5jb21tYW5kcy50b3VjaERvd24gPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkLCB4LCB5KSB7XG4gIGxldCBwYXJhbXMgPSB7ZWxlbWVudElkLCB4LCB5fTtcbiAgYW5kcm9pZEhlbHBlcnMucmVtb3ZlTnVsbFByb3BlcnRpZXMocGFyYW1zKTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ2VsZW1lbnQ6dG91Y2hEb3duJywgcGFyYW1zKTtcbn07XG5cbmNvbW1hbmRzLnRvdWNoVXAgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkLCB4LCB5KSB7XG4gIGxldCBwYXJhbXMgPSB7ZWxlbWVudElkLCB4LCB5fTtcbiAgYW5kcm9pZEhlbHBlcnMucmVtb3ZlTnVsbFByb3BlcnRpZXMocGFyYW1zKTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ2VsZW1lbnQ6dG91Y2hVcCcsIHBhcmFtcyk7XG59O1xuXG5jb21tYW5kcy50b3VjaE1vdmUgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkLCB4LCB5KSB7XG4gIGxldCBwYXJhbXMgPSB7ZWxlbWVudElkLCB4LCB5fTtcbiAgYW5kcm9pZEhlbHBlcnMucmVtb3ZlTnVsbFByb3BlcnRpZXMocGFyYW1zKTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ2VsZW1lbnQ6dG91Y2hNb3ZlJywgcGFyYW1zKTtcbn07XG5cbmNvbW1hbmRzLmNvbXBsZXhUYXAgPSBhc3luYyBmdW5jdGlvbiAodGFwQ291bnQsIHRvdWNoQ291bnQsIGR1cmF0aW9uLCB4LCB5KSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLmJvb3RzdHJhcC5zZW5kQWN0aW9uKCdjbGljaycsIHt4LCB5fSk7XG59O1xuXG5jb21tYW5kcy50YXAgPSBhc3luYyBmdW5jdGlvbiAoZWxlbWVudElkLCB4ID0gMCwgeSA9IDAsIGNvdW50ID0gMSkge1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcbiAgICBpZiAoZWxlbWVudElkKSB7XG4gICAgICAvLyB3ZSBhcmUgZWl0aGVyIHRhcHBpbmcgb24gdGhlIGRlZmF1bHQgbG9jYXRpb24gb2YgdGhlIGVsZW1lbnRcbiAgICAgIC8vIG9yIGFuIG9mZnNldCBmcm9tIHRoZSB0b3AgbGVmdCBjb3JuZXJcbiAgICAgIGlmICh4ICE9PSAwIHx8IHkgIT09IDApIHtcbiAgICAgICAgYXdhaXQgdGhpcy5ib290c3RyYXAuc2VuZEFjdGlvbignZWxlbWVudDpjbGljaycsIHtlbGVtZW50SWQsIHgsIHl9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ2VsZW1lbnQ6Y2xpY2snLCB7ZWxlbWVudElkfSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGF3YWl0IHRoaXMuYm9vdHN0cmFwLnNlbmRBY3Rpb24oJ2NsaWNrJywge3gsIHl9KTtcbiAgICB9XG4gIH1cbn07XG5cbk9iamVjdC5hc3NpZ24oZXh0ZW5zaW9ucywgY29tbWFuZHMsIGhlbHBlcnMpO1xuZXhwb3J0IHsgY29tbWFuZHMsIGhlbHBlcnMgfTtcbmV4cG9ydCBkZWZhdWx0IGV4dGVuc2lvbnM7XG4iXSwiZmlsZSI6ImxpYi9jb21tYW5kcy9lbGVtZW50LmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
